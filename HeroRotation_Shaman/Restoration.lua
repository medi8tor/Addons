local K,V=...local s=HeroDBC.DBC local w=HeroLib local p=HeroCache local N=w.Unit local d=N.Player local R=N.Pet local y=N.Target local C=w.Spell local T=w.MultiSpell local o=w.Item local I=HeroRotation()local u=I.Cast local j=I.AoEON local l=I.CDsON local Y=(I.Commons()).Everyone.num local q=(I.Commons()).Everyone.bool local v=math.min local n=GetWeaponEnchantInfo local F=math.floor local k=GetTotemInfo local r=GetTime local A=C.Shaman.Restoration local J=o.Shaman.Restoration local U={J.ScreamingBlackDragonScale:ID(),J.BroodkeepersPromise:ID()}local Q=I.GUISettingsGet()local B=(I.Commons()).Everyone local Z=(I.Commons()).Shaman local i={General=Q.General,Commons=Q.APL.Shaman.Commons;Resto=Q.APL.Shaman.Restoration;Cooldowns=Q.APL.Shaman.Restoration.Cooldowns,AoE=not d:IsInRaid()and Q.APL.Shaman.Restoration.AoE or Q.APL.Shaman.Restoration.RaidAoE;Healing=not d:IsInRaid()and Q.APL.Shaman.Restoration.Healing or Q.APL.Shaman.Restoration.RaidHealing}local G local m w:RegisterForEvent(function()A.LavaBurst:RegisterInFlight()end,"\076\069\065\082\078\069\068\095\083\080\069\076\076\095\073\078\095\084\065\066")A.LavaBurst:RegisterInFlight()local function D(K)return K:NPCID()==204449 or K:NPCID()==208459 or K:NPCID()==208461 or K:NPCID()==207800 or K:NPCID()==194646 or K:NPCID()==212590 end local function x()return D(y)and not d:CanAttack(y)end local H local h local f local S local t local O local g local X local function e(K)return K:NPCID()==204773 end local function z(K)return K:NPCID()==204560 end local function a(K)for V=1,4,1 do local s,w,p,N=k(V)if w==K:Name()then return F(((p+N)-r())+.5)or 0 end end return 0 end local function c(K)if K==nil then return nil end local V=K:IsCastable()and K:IsReady()local s=d:BuffUp(A.SpiritwalkersGraceBuff)or not d:IsMoving()if K==A.LightningBolt or K==A.ChainLightning or K==A.HealingRain or K==A.HealingWave or K==A.HealingSurge or K==A.Wellspring then return V and s elseif K==A.LavaBurst then local K=d:BuffUp(A.LavaSurge)local w=not d:IsCasting(A.LavaBurst)and A.LavaBurst:Charges()>=1 local p=d:IsCasting(A.LavaBurst)and A.LavaBurst:Charges()==2 return V and((s or d:BuffUp(A.LavaSurge))and(K or w or p))else return V end end local function L(K,V,s,w,p)local N,R,y=d:GetUseableItems(U,13)if N and B.AoELogic(K,V,p)then if u(N)then return"\116\114\105\110\107\101\116\049 \116\114\105\110\107\101\116\115 \050"end end local C,T,o=d:GetUseableItems(U,14)if C and B.AoELogic(s,w,p)then if u(C)then return"\116\114\105\110\107\101\116\050 \116\114\105\110\107\101\116\115 \052"end end end local function E()local K,V,s,w,p,N=n()if A.WaterShield:IsCastable()and d:BuffDown(A.WaterShield)then I.Cast(A.WaterShield)return"\087\097\116\101\114 \083\104\105\101\108\100"end if A.ElementalOrbit:IsAvailable()and(A.EarthShield:IsCastable()and d:BuffDown(A.EarthShieldT))then d:Cast(A.EarthShield)return"\069\097\114\116\104 \115\104\105\101\108\100 \111\110 \115\101\108\102 \102\111\114 \079\114\098\105\116"end if i.Resto.EarthlivingWeapon then if(not K or V<600000)and A.EarthlivingWeapon:IsCastable()then if u(A.EarthlivingWeapon)then return"\069\097\114\116\104\108\105\118\105\110\103 \087\101\097\112\111\110 \101\110\099\104\097\110\116"end end end if i.Commons.AutoWolf=="\097\108\119\097\121\115"or i.Commons.AutoWolf=="\079\110\108\121 \105\110 \067\111\109\098\097\116"and d:AffectingCombat()or i.Commons.AutoWolf=="\079\110\108\121 \111\117\116 \111\102 \099\111\109\098\097\116"and not d:AffectingCombat()then if d:IsMoving()and(not d:IsMounted()and d:BuffDown(A.GhostWolf))then u(A.GhostWolf)return"\071\104\111\115\116 \087\111\108\102"end end end local M=B.converArrayToList({438473,438879,448847;257326,272711;439365;438877;451222,436246;440468,324909;320614;272662,270590;269266;449444;438495})local P=B.converArrayToList({440468;446717;441216;437533,439341;451102;432117;434252,426826,448888,434093,456751;451939,451871,451965,460092,327397,320596,454439;428535;425974;428879;465012,424879;439577,443494;423324;427329,323149,321669,322614,321821;322756,335141;333485;333633,321754,463182;457664;450095;450077;449444,443507,451222;426734,434655,439792;426771;429427})local function b()local K=d:GetEnemiesInRange(40)for K,V in pairs(K)do if M[V:CastSpellID()or V:ChannelSpellID()]then return true end end end local function W()local K=d:GetEnemiesInRange(40)for K,V in pairs(K)do if P[V:CastSpellID()or V:ChannelSpellID()]then return true end end end local KE=nil local function VE()if d:IsMoving()then if not KE then KE=r()end return r()-KE else if KE then KE=nil end return 0 end end local sE=C(440313)local wE,pE,NE,dE,RE,yE local CE,TE,oE,IE,uE local jE,lE,YE,qE,vE,nE,FE local function kE()i.AoE=not d:IsInRaid()and Q.APL.Shaman.Restoration.AoE or Q.APL.Shaman.Restoration.RaidAoE i.Healing=not d:IsInRaid()and Q.APL.Shaman.Restoration.Healing or Q.APL.Shaman.Restoration.RaidHealing CE=I.ToggleIconFrame:GetToggle(1)TE=I.ToggleIconFrame:GetToggle(2)oE=I.ToggleIconFrame:GetToggle(3)IE=I.ToggleIconFrame:GetToggle(4)FE=I.ToggleIconFrame:GetToggle(5)G=B.UnitsinRange(A.HealingSurge)if j()then m=y:IsDummy()and#d:GetEnemiesInRange(40)or y:GetEnemiesInSplashRangeCount(8)>1 and y:GetEnemiesInSplashRangeCount(8)or#d:GetEnemiesInRange(40)else m=1 end if A.PoisonCleansingTotem:IsAvailable()and A.PoisonCleansingTotem:IsReady()then uE=B.DebuffCount(G,sE)else uE=0 end wE,pE=B.GetLowestHealthUnit(G)if pE then lE=pE:HealthPercentage()YE=math.min(lE+pE:IncomingHeals(),100)else lE=100 YE=100 end if wE then NE=wE:HealthPercentageWeighted()qE=wE:HealthPercentage()vE=math.min(NE+wE:IncomingHeals(),100)nE=math.min(qE+wE:IncomingHeals(),100)else NE=100 qE=100 vE=100 nE=100 end dE=B.GetLowestHealthUnitWithoutBuff(G,A.Riptide)RE=i.Healing.WhichUndulation=="\072\101\097\108\105\110\103 \083\117\114\103\101"and A.HealingSurge or A.HealingWave yE=not d:IsMoving()or d:BuffUp(A.SpiritwalkersGrace)end local function rE()if NE>=45 and(e(y)and((A.PurifySpirit:CooldownDown()or not A.ImprovedPurifySpirit:IsAvailable())and y:IsSpellInRange(A.Riptide)))then if A.HealingSurge:IsReady()and yE then u(A.HealingSurge)return end end if NE>=35 and(x()and(y:HealthPercentage()>0 and y:HealthPercentage()<100))then if y:BuffDown(A.Riptide)and A.Riptide:IsReady()then u(A.Riptide)return end if A.HealingSurge:IsReady()and yE then u(A.HealingSurge)return end end if d:IsMoving()and(A.SpiritwalkersGrace:IsReady()and(i.Resto.SpiritwalkersGrace and VE()>1))then u(A.SpiritwalkersGrace)return"\083\087\071"end if i.Commons.AutoWolf=="\097\108\119\097\121\115"or i.Commons.AutoWolf=="\079\110\108\121 \105\110 \067\111\109\098\097\116"and d:AffectingCombat()or i.Commons.AutoWolf=="\079\110\108\121 \111\117\116 \111\102 \099\111\109\098\097\116"and not d:AffectingCombat()then if d:IsMoving()and(not d:IsMounted()and(d:BuffDown(A.GhostWolf)and not d:AffectingCombat()))then u(A.GhostWolf)return"\071\104\111\115\116 \087\111\108\102"end if d:IsMoving()and(not d:IsMounted()and(d:BuffDown(A.GhostWolf)and(d:AffectingCombat()and VE()>2)))then u(A.GhostWolf)return"\071\104\111\115\116 \087\111\108\102"end end if A.WaterShield:IsReady()and d:BuffDown(A.WaterShield)then I.Cast(A.WaterShield)return"\087\097\116\101\114 \083\104\105\101\108\100"end if NE>=30 and d:HealthPercentage()>=70 then if A.ElementalOrbit:IsAvailable()and(A.EarthShield:IsCastable()and d:BuffDown(A.EarthShieldT))then d:Cast(A.EarthShield)return"\069\097\114\116\104 \115\104\105\101\108\100 \111\110 \115\101\108\102 \102\111\114 \079\114\098\105\116"end end if A.AstralShift:IsReady()and(i.Resto.AstralShiftHP>0 and(d:HealthPercentage()<=i.Resto.AstralShiftHP or W()or b()))then I.Cast(A.AstralShift)return"\065\115\116\114\097\108 \083\104\105\102\116 \080\101\114 \083\101\116\116\105\110\103\115"end if i.Resto.TotemRecall then if A.TotemicRecall:IsReady()and(A.CloudburstTotem:IsAvailable()and A.CloudburstTotem:CooldownDown()or A.EarthenWallTotem:IsAvailable()and A.EarthenWallTotem:CooldownDown()or A.HealingStreamTotem:IsAvailable()and A.HealingStreamTotem:CooldownDown())then I.Cast(A.TotemicRecall)return"\084\111\116\101\109 \082\101\099\097\108\108"end end if A.Downpour:IsReady()then I.Cast(A.Downpour)return"\068\111\119\110\112\111\117\114"end if FE and(d:IsInParty()or d:IsInRaid())then if NE<=30 then I.CastMacro(2,true)end end if A.Ascendance:IsReady()and B.AoELogicWithCount(i.AoE.AscendanceHP,i.AoE.AscendanceCount,i.Cooldowns.UseAscendance,G)then I.Cast(A.Ascendance)return"\065\115\099\101\110\100\097\110\099\101 \067\097\115\116"end if d:BuffUp(A.NaturesSwiftness)and RE:IsReady()then wE:Cast(RE)return"\078\083 \066\117\102\102 \083\112\101\108\108 \067\097\115\116"end if A.NaturesSwiftness:IsReady()and(d:AffectingCombat()and NE<=i.Healing.NSHP)then I.CastTarget(A.NaturesSwiftness,(I.TName()).PLAYER,true)return"\078\083 \065\099\116\117\097\108 \067\097\115\116"end if A.AncestralSwiftness:IsReady()and(d:AffectingCombat()and NE<=i.Healing.NSHP)then I.CastTarget(A.AncestralSwiftness,(I.TName()).PLAYER,true)return"\065\083 \065\099\116\117\097\108 \067\097\115\116"end if A.AncestralGuidance:IsReady()and(d:AffectingCombat()and B.AoELogicWithCount(i.AoE.AGHP,i.AoE.AGCount,i.Cooldowns.UseAG,G))then I.Cast(A.AncestralGuidance)return"\065\110\099\101\115\116\114\097\108 \071\117\105\100\097\110\099\101"end if A.EarthElemental:IsReady()and(d:AffectingCombat()and((i.Cooldowns.EarthEle=="\087\105\116\104 \076\111\103\105\099"or i.Cooldowns.EarthEle=="\087\105\116\104 \067\111\111\108\100\111\119\110\115 \097\110\100 \076\111\103\105\099"and l)and d:HealthPercentage()<=25 or l and i.Cooldowns.EarthEle=="\087\105\116\104 \067\111\111\108\100\111\119\110\115"))then I.CastTarget(A.EarthElemental,(I.TName()).PLAYER)return"\069\097\114\116\104 \069\108\101\109\101\110\116\097\108"end if A.SpiritLinkTotem:IsReady()and(d:AffectingCombat()and B.AoELogicWithCount(i.AoE.SpiritLinkHP,i.AoE.SpiritLinkCount,"\087\105\116\104 \076\111\103\105\099",G))then I.Cast(A.SpiritLinkTotem)return"\083\112\105\114\105\116\076\105\110\107\084\111\116\101\109 \067\097\115\116\101\100 \116\111 \098\101 \080\108\097\099\101\100"end if A.HealingTideTotem:IsReady()and B.AoELogicWithCount(i.AoE.HealingTideHP,i.AoE.HealingTideCount,"\087\105\116\104 \076\111\103\105\099",G)then I.Cast(A.HealingTideTotem)return"\072\101\097\108\105\110\103 \084\105\100\101 \084\111\116\101\109"end if A.StoneBulkwarkTotem:IsReady()then if W()or b()then u(A.StoneBulkwarkTotem)return"\083\116\111\110\101 \066\117\108\107\119\097\114\107 \084\111\116\101\109"end end if y:NPCID()==95072 and not y:IsDeadOrGhost()then if A.Riptide:IsReady()and y:BuffDown(A.Riptide)then I.Cast(A.Riptide)return"\082\105\112\116\105\100\101 \111\110 \069\108\101"end if A.HealingWave:IsReady()and(y:HealthPercentage()<=90 and yE)then I.Cast(A.HealingWave)return"\072\101\097\108\105\110\103 \087\097\118\101 \111\110 \069\108\101"end end if not FE then if A.ChainHeal:IsReady()and(d:BuffUp(A.Hightide)and(B.AoELogicWithCount(i.AoE.ChainHealHighTideHP,i.AoE.ChainHealHighTideCount,"\087\105\116\104 \076\111\103\105\099",G)and yE))then wE:Cast(A.ChainHeal)return" \067\104\097\105\110 \072\101\097\108 \119\105\116\104 \072\105\103\104 \084\105\100\101"end if A.UnleashLife:IsReady()and NE<=i.Healing.UnleashLifeHP then wE:Cast(A.UnleashLife)return"\085\110\108\101\097\115\104 \076\105\102\101"end if A.Wellspring:IsReady()and(yE and B.AoELogicWithCount(i.AoE.WellspringHP,i.AoE.WellspringCount,"\087\105\116\104 \076\111\103\105\099",G))then I.Cast(A.Wellspring)return"\087\101\108\108 \083\112\114\105\110\103 \067\097\115\116"end if vE<=20 and(B.GetAverageGroupHealthPercent(G)>=35 and(A.NaturesSwiftness:CooldownUp()and not d:IsInRaid()))then if A.HealingSurge:IsReady()and(d:BuffDown(A.PrimordialWave)and(vE<=i.Healing.HealingSurgeHP and yE))then wE:Cast(A.HealingSurge)return"\072\101\097\108\105\110\103 \083\117\114\103\101 \119\104\101\110 \115\111\109\101\111\110\101 \116\111 \108\111\119"end if A.HealingWave:IsReady()and(d:BuffDown(A.PrimordialWave)and(vE<=i.Healing.HealingWaveHP and yE))then wE:Cast(A.HealingWave)return"\072\101\097\108\105\110\103 \083\117\114\103\101 \119\104\101\110 \115\111\109\101\111\110\101 \116\111 \108\111\119"end end if vE>=30 then if pE~=nil then if A.EarthShield:IsReady()and(pE:BuffDown(A.EarthShield)and B.BuffCount(G,A.EarthShield)<1)then pE:Cast(A.EarthShield)return"\069\097\114\116\104 \083\104\105\101\108\100 \067\097\115\116\101\100"end end end if dE~=nil then if A.PrimordialWave:IsReady()and(dE:HealthPercentage()<=i.Healing.PrimordiaWaveHP and B.BuffCount(G,A.Riptide)>=2)then dE:Cast(A.PrimordialWave)return" \080\114\105\109\111\114\100\105\097\108\087\097\118\101 \111\110 \085\110\105\116 \119\047\111 \082\105\112\116\105\100\101"end else if A.PrimordialWave:IsReady()and(wE:HealthPercentage()<=i.Healing.PrimordiaWaveHP and B.BuffCount(G,A.Riptide)>=2)then wE:Cast(A.PrimordialWave)return" \080\114\105\109\111\114\100\105\097\108\087\097\118\101 \111\110 \085\110\105\116 \119\047\111 \082\105\112\116\105\100\101"end end if d:BuffUp(A.PrimordialWaveBuff)and(A.HealingWave:IsReady()and(yE and(NE<=70 and(B.BuffCount(G,A.Riptide)>=3 or d:BuffRemains(A.PrimordialWaveBuff)<=2))))then wE:Cast(A.HealingWave)return"\072\101\097\108\105\110\103 \087\097\118\101 \100\117\101 \116\111 \080\087 \097\110\100 \082\084 \066\117\102\102\115"end if pE~=nil then if A.Riptide:IsReady()and(A.Riptide:Charges()>0 and(pE:BuffDown(A.Riptide)and pE:HealthPercentage()<=i.Healing.RiptideHP))then pE:Cast(A.Riptide)return"\082\105\112\116\105\100\101 \111\110 \076\111\119\101\115\116 \084\097\110\107 \087\047\079 \082\105\112\116\105\100\101"end end if dE~=nil then if A.Riptide:IsReady()and(A.Riptide:Charges()>0 and dE:HealthPercentage()<=i.Healing.RiptideHP)then dE:Cast(A.Riptide)return"\082\105\112\116\105\100\101 \111\110 \076\111\119\101\115\116 \084\097\110\107 \087\047\079 \082\105\112\116\105\100\101"end end if A.CloudburstTotem:IsReady()and(A.CloudburstTotem:IsAvailable()and(a(A.CloudburstTotem)<=0 and B.AoELogicWithCount(i.AoE.CloudBurstHP,i.AoE.CloudBurstCount,"\087\105\116\104 \076\111\103\105\099",G)))then I.CastTarget(A.CloudburstTotem,(I.TName()).PLAYER)return"\067\108\111\117\100 \066\117\114\115\116 \084\111\116\101\109"end if A.CloudburstTotem:IsAvailable()and(a(A.CloudburstTotem)>0 and(B.AoELogicWithCount(i.AoE.CloudBurstRecastHP,i.AoE.CloudBurstRecastCount,"\087\105\116\104 \076\111\103\105\099",G)and a(A.CloudburstTotem)<10 or a(A.CloudburstTotem)<3))then I.CastTarget(A.CloudburstTotem,(I.TName()).PLAYER)return"\067\108\111\117\100 \066\117\114\115\116 \084\111\116\101\109 \082\101\099\097\115\116"end if A.ChainHeal:IsReady()and((d:BuffUp(A.Tidebringer)or d:BuffUp(A.TidalWaves))and((B.AoELogicWithCount(i.AoE.ChainHealHP,i.AoE.ChainHealCount,"\087\105\116\104 \076\111\103\105\099",G)or d:BuffUp(A.UnleashLife))and yE))then wE:Cast(A.ChainHeal)return"\067\104\097\105\110 \072\101\097\108"end if A.ManaTideTotem:IsReady()and d:ManaPercentage()<=i.Healing.ManaTideMP then I.Cast(A.ManaTideTotem)return"\077\097\110\097 \084\105\100\101 \084\111\116\101\109"end if A.UnleashLife:IsReady()and(d:BuffUp(A.Hightide)and NE<=i.Healing.UnleashLifeHP)then wE:Cast(A.UnleashLife)return"\085\110\108\101\097\115\104 \076\105\102\101"end if IE and d:AffectingCombat()then if A.SurgingTotem:IsReady()and(not d:PrevGCD(1,A.SurgingTotem)and(B.AoELogicWithCount(i.AoE.HealingRainHP,i.AoE.HealingRainCount,"\087\105\116\104 \076\111\103\105\099",G)or A.AcidRain:IsAvailable()and B.TargetIsValid()))then I.Cast(A.SurgingTotem)return"\083\117\114\103\105\110\103 \084\111\116\101\109 \067\097\115\116\101\100 \116\111 \098\101 \080\108\097\099\101\100"end if A.HealingRain:IsReady()and(not d:PrevGCD(1,A.HealingRain)and((B.AoELogicWithCount(i.AoE.HealingRainHP,i.AoE.HealingRainCount,"\087\105\116\104 \076\111\103\105\099",G)or A.AcidRain:IsAvailable()and B.TargetIsValid())and yE))then I.Cast(A.HealingRain)return"\072\101\097\108\105\110\103 \082\097\105\110 \067\097\115\116\101\100 \116\111 \098\101 \080\108\097\099\101\100"end end if A.HealingStreamTotem:IsReady()and(A.HealingStreamTotem:IsAvailable()and((a(A.HealingStreamTotem)<=0 or a(A.HealingStreamTotem)<5 and(A.HealingStreamTotem:Charges()>=1 and B.GetAverageGroupHealthPercent(G)<=45))and B.AoELogicWithCount(i.AoE.CloudBurstHP,i.AoE.CloudBurstCount,"\087\105\116\104 \076\111\103\105\099",G)))then I.Cast(A.HealingStreamTotem)return"\072\101\097\108\105\110\103 \083\116\114\101\097\109 \084\111\116\101\109"end if A.EarthenWallTotem:IsReady()and(d:AffectingCombat()and B.AoELogicWithCount(i.AoE.EarthenWallHP,i.AoE.EarthenWallCount,"\087\105\116\104 \076\111\103\105\099",G))then I.Cast(A.EarthenWallTotem)return"\069\097\114\116\104\101\110\087\097\108\108\084\111\116\101\109 \067\097\115\116\101\100 \116\111 \098\101 \080\108\097\099\101\100"end if A.ChainHeal:IsReady()and((B.AoELogicWithCount(i.AoE.ChainHealHP,i.AoE.ChainHealCount,"\087\105\116\104 \076\111\103\105\099",G)or d:BuffUp(A.UnleashLife))and yE)then wE:Cast(A.ChainHeal)return"\067\104\097\105\110 \072\101\097\108"end if RE:IsReady()and(d:BuffUp(A.Undulation)and(vE<=i.Healing.NSHP and yE))then wE:Cast(RE)return"\085\110\100\108\097\116\105\111\110 \083\112\101\108\108 \067\097\115\116"end if pE~=nil then if A.HealingSurge:IsReady()and(d:BuffDown(A.PrimordialWave)and(pE:HealthPercentage()<=i.Healing.HealingSurgeTankHP and yE))then pE:Cast(A.HealingSurge)return"\072\101\097\108\105\110\103 \083\117\114\103\101 \119\104\101\110 \115\111\109\101\111\110\101 \116\111 \108\111\119"end if A.HealingWave:IsReady()and(d:BuffDown(A.PrimordialWave)and(pE:HealthPercentage()<=i.Healing.HealingWaveTankHP and yE))then pE:Cast(A.HealingWave)return"\072\101\097\108\105\110\103 \083\117\114\103\101 \119\104\101\110 \115\111\109\101\111\110\101 \116\111 \108\111\119"end end if A.HealingSurge:IsReady()and(d:BuffDown(A.PrimordialWave)and(vE<=i.Healing.HealingSurgeHP and yE))then wE:Cast(A.HealingSurge)return"\072\101\097\108\105\110\103 \083\117\114\103\101 \119\104\101\110 \115\111\109\101\111\110\101 \116\111 \108\111\119"end if A.HealingWave:IsReady()and(d:BuffDown(A.PrimordialWave)and(vE<=i.Healing.HealingWaveHP and yE))then wE:Cast(A.HealingWave)return"\072\101\097\108\105\110\103 \083\117\114\103\101 \119\104\101\110 \115\111\109\101\111\110\101 \116\111 \108\111\119"end end if B.TargetIsValid()and((d:AffectingCombat()or i.Resto.AttackOOC and CE)and((NE>=35 or FE)and not z(y)))then if A.StormKeeper:IsReady()and((i.Cooldowns.Stormkeeper=="\087\105\116\104 \076\111\103\105\099"or i.Cooldowns.Stormkeeper=="\087\105\116\104 \067\111\111\108\100\111\119\110\115 \097\110\100 \076\111\103\105\099"and l or i.Cooldowns.Stormkeeper=="\087\105\116\104 \067\111\111\108\100\111\119\110\115"and l)and yE)then I.Cast(A.StormKeeper)return"\083\116\111\114\109 \075\101\101\112\101\114"end if y:AffectingCombat()and d:BuffUp(A.StormKeeper)then if j and m>=2 then if A.ChainLightning:IsReady()and(yE and y:IsSpellInRange(A.ChainLightning))then I.Cast(A.ChainLightning)return"\067\104\097\105\110 \076\105\103\104\116\105\110\103"end else if A.LightningBolt and(yE and y:IsSpellInRange(A.LightningBolt))then I.Cast(A.LightningBolt)return"\076\105\103\104\116\105\110\103 \066\111\108\116"end end end if j and m>=2 then if A.ChainLightning:IsReady()and(yE and y:IsSpellInRange(A.ChainLightning))then I.Cast(A.ChainLightning)return"\067\104\097\105\110 \076\105\103\104\116\105\110\103 \065\111\069 \083\112\097\109"end end if A.FlameShock:IsReady()and(y:AffectingCombat()and(y:IsSpellInRange(A.FlameShock)and y:DebuffRefreshable(A.FlameShock)))then I.Cast(A.FlameShock)return"\070\108\097\109\101 \083\104\111\099\107"end if c(A.LavaBurst)then I.Cast(A.LavaBurst)return"\076\097\118\097 \066\117\114\115\116 \067\097\115\116"end if j and m>=2 then if A.ChainLightning:IsReady()and(yE and y:IsSpellInRange(A.ChainLightning))then I.Cast(A.ChainLightning)return"\067\104\097\105\110 \076\105\103\104\116\105\110\103"end else if A.LightningBolt and(yE and y:IsSpellInRange(A.LightningBolt))then I.Cast(A.LightningBolt)return"\076\105\103\104\116\105\110\103 \066\111\108\116"end end end end local function AE()if B.ShouldStopCastUpdate()then I.CastMacro(6,true)return"\083\116\111\112 \067\097\115\116 \070\111\114 \083\105\108\101\110\099\101"end VE()if A.SkyFury:IsReady()and(d:Level()>=16 and(not d:DebuffUp(A.Corruption)and((B.GroupBuffMissing(A.SkyFuryBuff)and(i.Commons.SkyFury=="\099\104\101\099\107 \119\104\111\108\101 \103\114\111\117\112"and(d:IsInRaidArea()or d:IsInDungeonArea()))or d:BuffDown(A.SkyFuryBuff,true)and(i.Commons.SkyFury=="\111\110\108\121 \099\104\101\099\107 \117\115"or i.Commons.SkyFury=="\099\104\101\099\107 \119\104\111\108\101 \103\114\111\117\112"))and not d:IsMounted())))then if I.CastTarget(A.SkyFury,(I.TName()).PLAYER)then return"\083\107\121\070\117\114\121"end end if not d:IsMounted()and(not d:IsChanneling()and(B.TargetIsValid()or d:AffectingCombat()or CE))then if not d:AffectingCombat()or CE then jE=E()if jE then return jE end end if d:AffectingCombat()then if oE and A.WindShear:IsReady()then jE=B.InterruptCycle(A.WindShear,30,true,nil,false)if jE then return jE end end if A.Purge:IsReady()then jE=B.PurgeCycle(A.Purge,40,false,i.Commons.TabForPurge)if jE then return jE end end if A.Hex:IsReady()and d:AffectingCombat()then jE=B.IncorpCycle(A.Hex,40,false,false)if jE then return jE end end if TE and(not d:IsInRaid()and A.PurifySpirit:IsReady())then jE=B.DispelCycle(A.PurifySpirit,"\077\097\103\105\099",nil,G)if jE then return jE end if A.ImprovedPurifySpirit:IsAvailable()then jE=B.AfflictedLogic(A.PurifySpirit)if jE then return jE end jE=B.DispelCycle(A.PurifySpirit,"\067\117\114\115\101",nil,G)if jE then return jE end end if A.PoisonCleansingTotem:IsAvailable()and A.PoisonCleansingTotem:IsReady()then if B.DispelCycle(A.PoisonCleansingTotem,"\080\111\105\115\111\110",nil,G)then return I.CastTarget(A.PoisonCleansingTotem,(I.TName()).PLAYER)end if uE>1 or A.PurifySpirit:CooldownDown()and uE>0 then return I.CastTarget(A.PoisonCleansingTotem,(I.TName()).PLAYER)end end end if TE and(d:IsInRaid()and A.PurifySpirit:IsReady())then jE=B.DispelCycle(A.PurifySpirit,"\082\097\105\100",nil,G)if jE then return jE end end end jE=L(i.Cooldowns.Trinket1HP,i.Cooldowns.Trinket1Use,i.Cooldowns.Trinket2HP,i.Cooldowns.Trinket2Use,G)if jE then return jE end jE=rE()if jE then return jE end end end local function JE()I.ResetToggle()i.Resto.Display()I:UpdateMacro("\109\097\099\114\111\049","\047\117\115\101 \049\054")I:UpdateMacro("\109\097\099\114\111\050","\047\104\114 \100\112\115\111\110\108\121")I:UpdateMacro("\109\097\099\114\111\054","\047\115\116\111\112\099\097\115\116\105\110\103")I.ToggleIconFrame:AddButtonCustom("\079",1,"\079\079\067","\111\111\099")I.ToggleIconFrame:AddButtonCustom("\068",2,"\068\105\115\112\101\108","\100\105\115\112\101\108")I.ToggleIconFrame:AddButtonCustom("\075",3,"\075\105\099\107","\107\105\099\107")I.ToggleIconFrame:AddButtonCustom("\072",4,"\072\101\097\108\105\110\103 \082\097\105\110","\104\101\097\108\105\110\103\114\097\105\110")I.ToggleIconFrame:AddButtonCustom("\068\080",5,"\068\080\083 \079\110\108\121","\100\112\115\111\110\108\121")I.Print("\082\101\115\116\111\114\097\116\105\111\110 \083\104\097\109\097\110 \114\111\116\097\116\105\111\110 \104\097\115 \098\101\101\110 \117\112\100\097\116\101\100 \102\111\114 \049\048\046\050\046 \076\097\115\116 \085\112\100\097\116\101 \048\052\047\053\047\050\052")end I.SetAPL(264,AE,JE,kE)