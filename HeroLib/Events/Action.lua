local l,t=...local D,B=HeroCache,t.Utils local G=t.Unit local k=G.Player local o=G.Pet local d=G.Target local e=t.Spell local I=t.Item local R=GetActionInfo local N=GetActionText local L=GetActionTexture local V=GetBindingKey local K=GetBonusBarOffset local E=HasAction local x=math.ceil local P=table.insert local q=table.remove local y=gmatch local p={}local g={Item={},Macro={};Spell={};Text={};Texture={}}local Y={Item={};Macro={};Spell={},Text={},Texture={}}local w={Actions=p,ActionSlotsBy=g;HotKeyWhitelist=Y}t.Action=w local M={Bartender={[1]={"\066\084\052\066\117\116\116\111\110","\067\076\073\067\075 \066\084\052\066\117\116\116\111\110\037\105\058\076\101\102\116\066\117\116\116\111\110"}},Blizzard={[1]={"\065\099\116\105\111\110\066\117\116\116\111\110";"\065\067\084\073\079\078\066\085\084\084\079\078\037\105"},[2]={"\065\099\116\105\111\110\066\117\116\116\111\110";nil},[3]={"\077\117\108\116\105\066\097\114\082\105\103\104\116\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\051\066\085\084\084\079\078\037\105"};[4]={"\077\117\108\116\105\066\097\114\076\101\102\116\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\052\066\085\084\084\079\078\037\105"};[5]={"\077\117\108\116\105\066\097\114\066\111\116\116\111\109\082\105\103\104\116\066\117\116\116\111\110","\077\085\076\084\073\065\067\084\073\079\078\066\065\082\050\066\085\084\084\079\078\037\105"},[6]={"\077\117\108\116\105\066\097\114\066\111\116\116\111\109\076\101\102\116\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\049\066\085\084\084\079\078\037\105"},[7]={"\065\099\116\105\111\110\066\117\116\116\111\110";nil};[8]={"\065\099\116\105\111\110\066\117\116\116\111\110",nil},[9]={"\065\099\116\105\111\110\066\117\116\116\111\110";nil},[10]={"\065\099\116\105\111\110\066\117\116\116\111\110",nil}},Dominos={[1]={"\065\099\116\105\111\110\066\117\116\116\111\110";"\065\067\084\073\079\078\066\085\084\084\079\078\037\105"},[2]={"\068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110","\067\076\073\067\075 \068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110\037\105\058\072\079\084\075\069\089"},[3]={"\077\117\108\116\105\066\097\114\082\105\103\104\116\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\051\066\085\084\084\079\078\037\105"};[4]={"\077\117\108\116\105\066\097\114\076\101\102\116\066\117\116\116\111\110","\077\085\076\084\073\065\067\084\073\079\078\066\065\082\052\066\085\084\084\079\078\037\105"};[5]={"\077\117\108\116\105\066\097\114\066\111\116\116\111\109\082\105\103\104\116\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\050\066\085\084\084\079\078\037\105"};[6]={"\077\117\108\116\105\066\097\114\066\111\116\116\111\109\076\101\102\116\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\049\066\085\084\084\079\078\037\105"};[7]={"\068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110","\067\076\073\067\075 \068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110\037\105\058\072\079\084\075\069\089"},[8]={"\068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110";"\067\076\073\067\075 \068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110\037\105\058\072\079\084\075\069\089"};[9]={"\068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110";"\067\076\073\067\075 \068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110\037\105\058\072\079\084\075\069\089"};[10]={"\068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110";"\067\076\073\067\075 \068\111\109\105\110\111\115\065\099\116\105\111\110\066\117\116\116\111\110\037\105\058\072\079\084\075\069\089"}};ElvUI={[1]={"\069\108\118\085\073\095\066\097\114\049\066\117\116\116\111\110";"\065\067\084\073\079\078\066\085\084\084\079\078\037\105"},[2]={"\069\108\118\085\073\095\066\097\114\050\066\117\116\116\111\110","\069\076\086\085\073\066\065\082\050\066\085\084\084\079\078\037\105"};[3]={"\069\108\118\085\073\095\066\097\114\051\066\117\116\116\111\110","\077\085\076\084\073\065\067\084\073\079\078\066\065\082\051\066\085\084\084\079\078\037\105"},[4]={"\069\108\118\085\073\095\066\097\114\052\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\052\066\085\084\084\079\078\037\105"},[5]={"\069\108\118\085\073\095\066\097\114\053\066\117\116\116\111\110","\077\085\076\084\073\065\067\084\073\079\078\066\065\082\050\066\085\084\084\079\078\037\105"},[6]={"\069\108\118\085\073\095\066\097\114\054\066\117\116\116\111\110";"\077\085\076\084\073\065\067\084\073\079\078\066\065\082\049\066\085\084\084\079\078\037\105"},[7]={"\069\108\118\085\073\095\066\097\114\055\066\117\116\116\111\110","\069\076\086\085\073\066\065\082\055\066\085\084\084\079\078\037\105"};[8]={"\069\108\118\085\073\095\066\097\114\056\066\117\116\116\111\110";"\069\076\086\085\073\066\065\082\056\066\085\084\084\079\078\037\105"},[9]={"\069\108\118\085\073\095\066\097\114\057\066\117\116\116\111\110","\069\076\086\085\073\066\065\082\057\066\085\084\084\079\078\037\105"};[10]={"\069\108\118\085\073\095\066\097\114\049\048\066\117\116\116\111\110";"\069\076\086\085\073\066\065\082\049\048\066\085\084\084\079\078\037\105"}}}local function T(l)local t=x(l/12)local D=l%12 if D==0 then D=12 end return t,D end local function s(l,t)local D,B=T(l)local G,k if t then G=M.Blizzard[D][1]if D>=3 or D<=6 then k=B else k=l end elseif _G.Bartender4 then G=M.Bartender[1][1]k=l elseif _G.Dominos then G=M.Dominos[D][1]if D==1 then k=l elseif D>=3 and D<=6 then k=B else if D==2 then k=l-12 else k=l-60 end end elseif _G.ElvUI and _G.ElvUI[1].ActionBars then G=M.ElvUI[D][1]k=B else G=M.Blizzard[D][1]if D>=3 or D<=6 then k=B else k=l end end return G,k end local function z(l)local t=T(l)local D,B=s(l)return D..B end local function A(l)for t=1,10,1 do local B="\098\097\114"..t local G=_G.ElvUI[1].ActionBars.db[B].paging[l]if G==""or not G then D.Persistent.ElvUIPaging.PagingStrings[t]=nil for l,B in pairs(D.Persistent.ElvUIPaging.PagingBars)do if B==t then D.Persistent.ElvUIPaging.PagingBars[l]=nil end end end if G and(G~=""and D.Persistent.ElvUIPaging.PagingStrings[t]~=G)then for l in(G.."\059"):gmatch("\040\046-\041\059")do for l in(l.." "):gmatch("\040\037\100\043\041 ")do if l then D.Persistent.ElvUIPaging.PagingStrings[t]=G D.Persistent.ElvUIPaging.PagingBars[tonumber(l)]=t end end end end end end local function h(l,t)local B=T(l)local G,k=s(l)local o if t then G,k=s(l,true)if K()>0 and((B<3 or B>6)and(D.Persistent.Player.Class[1]=="\082\111\103\117\101"or D.Persistent.Player.Class[1]=="\068\114\117\105\100"))then B=1 end o=M.Blizzard[B][2]elseif _G.Bartender4 then o=M.Bartender[1][2]elseif _G.Dominos then o=M.Dominos[B][2]elseif _G.ElvUI and _G.ElvUI[1].ActionBars then if _G.ElvUI[1].ActionBars.db then A(D.Persistent.Player.Class[2])if D.Persistent.ElvUIPaging.PagingBars[B]then B=D.Persistent.ElvUIPaging.PagingBars[B]end end o=M.ElvUI[B][2]else if K()>0 and((B<3 or B>6)and(D.Persistent.Player.Class[1]=="\082\111\103\117\101"or D.Persistent.Player.Class[1]=="\068\114\117\105\100"))then B=1 end o=M.Blizzard[B][2]end if o then return o:format(k)end return nil end local function u(l,t,D)local B=g[l][t]if not B then B={}g[l][t]=B end P(B,D)end local function J(l,t,D)local G=g[l][t]q(G,B.FindValueIndexInArray(G,D))end local function W(l)local t=p[l]if not t then return end local D,B=t.Type,t.ID local G=t.Text local k=t.Texture if k then J("\084\101\120\116\117\114\101",k,l)end if G then J("\084\101\120\116",G,l)end if B then if D=="\115\112\101\108\108"then J("\083\112\101\108\108",B,l)elseif D=="\105\116\101\109"then J("\073\116\101\109",B,l)elseif D=="\109\097\099\114\111"then J("\077\097\099\114\111",B,l)end end p[l]=nil end local function i(l)if not l or l<=0 or l>120 then return end W(l)if not E(l)then return end local t,D,G=R(l)if D then if t=="\115\112\101\108\108"then u("\083\112\101\108\108",D,l)elseif t=="\105\116\101\109"then u("\073\116\101\109",D,l)elseif t=="\109\097\099\114\111"then u("\077\097\099\114\111",D,l)end end local k=L(l)if k then u("\084\101\120\116\117\114\101",k,l)end local o=N(l)if o then u("\084\101\120\116",o,l)end local d=h(l)local e=d and V(d)or nil if e==nil then d=h(l,true)e=d and V(d)or nil end local I=e and B.ShortenHotKey(e)or nil p[l]={Slot=l,Type=t;ID=D,SubType=G,Texture=k,Text=o;CommandName=d,HotKey=I}end t:RegisterForEvent(function(l,t)i(t)end,"\065\067\084\073\079\078\066\065\082\095\083\076\079\084\095\067\072\065\078\071\069\068")t:RegisterForEvent(function()for l=1,120,1 do i(l)end end,"\090\079\078\069\095\067\072\065\078\071\069\068\095\078\069\087\095\065\082\069\065","\080\076\065\089\069\082\095\083\080\069\067\073\065\076\073\090\065\084\073\079\078\095\067\072\065\078\071\069\068","\080\076\065\089\069\082\095\084\065\076\069\078\084\095\085\080\068\065\084\069","\085\080\068\065\084\069\095\066\073\078\068\073\078\071\083","\076\069\065\082\078\069\068\095\083\080\069\076\076\095\073\078\095\084\065\066","\083\080\069\076\076\095\085\080\068\065\084\069\095\073\067\079\078","\085\080\068\065\084\069\095\083\072\065\080\069\083\072\073\070\084\095\070\079\082\077","\065\067\084\073\079\078\066\065\082\095\085\080\068\065\084\069\095\085\083\065\066\076\069")local function Q(l,t)local B=g[l][t]if not B then return end local G local k=K()if k>0 and(D.Persistent.Player.Class[1]=="\082\111\103\117\101"or D.Persistent.Player.Class[1]=="\068\114\117\105\100")then for l,t in pairs(B)do local D=1+((NUM_ACTIONBAR_PAGES+k)-1)*NUM_ACTIONBAR_BUTTONS local o=(NUM_ACTIONBAR_PAGES+k)*NUM_ACTIONBAR_BUTTONS if t>=D and t<=o then G=B[l]end end if not G then if#B==1 then G=B[1]else for l,t in pairs(B)do if t>12 then G=B[l]break end end end end if not G then G=B[1]end else G=B[1]end if G then return p[G]end end function w.FindByItemID(l)return Q("\073\116\101\109",l)end function w.FindByMacroID(l)return Q("\077\097\099\114\111",l)end function w.FindBySpellID(l)return Q("\083\112\101\108\108",l)end function w.FindByText(l)return Q("\084\101\120\116",l)end function w.FindByTextureID(l)return Q("\084\101\120\116\117\114\101",l)end do local function l(l,t,D)Y[l][t]=D end function w.WhitelistItemHotKey(t,D)l("\073\116\101\109",t,D)end function w.WhitelistMacroHotKey(t,D)l("\077\097\099\114\111",t,D)end function w.WhitelistSpellHotKey(t,D)l("\083\112\101\108\108",t,D)end function w.WhitelistTextHotKey(t,D)l("\084\101\120\116",t,D)end function w.WhitelistTextureHotKey(t,D)l("\084\101\120\116\117\114\101",t,D)end end do local function l(l,t)local D=Y[l][t]if D then return D end local B=Q(l,t)if B then return B.HotKey end return nil end function w.ItemHotKey(t)return l("\073\116\101\109",t)end function w.MacroHotKey(t)return l("\077\097\099\114\111",t)end function w.SpellHotKey(t)return l("\083\112\101\108\108",t)end function w.TextHotKey(t)return l("\084\101\120\116",t)end function w.TextureHotKey(t)return l("\084\101\120\116\117\114\101",t)end end function G.IsItemInActionRange(t,l)local D=l:ID()local B=w.FindByItemID(D)if not B then return false end return t:IsActionInRange(w.Slot)end function G.IsSpellInActionRange(t,l)local D=l:ID()local B=w.FindBySpellID(D)if not B then return false end return t:IsActionInRange(B.Slot)end