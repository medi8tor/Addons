local t,F=...local e=HeroDBC.DBC local B=HeroCache local a=error local m=setmetatable local O=string.format local v=table.insert local w=C_Item.GetItemInfo local s=C_Spell.GetSpellInfo local function o()local t={}t.__index=t m(t,{__call=function(t,...)local F={}m(F,t)F:New(...)return F end})return t end do local t=o()F.Unit=t function t.New(e,t,F)if type(t)~="\115\116\114\105\110\103"then a("\073\110\118\097\108\105\100 \085\110\105\116\073\068\046")end e.UnitID=t e.UseCache=F or false e:Init()end local e={}F.UnitGUIDMap=e function t.RemoveUnitGUIDMapEntry(t)if e[t.UnitGUID]and e[t.UnitGUID][t.UnitID]then e[t.UnitGUID][t.UnitID]=nil if next(e[t.UnitGUID])==nil then e[t.UnitGUID]=nil end end end function t.AddUnitGUIDMapEntry(t)if not t.UnitGUID or not t.UnitID then return end if not e[t.UnitGUID]then e[t.UnitGUID]={}end if not e[t.UnitGUID][t.UnitID]then e[t.UnitGUID][t.UnitID]=t end end function t.Init(t)t:RemoveUnitGUIDMapEntry()t.UnitExists=false t.UnitGUID=nil t.UnitNPCID=nil t.UnitName=nil t.UnitCanBeAttacked=false end t.Player=t("\112\108\097\121\101\114",true)t.Pet=t("\112\101\116")t.Target=t("\116\097\114\103\101\116",true)t.Focus=t("\102\111\099\117\115",true)t.MouseOver=t("\109\111\117\115\101\111\118\101\114")t.Vehicle=t("\118\101\104\105\099\108\101")local B={{"\065\114\101\110\097";5,true},{"\066\111\115\115",4,true};{"\078\097\109\101\112\108\097\116\101",F.MAXIMUM,true};{"\080\097\114\116\121",4,true};{"\082\097\105\100",40;true}}for F,e in pairs(B)do local B=e[1]local a=e[2]local m=e[3]t[B]={}for F=1,a,1 do local e=O("\037\115\037\100",B,F)t[B][e:lower()]=t(e,m)end end end do local t=o()F.Spell=t function t.New(e,t,F)if type(t)~="\110\117\109\098\101\114"then a("\073\110\118\097\108\105\100 \083\112\101\108\108\073\068\046")end if F and type(F)~="\115\116\114\105\110\103"then a("\073\110\118\097\108\105\100 \083\112\101\108\108 \084\121\112\101\046")end if t>=999900 then e.SpellID=t e.SpellType="\080\108\097\121\101\114"e.SpellName="\067\117\115\116\111\109 \083\112\101\108\108 \069\110\116\114\121"e.MinimumRange=0 e.MaximumRange=0 e.IsMelee=true e.LastCastTime=0 e.LastDisplayTime=0 e.LastHitTime=0 e.LastAppliedOnPlayerTime=0 e.LastRemovedFromPlayerTime=0 else local F=s(t)if not F then return end e.SpellID=F.spellID e.SpellType=F.spellType or"\080\108\097\121\101\114"e.SpellName=F.name e.MinimumRange=F.minRange e.MaximumRange=F.maxRange e.IsMelee=MinimumRange==0 and MaximumRange==0 e.LastCastTime=0 e.LastDisplayTime=0 e.LastHitTime=0 e.LastAppliedOnPlayerTime=0 e.LastRemovedFromPlayerTime=0 end end end do local t=o()F.MultiSpell=t function t.New(e,...)local B={...}e.SpellTable={}for t,B in pairs(B)do if type(B)=="\110\117\109\098\101\114"then B=F.Spell(B)end if type(B.SpellID)~="\110\117\109\098\101\114"then a("\073\110\118\097\108\105\100 \083\112\101\108\108\073\068\046")end v(e.SpellTable,B)end function t.Update(t)for F,e in pairs(t.SpellTable)do if e:IsLearned()or F==#t.SpellTable then e.Update=t.Update m(t,{__index=e})break end end end e:AddToMultiSpells()e:Update()end end do local t={[""]=nil,INVTYPE_AMMO={0},INVTYPE_HEAD={1};INVTYPE_NECK={2};INVTYPE_SHOULDER={3};INVTYPE_BODY={4},INVTYPE_CHEST={5},INVTYPE_ROBE={5};INVTYPE_WAIST={6},INVTYPE_LEGS={7};INVTYPE_FEET={8};INVTYPE_WRIST={9};INVTYPE_HAND={10},INVTYPE_FINGER={11;12},INVTYPE_TRINKET={13,14};INVTYPE_CLOAK={15};INVTYPE_WEAPON={16,17};INVTYPE_SHIELD={17},INVTYPE_2HWEAPON={16};INVTYPE_WEAPONMAINHAND={16},INVTYPE_WEAPONOFFHAND={17};INVTYPE_HOLDABLE={17},INVTYPE_RANGED={18},INVTYPE_THROWN={18},INVTYPE_RANGEDRIGHT={18},INVTYPE_RELIC={18};INVTYPE_TABARD={19},INVTYPE_BAG={20,21;22;23};INVTYPE_QUIVER={20,21,22;23}}local B=o()F.Item=B function B.New(O,B,m)if type(B)~="\110\117\109\098\101\114"then a("\073\110\118\097\108\105\100 \073\116\101\109\073\068\046")end if m and type(m)~="\116\097\098\108\101"then a("\073\110\118\097\108\105\100 \073\116\101\109\083\108\111\116\073\068\115\046")end local v,s,o,c,f,V,h,x,z=w(B)O.ItemID=B O.ItemName=v O.ItemRarity=o O.ItemLevel=c O.ItemMinLevel=f O.ItemSlotIDs=m or t[z]O.ItemUseSpell=e.ItemSpell[B]and F.Spell(e.ItemSpell[B])or nil O.LastDisplayTime=0 O.LastHitTime=0 end end