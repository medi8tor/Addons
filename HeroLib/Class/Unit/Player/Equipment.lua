local c,W=...local e,N=HeroCache,W.Utils local o=W.Unit local t,q,d=o.Player,o.Pet,o.Target local K,J=o.Focus,o.MouseOver local v,P,h=o.Arena,o.Boss,o.Nameplate local O,k=o.Party,o.Raid local V=W.Spell local l=W.Item local R=GetInventoryItemID local m=GetProfessionInfo local H=GetProfessions local I=select local w=wipe local E={}local M={}local a={[29]={[1]={[1]=200426;[3]=200428;[5]=200423;[7]=200427;[10]=200425};[2]={[1]=200417,[3]=200419;[5]=200414;[7]=200418;[10]=200416},[3]={[1]=200390,[3]=200392,[5]=200387;[7]=200391;[10]=200389};[4]={[1]=200372;[3]=200374;[5]=200369;[7]=200373;[10]=200371},[5]={[1]=200327;[3]=200329;[5]=200324,[7]=200328;[10]=200326},[6]={[1]=200408;[3]=200410;[5]=200405,[7]=200409,[10]=200407},[7]={[1]=200399,[3]=200401;[5]=200396,[7]=200400;[10]=200398},[8]={[1]=200318;[3]=200320;[5]=200315;[7]=200319;[10]=200317},[9]={[1]=200336,[3]=200338;[5]=200333,[7]=200337;[10]=200335},[10]={[1]=200363,[3]=200365;[5]=200360;[7]=200364,[10]=200362};[11]={[1]=200354,[3]=200356;[5]=200351,[7]=200355;[10]=200353};[12]={[1]=200345,[3]=200347,[5]=200342,[7]=200346,[10]=200344},[13]={[1]=200381,[3]=200383;[5]=200378;[7]=200382;[10]=200380}},[30]={[1]={[1]=202443,[3]=202441,[5]=202446,[7]=202442,[10]=202444};[2]={[1]=202452;[3]=202450,[5]=202455,[7]=202451;[10]=202453},[3]={[1]=202479,[3]=202477;[5]=202482;[7]=202478,[10]=202480},[4]={[1]=202497;[3]=202495;[5]=202500;[7]=202496;[10]=202498};[5]={[1]=202542,[3]=202540,[5]=202545;[7]=202541,[10]=202543};[6]={[1]=202461;[3]=202459,[5]=202464;[7]=202460;[10]=202462};[7]={[1]=202470;[3]=202468,[5]=202473;[7]=202469,[10]=202471};[8]={[1]=202551;[3]=202549;[5]=202554,[7]=202550;[10]=202552};[9]={[1]=202533,[3]=202531;[5]=202536,[7]=202532,[10]=202534};[10]={[1]=202506,[3]=202504,[5]=202509,[7]=202505,[10]=202507},[11]={[1]=202515;[3]=202513;[5]=202518;[7]=202514;[10]=202516};[12]={[1]=202524,[3]=202522;[5]=202527;[7]=202523,[10]=202525};[13]={[1]=202488,[3]=202486;[5]=202491,[7]=202487;[10]=202489}};[31]={[1]={[1]=207182,[3]=207180,[5]=207185,[7]=207181;[10]=207183};[2]={[1]=207191;[3]=207189;[5]=207194;[7]=207190;[10]=207192},[3]={[1]=207218;[3]=207216;[5]=207221,[7]=207217,[10]=207219},[4]={[1]=207236;[3]=207234,[5]=207239,[7]=207235;[10]=207237},[5]={[1]=207281,[3]=207279,[5]=207284,[7]=207280,[10]=207282},[6]={[1]=207200,[3]=207198,[5]=207203,[7]=207199,[10]=207201};[7]={[1]=207209;[3]=207207;[5]=207212;[7]=207208;[10]=207210},[8]={[1]=207290,[3]=207288;[5]=207293,[7]=207289,[10]=207291};[9]={[1]=207272;[3]=207270,[5]=207275,[7]=207271;[10]=207273};[10]={[1]=207245;[3]=207243;[5]=207248,[7]=207244,[10]=207246},[11]={[1]=207254,[3]=207252,[5]=207257;[7]=207253,[10]=207255};[12]={[1]=207263,[3]=207261,[5]=207266;[7]=207262;[10]=207264},[13]={[1]=207227;[3]=207225;[5]=207230;[7]=207226;[10]=207228}},DFS4={[1]={[1]=217218;[3]=217220;[5]=217216;[7]=217219,[10]=217217};[2]={[1]=217198,[3]=217200,[5]=217196;[7]=217199,[10]=217197},[3]={[1]=217183,[3]=217185,[5]=217181,[7]=217184,[10]=217182},[4]={[1]=217208;[3]=217210,[5]=217206,[7]=217209;[10]=217207};[5]={[1]=217202,[3]=217204;[5]=217205,[7]=217203,[10]=217201},[6]={[1]=217223,[3]=217225;[5]=217221;[7]=217224;[10]=217222},[7]={[1]=217238,[3]=217240;[5]=217236,[7]=217239;[10]=217237};[8]={[1]=217232;[3]=217234,[5]=217235;[7]=217233,[10]=217231},[9]={[1]=217212;[3]=217214;[5]=217215,[7]=217213;[10]=217211};[10]={[1]=217188;[3]=217190,[5]=217186;[7]=217189,[10]=217187};[11]={[1]=217193,[3]=217195,[5]=217191,[7]=217194;[10]=217192};[12]={[1]=217228,[3]=217230;[5]=217226,[7]=217229,[10]=217227},[13]={[1]=217178,[3]=217180,[5]=217176,[7]=217179,[10]=217177}},TWW1={[1]={[1]=211984,[3]=211982,[5]=211987;[7]=211983,[10]=211985},[2]={[1]=211993,[3]=211991,[5]=211996;[7]=211992,[10]=211994},[3]={[1]=212020;[3]=212018,[5]=212023;[7]=212019;[10]=212021};[4]={[1]=212038,[3]=212036;[5]=212041,[7]=212037,[10]=212039},[5]={[1]=212083,[3]=212081;[5]=212086;[7]=212082,[10]=212084};[6]={[1]=212002,[3]=212000,[5]=212005;[7]=212001,[10]=212003},[7]={[1]=212011,[3]=212009;[5]=212014,[7]=212010;[10]=212012},[8]={[1]=212092;[3]=212090;[5]=212095;[7]=212091;[10]=212093};[9]={[1]=212074;[3]=212072,[5]=212077;[7]=212073,[10]=212075};[10]={[1]=212047;[3]=212045;[5]=212050,[7]=212046;[10]=212048};[11]={[1]=212056,[3]=212054,[5]=212059;[7]=212055,[10]=212057};[12]={[1]=212065;[3]=212063,[5]=212068;[7]=212064,[10]=212066};[13]={[1]=212029;[3]=212027,[5]=212032,[7]=212028,[10]=212030}}}local Q={201807;205708;209343;216279,218713}local j={[208321]=true}function t.GetEquipment(c)return E end function t.GetOnUseItems(c)return M end function t.GetTrinketItems(c)local W=t:GetEquipment()local e=W[13]and l(W[13])or l(0)local N=W[14]and l(W[14])or l(0)return e,N end function t.GetTrinketData(W,c)local e=t:GetEquipment()local N=e[13]and l(e[13])or l(0)local o=e[14]and l(e[14])or l(0)local q=N:OnUseSpell()local d=o:OnUseSpell()local K=q and q:ID()or 0 local J=d and d:ID()or 0 local v=(q and(q.MaximumRange>0 and q.MaximumRange<=100))and q.MaximumRange or 100 local P=(d and(d.MaximumRange>0 and d.MaximumRange<=100))and d.MaximumRange or 100 local h=q and q:CastTime()or 0 local O=d and d:CastTime()or 0 local k=N:IsUsable()local V=o:IsUsable()local R=false local m=false if c then for c,W in pairs(c)do if W and N:ID()==W then R=true end if W and o:ID()==W then m=true end end end local H={Object=N;ID=N:ID(),Level=N:Level(),Spell=q,SpellID=K;Range=v,Usable=k,CastTime=h;Cooldown=N:Cooldown();Blacklisted=t:IsItemBlacklisted(N)or R}local I={Object=o;ID=o:ID(),Level=o:Level(),Spell=d;SpellID=J;Range=P;Usable=V;CastTime=O;Cooldown=o:Cooldown(),Blacklisted=t:IsItemBlacklisted(o)or m}return H,I end function t.UpdateEquipment(c)w(E)w(M)for c=1,19,1 do local W=I(1,R("\112\108\097\121\101\114",c))if W~=nil then E[c]=W local e if c==13 or c==14 then e=l(W,{c})else e=l(W)end if e:OnUseSpell()or j[W]then table.insert(M,e)end end end local W=e.Persistent.Player.Class[3]local N for c in pairs(a)do e.Persistent.TierSets[c]={}e.Persistent.TierSets[c]["\050\112\099"]=false e.Persistent.TierSets[c]["\052\112\099"]=false local o=0 for c,W in pairs(a[c][W])do N=E[c]if N and N==W then o=o+1 end end if o>=2 then e.Persistent.TierSets[c]["\050\112\099"]=true end if o>=4 then e.Persistent.TierSets[c]["\052\112\099"]=true end end c:RegisterListenedItemSpells()end do local c={[215133]=true,[218422]=true;[218716]=true,[218717]=true;[219381]=true,[219931]=true;[221805]=true;[221806]=true;[221807]=true,[221808]=true,[217155]=true,[217156]=true;[217157]=true,[217158]=true,[207783]=true,[204388]=true,[201962]=true,[203729]=true;[200563]=true;[193000]=true,[193757]=true,[202612]=true;[209948]=true,[195220]=true,[198322]=true,[198327]=true;[198332]=true;[198333]=true}local e={[221801]=true,[221802]=true;[221803]=true,[221804]=true;[225642]=true;[225643]=true;[225644]=true,[225645]=true;[217151]=true;[217152]=true;[217153]=true;[217154]=true,[198323]=true;[198324]=true;[198325]=true,[198326]=true,[198328]=true;[198329]=true;[198330]=true,[198331]=true,[205278]=true,[205279]=true;[205280]=true,[205281]=true}local N={BottledFlayedwingToxin=l(178742,{13,14}),GlobeofJaggedIce=l(193732,{13,14});TreemouthsFesteringSplinter=l(193652,{13,14});ConcoctionKissofDeath=l(215174,{13;14}),KahetiEmblem=l(225651,{13;14})}local o={FlayedwingToxinBuff=V(345545);SkeweringColdDebuff=V(388929),ConcoctionKissofDeathBuff=V(435493);KahetiEmblemBuff=V(455464)}local q={[207172]=10}local function K(c)if not c then return false end local e=c:ID()if W.GUISettings.General.Blacklist.ItemUserDefined[e]then if type(W.GUISettings.General.Blacklist.ItemUserDefined[e])=="\098\111\111\108\101\097\110"then return true else return W.GUISettings.General.Blacklist.ItemUserDefined[e](c)end end return false end function t.IsItemBlacklisted(q,W)if K(W)or not W:SlotIDs()then return true end local J=W:ID()local v=(W:SlotIDs())[1]if v==19 or v==4 then return true end if J==N.BottledFlayedwingToxin:ID()then return t:BuffUp(o.FlayedwingToxinBuff)end if J==N.GlobeofJaggedIce:ID()then return d:DebuffStack(o.SkeweringColdDebuff)<4 end if J==N.TreemouthsFesteringSplinter:ID()then return not(t:IsTankingAoE(8)or t:IsTanking(d))end if J==N.ConcoctionKissofDeath:ID()then return t:BuffUp(o.ConcoctionKissofDeathBuff)end if J==N.KahetiEmblem:ID()then return t:BuffStack(o.KahetiEmblemBuff)<4 and not(t:BuffUp(o.KahetiEmblemBuff)and t:BuffRemains(o.KahetiEmblemBuff)<3)or t:BuffDown(o.KahetiEmblemBuff)end if c[J]then return true end for c,W in pairs({H()})do local N=m(W)if N=="\069\110\103\105\110\101\101\114\105\110\103"then if v==6 or v==15 then return true end if e[J]then return true end end end return false end function t.GetUseableItems(N,c,W,e)for N,o in ipairs(M)do local d=o:ID()local K=false if W and E[W]~=d then K=true elseif e and(E[13]==d or E[14]==d)then K=true elseif o:IsReady()and not t:IsItemBlacklisted(o)then for W=1,#c,1 do if c[W]==d then K=true break end end if not K then local c=(o:SlotIDs())[1]local W=o:OnUseSpell()local e=(W and(W.MaximumRange>0 and W.MaximumRange<=100))and W.MaximumRange or 100 if q[d]then e=q[d]end return o,c,e end end end return nil end end function t.HasTier(N,c,W)local o={[1]={[71]=29;[72]=30,[73]=31},[2]={[66]=29;[70]=31},[3]={[253]=31;[254]=31,[255]=29};[4]={[259]=31,[260]=31;[261]=31},[5]={[258]=30},[6]={[250]=30;[251]=30,[252]=31};[7]={[262]=31;[263]=31},[8]={[62]=31;[63]=30,[64]=31},[9]={[265]=31,[266]=31;[267]=29},[10]={[268]=31;[269]=29};[11]={[102]=29,[103]=31;[104]=30};[12]={[577]=31;[581]=31};[13]={[1467]=30,[1473]=31}}local t=e.Persistent.Player.Class[3]local q=e.Persistent.Player.Spec[1]if o[t][q]and o[t][q]==c then return e.Persistent.TierSets[c][W.."\112\099"]or e.Persistent.TierSets.DFS4[W.."\112\099"]else return e.Persistent.TierSets[c][W.."\112\099"]end end function t.GladiatorsBadgeIsEquipped(c)local W,e=t:GetTrinketItems()for c,N in pairs(Q)do if W:ID()==N or e:ID()==N then return true end end return false end