local u,j=...local R=HeroLib local h,Y=HeroCache,R.Utils local C=R.Unit local q=C.Player local G=C.Target local a=R.Spell local g=R.Item local z=math.min local Z=print local l=select local A=string.lower local c=strsplit local P=tostring local N=GetTime local n=C_Item.GetItemInfo local E=C_AddOns.GetAddOnMetadata local X=C_Spell.GetSpellTexture local x=C_AddOns.IsAddOnLoaded local b=j.CDsON()HeroRotation=j.CDsON function b.Print(...)Z("\091\124\099\070\070\070\070\054\054\048\048\072\101\114\111 \082\111\116\097\116\105\111\110\124\114\093",...)end b.APLs={}b.APLInits={}b.PreAPLs={}function b.SetAPL(u,j,R,h)b.APLs[u]=j b.APLInits[u]=R b.PreAPLs[u]=h end function b.GetTexture(u)local j=u.SpellID if j then local R=h.Persistent.Texture.Spell if not R[j]then if j>=999900 then R[j]="\073\110\116\101\114\102\097\099\101\092\065\100\100\111\110\115\092\072\101\114\111\082\111\116\097\116\105\111\110\092\084\101\120\116\117\114\101\115\092"..P(j)elseif u.TextureSpellID then R[j]=X(u.TextureSpellID)else R[j]=X(j)end end return R[j]end local R=u.ItemID if R then local u=h.Persistent.Texture.Item if not u[R]then local j,h,Y,C,q,G,a,g,z,Z=n(R)u[R]=Z end return u[R]end end local W=a(61304)local U,V,F local function t(u,j,R)local h,Y local C=N()if q:IsCasting()or q:IsChanneling()then h=q:CastStart()Y=q:CastDuration()else _,h,_,Y=W:CooldownInfo()end if U~=u then U=u V=C F=0 end if j then local j if R then j=R else local R=u:CostInfo(nil,"\116\121\112\101")if R then j=q.TimeToXResourceMap[R](u:Cost())end end if j and j>0 then if j>(h+Y)-C then local u=(C-V)+j if F==0 and u>.25 or F>u or u-F>.5 then F=u end h=V Y=F end end end if h+Y<C then h=0 Y=0 U=nil end b.MainIconFrame:SetCooldown(h,Y)end local d=0 local function s(u)if x("\083\112\101\108\108\070\108\097\115\104\067\111\114\101")then local j=u.SpellID local R=u.ItemID local h=.5 if j and N()-d>h then SpellFlashCore.FlashAction(j)d=N()elseif R and N()-d>h then SpellFlashCore.FlashItem(R)d=N()end end end local B=b.GUISettingsGet()b.CastOffGCDOffset=1 function b.Cast(u,j,h,Y,C)local G=b.GetTexture(u)local a=not B.General.HideKeyBinds and R.Action.TextureHotKey(G)s(u)local g=q:GetEquipment()local z,Z=g[13],g[14]local l=u:ID()if z and l==z then l=13 elseif Z and l==Z then l=14 end if j or h=="\067\111\111\108\100\111\119\110"then if b.CastOffGCDOffset==1 or b.CastOffGCDOffset==2 and b.SmallIconFrame:GetIcon(1)~=G then b.SmallIconFrame:ChangeIcon(b.CastOffGCDOffset,G,a,Y,l)b.CastOffGCDOffset=b.CastOffGCDOffset+1 u.LastDisplayTime=N()end elseif h=="\083\117\103\103\101\115\116\101\100"then b.CastSuggested(u,Y)elseif h=="\083\117\103\103\101\115\116\101\100\082\105\103\104\116"then b.CastRightSuggested(u,Y)end local A=(u.SpellID==999910 or u:IsUsable())and not h=="\080\111\111\108\105\110\103"local c=h=="\080\111\111\108\105\110\103"t(u,c,C)b.MainIconFrame:ChangeIcon(G,a,A,Y,l)u.LastDisplayTime=N()return true end function b.CastMacro(u,j,R,h)if j then if b.CastOffGCDOffset==1 or b.CastOffGCDOffset==2 and b.SmallIconFrame:GetIcon(1)~=134400 then b.SmallIconFrame:ChangeIcon(b.CastOffGCDOffset,134400,nil,R,u)b.CastOffGCDOffset=b.CastOffGCDOffset+1 Object.LastDisplayTime=N()end end local Y=h and b.GetTexture(h)or 134400 b.MainIconFrame:ChangeIcon(Y,"\077\097\099\114\111"..u,true,R,u)return true end function b.CastAnnotated(u,j,R,h,Y)local C=b.Cast(u,j,nil,h)if not j then b.MainIconFrame:OverlayText(R,Y)end return C end function b.CastPooling(u,j,R)return b.Cast(u,false,"\080\111\111\108\105\110\103",R,j)end local k,H,O,r b.MaxQueuedCasts=3 local function K(...)k={...}H=z(#k,b.MaxQueuedCasts)O={}r={}for u=1,H,1 do O[u]=b.GetTexture(k[u])k[u].LastDisplayTime=N()r[u]=not B.General.HideKeyBinds and R.Action.TextureHotKey(O[u])end s(k[1])b.MainIconFrame:ChangeIcon(O[1],r[1],k[1]:IsUsable(),false,k[1]:ID())b.MainIconFrame:SetupParts(O,r)end function b.CastQueue(...)K(...)t()return"\083\104\111\117\108\100 \082\101\116\117\114\110"end function b.CastQueuePooling(u,...)K(...)if u then t(k[1],true,u)else local u,j=nil,0 for R=1,#k,1 do if k[R]:Cost()>j then j=k[R]:Cost()u=k[R]end end t(u,true)end return"\083\104\111\117\108\100 \082\101\116\117\114\110"end b.CastLeftOffset=1 function b.CastLeftCommon(u)local j=b.GetTexture(u)local h=not B.General.HideKeyBinds and R.Action.TextureHotKey(j)s(u)b.LeftIconFrame:ChangeIcon(j,h)b.CastLeftOffset=b.CastLeftOffset+1 u.LastDisplayTime=N()end function b.CastLeft(u)if b.CastLeftOffset==1 then b.CastLeftCommon(u)end return false end function b.CastLeftNameplate(u,j,R)if b.CastLeftOffset==1 and b.Nameplate.AddIcon(u,j,R)then b.CastLeftCommon(j)end return false end function b.CastMainNameplate(u,j,R)if b.Nameplate.AddIcon(u,j,R)then return b.Cast(j)end return false end function b.CastMainNameplateSuggested(u,j)if b.Nameplate.AddSuggestedIcon(u,j)then return b.CastRightSuggested(j)end return false end b.CastSuggestedOffset=1 function b.CastSuggested(u,j)if b.CastSuggestedOffset==1 then local h=b.GetTexture(u)local Y=not B.General.HideKeyBinds and R.Action.TextureHotKey(h)s(u)b.SuggestedIconFrame:ChangeIcon(h,Y,j,u:ID())b.CastSuggestedOffset=b.CastSuggestedOffset+1 u.LastDisplayTime=N()end return false end b.CastRightSuggestedOffset=1 function b.CastRightSuggested(u,j)if b.CastRightSuggestedOffset==1 then local h=b.GetTexture(u)local Y=not B.General.HideKeyBinds and R.Action.TextureHotKey(h)s(u)b.RightSuggestedIconFrame:ChangeIcon(h,Y,j,u:ID())b.CastRightSuggestedOffset=b.CastRightSuggestedOffset+1 u.LastDisplayTime=N()end return false end function b.CmdHandler(u)local j,R,h,Y=c(" ",A(u))if j=="\099\100\115"then HeroRotationCharDB.Toggles[1]=not HeroRotationCharDB.Toggles[1]b.ToggleIconFrame:UpdateButtonText(1)b.Print("\067\068\115 \097\114\101 \110\111\119 "..(HeroRotationCharDB.Toggles[1]and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\097\111\101"then HeroRotationCharDB.Toggles[2]=not HeroRotationCharDB.Toggles[2]b.ToggleIconFrame:UpdateButtonText(2)b.Print("\065\111\069 \105\115 \110\111\119 "..(HeroRotationCharDB.Toggles[2]and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\116\111\103\103\108\101"then HeroRotationCharDB.Toggles[3]=not HeroRotationCharDB.Toggles[3]b.ToggleIconFrame:UpdateButtonText(3)b.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \105\115 \110\111\119 "..(HeroRotationCharDB.Toggles[3]and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\111\110"then HeroRotationCharDB.Toggles[3]=true b.ToggleIconFrame:UpdateButtonText(3)b.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \105\115 \110\111\119 "..(HeroRotationCharDB.Toggles[3]and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\111\102\102"then HeroRotationCharDB.Toggles[3]=false b.ToggleIconFrame:UpdateButtonText(3)b.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \105\115 \110\111\119 "..(HeroRotationCharDB.Toggles[3]and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\112\097\117\115\101"and R then b.Timer.Pause(tonumber(R))elseif j=="\115\101\116\116\105\110\103\115"then(b.HRGUIGet()).SettingsShow()elseif j=="\117\110\108\111\099\107"then b.MainFrame:Unlock()b.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \085\073 \105\115 \110\111\119 \124\099\102\102\048\048\102\102\048\048\117\110\108\111\099\107\101\100\124\114\046")elseif j=="\108\111\099\107"then b.MainFrame:Lock()b.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \085\073 \105\115 \110\111\119 \124\099\102\102\102\102\048\048\048\048\108\111\099\107\101\100\124\114\046")elseif j=="\099\097\115\116"then if R then if Y then Y=tonumber(Y)end if h then h=string.lower(h)=="\112\108\097\121\101\114\050"and"\080\076\065\089\069\082"or string.upper(h)end b.CastFunction(tonumber(R),h,Y)end elseif j=="\115\099\097\108\101"then if R and h then h=tonumber(h)if h and(type(h)=="\110\117\109\098\101\114"and(h>0 and h<=10))then if R=="\117\105"then b.MainFrame:ResizeUI(h)elseif R=="\098\117\116\116\111\110\115"then b.MainFrame:ResizeButtons(h)elseif R=="\097\108\108"then b.MainFrame:ResizeUI(h)b.MainFrame:ResizeButtons(h)else b.Print("\073\110\118\097\108\105\100 \124\099\102\102\056\056\102\102\056\056\091\084\121\112\101\093\124\114 \102\111\114 \083\099\097\108\101\046")b.Print("\083\104\111\117\108\100 \098\101 \124\099\102\102\056\056\056\056\102\102\047\104\114 \115\099\097\108\101\124\114 \124\099\102\102\056\056\102\102\056\056\091\084\121\112\101\093\124\114 \124\099\102\102\102\102\056\056\056\056\091\083\105\122\101\093\124\114\046")b.Print("\084\121\112\101 \097\099\099\101\112\116\101\100 \097\114\101 \124\099\102\102\056\056\102\102\056\056\117\105\124\114\044 \124\099\102\102\056\056\102\102\056\056\098\117\116\116\111\110\115\124\114\044 \124\099\102\102\056\056\102\102\056\056\097\108\108\124\114\046")end else b.Print("\073\110\118\097\108\105\100 \124\099\102\102\102\102\056\056\056\056\091\083\105\122\101\093\124\114 \102\111\114 \083\099\097\108\101\046")b.Print("\083\104\111\117\108\100 \098\101 \124\099\102\102\056\056\056\056\102\102\047\104\114 \115\099\097\108\101\124\114 \124\099\102\102\056\056\102\102\056\056\091\084\121\112\101\093\124\114 \124\099\102\102\102\102\056\056\056\056\091\083\105\122\101\093\124\114\046")b.Print("\083\105\122\101 \097\099\099\101\112\116\101\100 \097\114\101 \124\099\102\102\102\102\056\056\056\056\110\117\109\098\101\114 \062 \048 \097\110\100 \060\061 \049\048\124\114\046")end else b.Print("\073\110\118\097\108\105\100 \097\114\103\117\109\101\110\116\115 \102\111\114 \083\099\097\108\101\046")b.Print("\083\104\111\117\108\100 \098\101 \124\099\102\102\056\056\056\056\102\102\047\104\114 \115\099\097\108\101\124\114 \124\099\102\102\056\056\102\102\056\056\091\084\121\112\101\093\124\114 \124\099\102\102\102\102\056\056\056\056\091\083\105\122\101\093\124\114\046")b.Print("\084\121\112\101 \097\099\099\101\112\116\101\100 \097\114\101 \124\099\102\102\056\056\102\102\056\056\117\105\124\114\044 \124\099\102\102\056\056\102\102\056\056\098\117\116\116\111\110\115\124\114\044 \124\099\102\102\056\056\102\102\056\056\097\108\108\124\114\046")b.Print("\083\105\122\101 \097\099\099\101\112\116\101\100 \097\114\101 \124\099\102\102\102\102\056\056\056\056\110\117\109\098\101\114 \062 \048 \097\110\100 \060\061 \049\048\124\114\046")end elseif j=="\114\101\115\101\116\098\117\116\116\111\110\115"then b.ToggleIconFrame:ResetAnchor()elseif j=="\100\101\098\117\103"then HeroRotationCharDB.Toggles[4]=not HeroRotationCharDB.Toggles[4]b.Print("\068\101\098\117\103 \079\117\116\112\117\116 \105\115 \110\111\119 "..(HeroRotationCharDB.Toggles[4]==true and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\102\108\097\115\104"then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]b.Print("\073\099\111\110 \070\108\097\115\104\105\110\103 \105\115 \110\111\119 "..(HeroRotationCharDB.Toggles[5]==true and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046"))elseif j=="\104\101\108\112"then b.Print("\124\099\102\102\102\102\102\102\048\048--\091\084\111\103\103\108\101\115\093--\124\114")b.Print("  \079\110\047\079\102\102\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \116\111\103\103\108\101\124\114")b.Print("  \067\068\115\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \099\100\115\124\114")b.Print("  \065\111\069\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \097\111\101\124\114")b.Print("  \068\101\098\117\103\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \100\101\098\117\103\124\114")b.Print("  \070\108\097\115\104\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \102\108\097\115\104\124\114")b.Print("\124\099\102\102\102\102\102\102\048\048--\091\085\115\101\114 \073\110\116\101\114\102\097\099\101\093--\124\114")b.Print("  \085\073 \076\111\099\107\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \108\111\099\107\124\114")b.Print("  \085\073 \085\110\108\111\099\107\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \117\110\108\111\099\107\124\114")b.Print("  \085\073 \083\099\097\108\101\058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \115\099\097\108\101\124\114 \124\099\102\102\056\056\102\102\056\056\091\084\121\112\101\093\124\114 \124\099\102\102\102\102\056\056\056\056\091\083\105\122\101\093\124\114")b.Print("    \091\084\121\112\101\093\058 \124\099\102\102\056\056\102\102\056\056\117\105\124\114\044 \124\099\102\102\056\056\102\102\056\056\098\117\116\116\111\110\115\124\114\044 \124\099\102\102\056\056\102\102\056\056\097\108\108\124\114")b.Print("    \091\083\105\122\101\093\058 \124\099\102\102\102\102\056\056\056\056\110\117\109\098\101\114 \062 \048 \097\110\100 \060\061 \049\048\124\114")b.Print("  \066\117\116\116\111\110 \065\110\099\104\111\114 \082\101\115\101\116 \058 \124\099\102\102\056\056\056\056\102\102\047\104\114 \114\101\115\101\116\098\117\116\116\111\110\115\124\114")elseif not b.CmdHandlerCust(j)then b.Print("\073\110\118\097\108\105\100 \097\114\103\117\109\101\110\116\115\046")b.Print("\084\121\112\101 \124\099\102\102\056\056\056\056\102\102\047\104\114 \104\101\108\112\124\114 \102\111\114 \109\111\114\101 \105\110\102\111\115\046")end end b.CmdHandlerPar={}b.CmdHandlerName={}function b.CmdHandlerCust(u)if b.CmdHandlerPar[u]then local j=b.CmdHandlerPar[u]HeroRotationCharDB.Toggles[j+2]=not HeroRotationCharDB.Toggles[j+2]b.ToggleIconFrame:UpdateButtonText(j,2)b.Print(b.CmdHandlerName[u]..(" \097\114\101 \110\111\119 "..(HeroRotationCharDB.Toggles[j+2]and"\124\099\102\102\048\048\102\102\048\048\101\110\097\098\108\101\100\124\114\046"or"\124\099\102\102\102\102\048\048\048\048\100\105\115\097\098\108\101\100\124\114\046")))return true end end SLASH_HEROROTATION1="\047\104\114"SLASH_HEROROTATION2="\047\097\114"SlashCmdList.HEROROTATION=b.CmdHandler function b.ResetToggle()b.CmdHandlerPar={}b.CmdHandlerName={}local u={b.ToggleIconFrame:GetChildren()}for u,j in ipairs(u)do if u>3 then j:Hide()end end end function b.CDsON()return HeroRotationCharDB.Toggles[1]end function b.DebugON()return HeroRotationCharDB.Toggles[4]end function b.FlashON()return HeroRotationCharDB.Toggles[5]end do local u={[120651]=true}function b.AoEON()if not q:AffectingCombat()then if GetCVar("\110\097\109\101\112\108\097\116\101\083\104\111\119\065\108\108")~="\049"then SetCVar("\110\097\109\101\112\108\097\116\101\083\104\111\119\065\108\108",1)end if GetCVar("\110\097\109\101\112\108\097\116\101\083\104\111\119\069\110\101\109\105\101\115")~="\049"then SetCVar("\110\097\109\101\112\108\097\116\101\083\104\111\119\069\110\101\109\105\101\115",1)Z("\069\110\101\109\121 \110\097\109\101\112\108\097\116\101\115 \115\104\111\117\108\100 \098\101 \101\110\097\098\108\101\100")end end return HeroRotationCharDB.Toggles[2]and not u[G:NPCID()]end end function b.ON()return HeroRotationCharDB.Toggles[3]end function b.Locked()return(b.GetSavedVariables()).Locked end