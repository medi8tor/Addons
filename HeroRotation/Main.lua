local A,Q=...local T=HeroLib local v=HeroCache local n=T.Unit local w=n.Player local t=n.Target local U=T.Spell local x=T.Item local I=T.GUI local k=I.CreatePanelOption local m local B=C_AddOns.IsAddOnLoaded local z=C_AddOns.LoadAddOn local r=math.max local g=math.min local s=pairs local e=select local p local d={}local F local S local q,Y local V=Q.CDsON()V.loadedB=false local function a(A,Q)if Q then A.__MSQ_Normal:Hide()A.Texture:SetAllPoints(A)if A.CooldownFrame then A.CooldownFrame:SetAllPoints(A)end if A.Backdrop then A.Backdrop:Show()A.Backdrop:SetFrameLevel(g(A.Backdrop:GetFrameLevel(),7))end else if A.Backdrop then A.Backdrop:Hide()end end end local function b(A,Q,T,v,n,w,t,U)if A==V and(d and S)then local A=S[Q]if A then if type(A.Icon)=="\116\097\098\108\101"then for A,Q in s(A.Icon)do a(Q,U)end else a(A,U)end end end end BINDING_HEADER_HEROROTATION="\072\101\114\111\082\111\116\097\116\105\111\110"BINDING_NAME_HEROROTATION_CDS="\084\111\103\103\108\101 \067\068\115"BINDING_NAME_HEROROTATION_AOE="\084\111\103\103\108\101 \065\111\069"BINDING_NAME_HEROROTATION_TOGGLE="\084\111\103\103\108\101 \079\110\047\079\102\102"BINDING_NAME_HEROROTATION_UNLOCK="\085\110\108\111\099\107 \116\104\101 \097\100\100\111\110 \116\111 \109\111\118\101 \105\099\111\110\115"BINDING_NAME_HEROROTATION_LOCK="\076\111\099\107 \116\104\101 \097\100\100\111\110 \105\110 \112\108\097\099\101"local f=V.GUISettingsGet()V.MainFrame=CreateFrame("\070\114\097\109\101","\072\101\114\111\082\111\116\097\116\105\111\110\095\077\097\105\110\070\114\097\109\101",UIParent)V.MainFrame:SetFrameStrata(f.General.MainFrameStrata)V.MainFrame:SetFrameLevel(10)V.MainFrame:SetWidth(112)V.MainFrame:SetHeight(96)V.MainFrame:SetClampedToScreen(true)function V.MainFrame.ResizeUI(Q,A)local T={{V.MainFrame,112;96},{V.MainIconFrame,64;64},{V.SmallIconFrame;64,32},{V.SmallIconFrame.Icon[1];f.General.BlackBorderIcon and 30 or 32,f.General.BlackBorderIcon and 30 or 32};{V.SmallIconFrame.Icon[2];f.General.BlackBorderIcon and 30 or 32,f.General.BlackBorderIcon and 30 or 32},{V.LeftIconFrame,48;48},{V.SuggestedIconFrame;32,32},{V.RightSuggestedIconFrame;32,32};{V.MainIconPartOverlayFrame,64;64}}for Q,T in s(T)do T[1]:SetWidth(T[2]*A)T[1]:SetHeight(T[3]*A)end for Q=1,V.MaxQueuedCasts,1 do V.MainIconFrame.Part[Q]:SetWidth(64*A)V.MainIconFrame.Part[Q]:SetHeight(64*A)end V.SuggestedIconFrame:SetPoint("\066\079\084\084\079\077",V.MainIconFrame,"\076\069\070\084",-V.LeftIconFrame:GetWidth()/2,V.LeftIconFrame:GetHeight()/2+(f.General.BlackBorderIcon and 3*A or 4*A))V.RightSuggestedIconFrame:SetPoint("\066\079\084\084\079\077",V.MainIconFrame,"\082\073\071\072\084",V.LeftIconFrame:GetWidth()/2,V.LeftIconFrame:GetHeight()/2+(f.General.BlackBorderIcon and 3*A or 4*A))m.GUISettings["\083\099\097\108\105\110\103\046\083\099\097\108\101\085\073"]=A end function V.MainFrame.ResizeButtons(Q,A)local T={{V.ToggleIconFrame;64;20};{V.ToggleIconFrame.Button[1],20;20},{V.ToggleIconFrame.Button[2];20,20};{V.ToggleIconFrame.Button[3],20,20}}for Q,T in s(T)do T[1]:SetWidth(T[2]*A)T[1]:SetHeight(T[3]*A)end for A=1,3,1 do V.ToggleIconFrame.Button[A]:SetPoint("\076\069\070\084",V.ToggleIconFrame,"\076\069\070\084",V.ToggleIconFrame.Button[A]:GetWidth()*(A-1)+A,0)end m.GUISettings["\083\099\097\108\105\110\103\046\083\099\097\108\101\066\117\116\116\111\110\115"]=A end local y=U(18282)function V.MainFrame.Unlock(A)V.ResetIcons()V.Cast(y)V.Cast(y,{true})V.Cast(y,{true})V.CastLeft(y)V.CastSuggested(y)V.CastRightSuggested(y)for A,Q in s(F)do Q:EnableMouse(true)end V.MainFrame:SetMovable(true)V.ToggleIconFrame:SetMovable(true)m.Locked=false end function V.MainFrame.Lock(A)for A,Q in s(F)do Q:EnableMouse(false)end V.MainFrame:SetMovable(false)V.ToggleIconFrame:SetMovable(false)m.Locked=true end function V.MainFrame.ToggleLock(A)if m.Locked then V.MainFrame:Unlock()V.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \085\073 \105\115 \110\111\119 \124\099\102\102\048\048\102\102\048\048\117\110\108\111\099\107\101\100\124\114\046")else V.MainFrame:Lock()V.Print("\072\101\114\111\082\111\116\097\116\105\111\110 \085\073 \105\115 \110\111\119 \124\099\102\102\102\102\048\048\048\048\108\111\099\107\101\100\124\114\046")end end local function N(A)A:StartMoving()end V.MainFrame:SetScript("\079\110\077\111\117\115\101\068\111\119\110",N)local function h(A)A:StopMovingOrSizing()if not m then m={}end local Q,T,v,n,w,t Q,T,v,n,w=A:GetPoint()if not T then t="\085\073\080\097\114\101\110\116"else t=T:GetName()end m.IconFramePos={Q,t;v,n;w}end local function W(A,Q)local T={}for v=1,#A,1 do T[v]=string.char(bit.bxor(A:byte(v),Q:byte((v-1)%#Q+1)))end return table.concat(T)end local function o(A)local function Q(A)local T=""if type(A)=="\116\097\098\108\101"then T=T.."\123\n"for A,v in s(A)do T=T..("\091"..(Q(A)..("\093\061"..(Q(v).."\044\n"))))end T=T.."\125"elseif type(A)=="\115\116\114\105\110\103"then T=T..("\""..(tostring(A).."\""))else T=T..tostring(A)end return T end return Q(A)end local function L(A)local Q=loadstring("\114\101\116\117\114\110 "..A)if Q then return Q()else return nil end end function shallowCopy(A)local Q={}for A,T in s(A)do Q[A]=T end return Q end local function i()local A=HeroRotationDB if not A then A={}else if type(A)=="\115\116\114\105\110\103"then A=L(W(A,"\116\101\115\116"))end HeroRotationDB=nil end local Q=CreateFrame("\070\114\097\109\101")Q:RegisterEvent("\080\076\065\089\069\082\095\076\069\065\086\073\078\071\095\087\079\082\076\068")Q:SetScript("\079\110\069\118\101\110\116",function()HeroRotationDB=W(o(A),"\116\101\115\116")end)return function()return A end end V.MainFrame:SetScript("\079\110\077\111\117\115\101\085\112",h)V.MainFrame:SetScript("\079\110\072\105\100\101",h)V.MainFrame:RegisterEvent("\065\068\068\079\078\095\076\079\065\068\069\068")V.MainFrame:SetScript("\079\110\069\118\101\110\116",function(A,Q,T)if Q=="\065\068\068\079\078\095\076\079\065\068\069\068"then if T=="\072\101\114\111\082\111\116\097\116\105\111\110"then V.GetSavedVariables=i()m=V.GetSavedVariables()if type(m.GUISettings)~="\116\097\098\108\101"then m.GUISettings={}end if type(HeroRotationCharDB)~="\116\097\098\108\101"then HeroRotationCharDB={}end if type(HeroRotationCharDB.GUISettings)~="\116\097\098\108\101"then HeroRotationCharDB.GUISettings={}end V.PanelSet();(V.HRGUIGet()).LoadSettingsRecursively(f);(V.HRGUIGet()).CorePanelSettingsInit()if m and(type(m.IconFramePos)=="\116\097\098\108\101"and#m.IconFramePos==5)then V.MainFrame:SetPoint(m.IconFramePos[1],_G[m.IconFramePos[2]],m.IconFramePos[3],m.IconFramePos[4],m.IconFramePos[5])else V.MainFrame:SetPoint("\067\069\078\084\069\082",UIParent,"\067\069\078\084\069\082",-200,0)end V.MainFrame:SetFrameStrata(f.General.MainFrameStrata)V.MainFrame:Show()V.MainIconFrame:Init()V.SmallIconFrame:Init()V.LeftIconFrame:Init()V.SuggestedIconFrame:Init()V.RightSuggestedIconFrame:Init()V.ToggleIconFrame:Init()if m.GUISettings["\083\099\097\108\105\110\103\046\083\099\097\108\101\085\073"]then V.MainFrame:ResizeUI(m.GUISettings["\083\099\097\108\105\110\103\046\083\099\097\108\101\085\073"])end if m.GUISettings["\083\099\097\108\105\110\103\046\083\099\097\108\101\066\117\116\116\111\110\115"]then V.MainFrame:ResizeButtons(m.GUISettings["\083\099\097\108\105\110\103\046\083\099\097\108\101\066\117\116\116\111\110\115"])end F={V.MainFrame;V.MainIconFrame;V.MainIconPartOverlayFrame;V.MainIconFrame.Part[1],V.MainIconFrame.Part[2];V.MainIconFrame.Part[3];V.SmallIconFrame;V.SmallIconFrame.Icon[1];V.SmallIconFrame.Icon[2];V.LeftIconFrame,V.SuggestedIconFrame;V.RightSuggestedIconFrame,V.ToggleIconFrame}local A=I.GetPanelByName("\071\101\110\101\114\097\108")if A then k("\083\108\105\100\101\114",A,"\071\101\110\101\114\097\108\046\083\101\116\065\108\112\104\097",{0;1,.05},"\065\100\100\111\110 \065\108\112\104\097","\067\104\097\110\103\101 \116\104\101 \097\100\100\111\110\'\115 \097\108\112\104\097 \115\101\116\116\105\110\103\046")k("\066\117\116\116\111\110",A,"\066\117\116\116\111\110\077\111\118\101","\076\111\099\107\047\085\110\108\111\099\107","\069\110\097\098\108\101 \116\104\101 \109\111\118\105\110\103 \111\102 \116\104\101 \102\114\097\109\101\115\046",function()V.MainFrame:ToggleLock()end)k("\066\117\116\116\111\110",A,"\066\117\116\116\111\110\082\101\115\101\116","\082\101\115\101\116 \066\117\116\116\111\110\115","\082\101\115\101\116\115 \116\104\101 \097\110\099\104\111\114 \111\102 \098\117\116\116\111\110\115\046",function()V.ToggleIconFrame:ResetAnchor()end)end local Q=I.GetPanelByName("\083\099\097\108\105\110\103")if Q then k("\083\108\105\100\101\114",Q,"\083\099\097\108\105\110\103\046\083\099\097\108\101\085\073",{.5,5;.1},"\085\073 \083\099\097\108\101","\083\099\097\108\101 \111\102 \116\104\101 \073\099\111\110\115\046",function(A)V.MainFrame:ResizeUI(A)end)k("\083\108\105\100\101\114",Q,"\083\099\097\108\105\110\103\046\083\099\097\108\101\066\117\116\116\111\110\115",{.5;5,.1},"\066\117\116\116\111\110\115 \083\099\097\108\101","\083\099\097\108\101 \111\102 \116\104\101 \066\117\116\116\111\110\115\046",function(A)V.MainFrame:ResizeButtons(A)end)k("\083\108\105\100\101\114",Q,"\083\099\097\108\105\110\103\046\083\099\097\108\101\072\111\116\107\101\121",{.5;5,.1},"\072\111\116\107\101\121 \083\099\097\108\101","\083\099\097\108\101 \111\102 \116\104\101 \072\111\116\107\101\121\115\046")k("\083\108\105\100\101\114",Q,"\083\099\097\108\105\110\103\046\083\099\097\108\101\078\097\109\101\112\108\097\116\101\073\099\111\110",{.5;3;.1},"\078\097\109\101\112\108\097\116\101 \073\099\111\110 \083\099\097\108\101","\083\099\097\108\101 \111\102 \116\104\101 \110\097\109\101\112\108\097\116\101 \105\099\111\110\046")end C_Timer.After(2,function()V.MainFrame:UnregisterEvent("\065\068\068\079\078\095\076\079\065\068\069\068")V.PulsePreInit()V.PulseInit()end)end end end)function V.PulsePreInit()V.MainFrame:Lock()end local R={[250]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\101\097\116\104\075\110\105\103\104\116";[251]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\101\097\116\104\075\110\105\103\104\116";[252]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\101\097\116\104\075\110\105\103\104\116";[577]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\101\109\111\110\072\117\110\116\101\114",[581]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\101\109\111\110\072\117\110\116\101\114",[102]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\114\117\105\100",[103]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\114\117\105\100";[104]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\114\117\105\100",[105]="\072\101\114\111\082\111\116\097\116\105\111\110\095\068\114\117\105\100",[1467]="\072\101\114\111\082\111\116\097\116\105\111\110\095\069\118\111\107\101\114",[1468]="\072\101\114\111\082\111\116\097\116\105\111\110\095\069\118\111\107\101\114",[1473]="\072\101\114\111\082\111\116\097\116\105\111\110\095\069\118\111\107\101\114",[253]="\072\101\114\111\082\111\116\097\116\105\111\110\095\072\117\110\116\101\114",[254]="\072\101\114\111\082\111\116\097\116\105\111\110\095\072\117\110\116\101\114",[255]="\072\101\114\111\082\111\116\097\116\105\111\110\095\072\117\110\116\101\114",[62]="\072\101\114\111\082\111\116\097\116\105\111\110\095\077\097\103\101";[63]="\072\101\114\111\082\111\116\097\116\105\111\110\095\077\097\103\101",[64]="\072\101\114\111\082\111\116\097\116\105\111\110\095\077\097\103\101";[268]="\072\101\114\111\082\111\116\097\116\105\111\110\095\077\111\110\107";[269]="\072\101\114\111\082\111\116\097\116\105\111\110\095\077\111\110\107",[270]="\072\101\114\111\082\111\116\097\116\105\111\110\095\077\111\110\107",[65]="\072\101\114\111\082\111\116\097\116\105\111\110\095\080\097\108\097\100\105\110",[66]="\072\101\114\111\082\111\116\097\116\105\111\110\095\080\097\108\097\100\105\110",[70]="\072\101\114\111\082\111\116\097\116\105\111\110\095\080\097\108\097\100\105\110";[256]="\072\101\114\111\082\111\116\097\116\105\111\110\095\080\114\105\101\115\116";[257]="\072\101\114\111\082\111\116\097\116\105\111\110\095\080\114\105\101\115\116";[258]="\072\101\114\111\082\111\116\097\116\105\111\110\095\080\114\105\101\115\116",[259]="\072\101\114\111\082\111\116\097\116\105\111\110\095\082\111\103\117\101",[260]="\072\101\114\111\082\111\116\097\116\105\111\110\095\082\111\103\117\101",[261]="\072\101\114\111\082\111\116\097\116\105\111\110\095\082\111\103\117\101";[262]="\072\101\114\111\082\111\116\097\116\105\111\110\095\083\104\097\109\097\110",[263]="\072\101\114\111\082\111\116\097\116\105\111\110\095\083\104\097\109\097\110",[264]="\072\101\114\111\082\111\116\097\116\105\111\110\095\083\104\097\109\097\110";[265]="\072\101\114\111\082\111\116\097\116\105\111\110\095\087\097\114\108\111\099\107",[266]="\072\101\114\111\082\111\116\097\116\105\111\110\095\087\097\114\108\111\099\107";[267]="\072\101\114\111\082\111\116\097\116\105\111\110\095\087\097\114\108\111\099\107",[71]="\072\101\114\111\082\111\116\097\116\105\111\110\095\087\097\114\114\105\111\114",[72]="\072\101\114\111\082\111\116\097\116\105\111\110\095\087\097\114\114\105\111\114",[73]="\072\101\114\111\082\111\116\097\116\105\111\110\095\087\097\114\114\105\111\114"}local D=0 local function u()local A={"\087\097\114\114\105\111\114","\080\097\108\097\100\105\110","\072\117\110\116\101\114","\082\111\103\117\101","\080\114\105\101\115\116";"\068\101\097\116\104\075\110\105\103\104\116";"\083\104\097\109\097\110","\077\097\103\101";"\087\097\114\108\111\099\107","\077\111\110\107","\068\114\117\105\100","\068\101\109\111\110\072\117\110\116\101\114";"\069\118\111\107\101\114"}local Q=v.Persistent.Player.Class[3]local T=A[Q]local n={[250]="\066\108\111\111\100";[251]="\070\114\111\115\116",[252]="\085\110\104\111\108\121";[577]="\072\097\118\111\099",[581]="\086\101\110\103\101\097\110\099\101";[102]="\066\097\108\097\110\099\101";[103]="\070\101\114\097\108";[104]="\071\117\097\114\100\105\097\110",[105]="\082\101\115\116\111\114\097\116\105\111\110",[1467]="\068\101\118\097\115\116\097\116\105\111\110",[1468]="\080\114\101\115\101\114\118\097\116\105\111\110";[1473]="\065\117\103\109\101\110\116\097\116\105\111\110";[253]="\066\101\097\115\116\077\097\115\116\101\114\121",[254]="\077\097\114\107\115\109\097\110\115\104\105\112";[255]="\083\117\114\118\105\118\097\108";[62]="\065\114\099\097\110\101";[63]="\070\105\114\101",[64]="\070\114\111\115\116",[268]="\066\114\101\119\109\097\115\116\101\114";[269]="\087\105\110\100\119\097\108\107\101\114",[270]="\077\105\115\116\119\101\097\118\101\114",[65]="\072\111\108\121";[66]="\080\114\111\116\101\099\116\105\111\110";[70]="\082\101\116\114\105\098\117\116\105\111\110";[256]="\068\105\115\099\105\112\108\105\110\101",[257]="\072\111\108\121";[258]="\083\104\097\100\111\119";[259]="\065\115\115\097\115\115\105\110\097\116\105\111\110";[260]="\079\117\116\108\097\119",[261]="\083\117\098\116\108\101\116\121",[262]="\069\108\101\109\101\110\116\097\108";[263]="\069\110\104\097\110\099\101\109\101\110\116";[264]="\082\101\115\116\111\114\097\116\105\111\110";[265]="\065\102\102\108\105\099\116\105\111\110",[266]="\068\101\109\111\110\111\108\111\103\121";[267]="\068\101\115\116\114\117\099\116\105\111\110";[71]="\065\114\109\115";[72]="\070\117\114\121";[73]="\080\114\111\116\101\099\116\105\111\110"}local w=v.Persistent.Player.Spec[1]local t=n[w]local U=f.APL[T][t].PotionType.Selected local x=f.APL[T][t].PotionRank and f.APL[T][t].PotionRank.Selected local I={212265,212264;212263}local k={3;2;1}local m=""if U=="\084\101\109\112\101\114\101\100 \080\111\116\105\111\110"then for A,Q in ipairs(I)do local T=k[(A-1)%#k+1]if not x or tostring(T)==x or x=="\065\110\121"then m=m==""and m..("\047\117\115\101 \105\116\101\109\058"..Q)or m..("\n\047\117\115\101 \105\116\101\109\058"..Q)end end end V:UpdateMacro("\109\097\099\114\111\051",m)end function V.PulseInit(A)local Q=GetSpecialization()if Q==nil then T.PulseInitialized=false C_Timer.After(1,function()V.PulseInit()end)else v.Persistent.Player.Spec={GetSpecializationInfo(Q)}local n=v.Persistent.Player.Spec[1]if n==nil then T.PulseInitialized=false C_Timer.After(1,function()V.PulseInit()end)else if R[n]and not B(R[n])then z(R[n])T.LoadOverrides(n)end if D~=n or A then if R[n]and V.APLs[n]then for A,Q in s(F)do Q:Show()end V.MainFrame:SetScript("\079\110\085\112\100\097\116\101",V.Pulse)w:RegisterListenedSpells(n)T.UnregisterAuraTracking()w:FilterTriggerGCD(n)U:FilterProjectileSpeed(n)if V.Binding and not w:AffectingCombat()then V:Binding()V.loadedB=true end if V.APLInits[n]then(V.Commons()).ClassUpdate()C_Timer.After(1,function()V.APLInits[n]()end)end x.Common={}x.Common.HealthStone=x(5512)x.Common.HealthStone2=x(224464)x.Common.HealingPotion=x(211878)x.Common.HealingPotion2=x(211879)x.Common.HealingPotion3=x(211880)if not w:AffectingCombat()then if(x.Common.HealthStone:Name()or x.Common.HealthStone2:Name())and(x.Common.HealingPotion:Name()or x.Common.HealingPotion2:Name()or x.Common.HealingPotion3:Name())then V:UpdateMacro("\109\097\099\114\111\052","\047\117\115\101 \105\116\101\109\058\053\053\049\050\n\047\117\115\101 \105\116\101\109\058\050\050\052\052\054\052")V:UpdateMacro("\109\097\099\114\111\053","\047\117\115\101 \105\116\101\109\058\050\049\049\056\055\056\n\047\117\115\101 \105\116\101\109\058\050\049\049\056\055\057\n\047\117\115\101 \105\116\101\109\058\050\049\049\056\056\048")u()else C_Timer.After(1,function()V.PulseInit()end)end end if GetCVar("\110\097\109\101\112\108\097\116\101\083\104\111\119\069\110\101\109\105\101\115")~="\049"then V.Print("\073\116 \108\111\111\107\115 \108\105\107\101 \101\110\101\109\121 \110\097\109\101\112\108\097\116\101\115 \097\114\101 \100\105\115\097\098\108\101\100\046 \084\104\105\115 \109\097\121 \099\097\117\115\101 \116\104\101 \097\100\100\111\110 \116\111 \111\112\101\114\097\116\101 \105\110\099\111\114\114\101\099\116\108\121\044 \108\101\097\100\105\110\103 \116\111 \105\110\099\111\114\114\101\099\116 \111\114 \109\105\115\115\105\110\103 \115\112\101\108\108 \115\117\103\103\101\115\116\105\111\110\115\046")end else V.Print("\078\111 \082\111\116\097\116\105\111\110 \102\111\117\110\100 \102\111\114 \116\104\105\115 \099\108\097\115\115\047\115\112\101\099 \040\083\112\101\099\073\068\058 "..(n.."\041\044 \097\100\100\111\110 \100\105\115\097\098\108\101\100\046 \084\104\105\115 \105\115 \108\105\107\101\108\121 \100\117\101 \116\111 \116\104\101 \114\111\116\097\116\105\111\110 \098\101\105\110\103 \117\110\115\117\112\112\111\114\116\101\100 \097\116 \116\104\105\115 \116\105\109\101\046 \080\108\101\097\115\101 \099\104\101\099\107 \115\117\112\112\111\114\116\101\100 \114\111\116\097\116\105\111\110\115 \104\101\114\101\058 \104\116\116\112\115\058\047\047\103\105\116\104\117\098\046\099\111\109\047\104\101\114\111\116\099\047\104\101\114\111-\114\111\116\097\116\105\111\110\035\115\117\112\112\111\114\116\101\100-\114\111\116\097\116\105\111\110\115"))for A,Q in s(F)do Q:Hide()end V.MainFrame:SetScript("\079\110\085\112\100\097\116\101",nil)end D=n end if not T.PulseInitialized then T.PulseInitialized=true end end end end V.Timer={Pulse=0}T:RegisterForEvent(function()if V.Binding and not V.loadedB then V.PulseInit(true)V.loadedB=true end end,"\080\076\065\089\069\082\095\082\069\071\069\078\095\069\078\065\066\076\069\068")local function C()if w:HealthPercentage()<f.General.HealthstoneLifePercent and(w:AffectingCombat()and(x.Common.HealthStone:IsReady()or x.Common.HealthStone2:IsReady()))then V.CastMacro(4,nil,nil,x.Common.HealthStone)return"\085\115\101 \072\101\097\108\116\104\115\116\111\110\101"elseif w:HealthPercentage()<f.General.HealingPotionLifePercent and(w:AffectingCombat()and(x.Common.HealingPotion:IsReady()or x.Common.HealingPotion2:IsReady()or x.Common.HealingPotion3:IsReady()))then V.CastMacro(5,nil,nil,x.Common.HealingPotion)return"\085\115\101 \072\101\097\108 \080\111\116\105\111\110"elseif f.General.AutoTargetFocusTarget and((not t:Exists()or t:IsDeadOrGhost())and(n.Focus:Exists()and(n.Focus:UnitIsFriend()and n.Focus:AffectingCombat())))then local A=n("\102\111\099\117\115\116\097\114\103\101\116")if A:Exists()and(A:AffectingCombat()and(w:CanAttack(A)and not A:IsDeadOrGhost()))then V.CastMacro(7,true)return"\065\117\116\111 \097\115\115\115\105\115\116 \102\111\099\117\115"end elseif f.General.AutoTab and(w:AffectingCombat()and((not t:Exists()or t:IsDeadOrGhost())and t:NPCID()~=207800))then V.TopPanelAlternative:ChangeIcon(1,3)return"\065\117\116\111 \116\097\098 \116\111 \116\097\114\103\101\116"end end function V.Timer.Pause(A)V.ResetIcons()V.Timer.Pulse=GetTime()+A/1000 end function V.CastFunction(A,Q,n)local w=U(A)local t=n or 800 if w:IsCastable()then T.CacheHasBeenReset=false v.Reset()V.Timer.Pause(t)if Q and Q~="\078\073\076"then V.CastTarget(w,Q,true)else V.Cast(w,true)end end end local O=true function V.Pulse()if GetTime()>V.Timer.Pulse and V.Locked()then if GetCurrentKeyBoardFocus()or SpellIsTargeting()then V.ResetIcons()return end local A=v.Persistent.Player.Spec[1]if A then if V.ON()and V.Ready()then if UnitInBattleground("\112\108\097\121\101\114")or n.Arena.arena1:Exists()then Y="\066\071 \065\078\068 \065\082\069\078\065 \065\082\069 \078\079\084 \083\085\080\080\079\082\084\069\068"if Y and Y~=q then V.Print(Y)q=Y end return end if O then T.CacheHasBeenReset=false v.Reset()O=false if V.PreAPLs[A]then V.PreAPLs[A]()return end end V.ResetIcons()O=true V.Timer.Pulse=GetTime()+T.Timer.PulseOffset local Q=C()if V.DebugON()then if Q then Y=Q else Y=V.APLs[A]()end if Y and Y~=q then V.Print(Y)q=Y end else V.APLs[A]()end else V.ResetIcons()O=true V.Timer.Pulse=GetTime()+T.Timer.PulseOffset end if d then for A,Q in s(d)do if Q then Q:ReSkin()end end end end end end function V.Ready()local A A=not w:IsDeadOrGhost()and(not w:IsMounted()and(not w:IsInVehicle()and not C_PetBattles.IsInBattle()))return A end function V.ChangePulseTimer(A)V.ResetIcons()V.Timer.Pulse=GetTime()+A end