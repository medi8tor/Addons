local u,j=...local R=j.CDsON()local h=R.AoEON local Y=R.Cast local C=R.CastLeftNameplate local q=HeroLib local G,a=HeroCache,q.Utils local g=q.Unit local z,Z,l=g.Player,g.Pet,g.Target local A,c=g.Focus,g.MouseOver local P=q.Spell local N=q.Item local n=pairs local E=UnitInParty local X=UnitInRaid local x={}local b={}x.Everyone=b local W=R.GUISettingsGet()local U=W.General local V=W.Interrupt function R.Commons()return x end local F={[250]="\066\108\111\111\100";[251]="\070\114\111\115\116";[252]="\085\110\104\111\108\121";[577]="\072\097\118\111\099",[581]="\086\101\110\103\101\097\110\099\101",[102]="\066\097\108\097\110\099\101";[103]="\070\101\114\097\108",[104]="\071\117\097\114\100\105\097\110",[105]="\082\101\115\116\111\114\097\116\105\111\110",[1467]="\068\101\118\097\115\116\097\116\105\111\110";[1468]="\080\114\101\115\101\114\118\097\116\105\111\110";[1473]="\065\117\103\109\101\110\116\097\116\105\111\110",[253]="\066\101\097\115\116\077\097\115\116\101\114\121",[254]="\077\097\114\107\115\109\097\110\115\104\105\112",[255]="\083\117\114\118\105\118\097\108";[62]="\065\114\099\097\110\101",[63]="\070\105\114\101";[64]="\070\114\111\115\116",[268]="\066\114\101\119\109\097\115\116\101\114";[269]="\087\105\110\100\119\097\108\107\101\114",[270]="\077\105\115\116\119\101\097\118\101\114",[65]="\072\111\108\121",[66]="\080\114\111\116\101\099\116\105\111\110",[70]="\082\101\116\114\105\098\117\116\105\111\110",[256]="\068\105\115\099\105\112\108\105\110\101",[257]="\072\111\108\121";[258]="\083\104\097\100\111\119",[259]="\065\115\115\097\115\115\105\110\097\116\105\111\110",[260]="\079\117\116\108\097\119";[261]="\083\117\098\116\108\101\116\121",[262]="\069\108\101\109\101\110\116\097\108";[263]="\069\110\104\097\110\099\101\109\101\110\116";[264]="\082\101\115\116\111\114\097\116\105\111\110";[265]="\065\102\102\108\105\099\116\105\111\110";[266]="\068\101\109\111\110\111\108\111\103\121",[267]="\068\101\115\116\114\117\099\116\105\111\110";[71]="\065\114\109\115";[72]="\070\117\114\121";[73]="\080\114\111\116\101\099\116\105\111\110"}local t={"\087\097\114\114\105\111\114","\080\097\108\097\100\105\110","\072\117\110\116\101\114";"\082\111\103\117\101","\080\114\105\101\115\116";"\068\101\097\116\104\075\110\105\103\104\116","\083\104\097\109\097\110";"\077\097\103\101","\087\097\114\108\111\099\107","\077\111\110\107","\068\114\117\105\100","\068\101\109\111\110\072\117\110\116\101\114","\069\118\111\107\101\114"}function b.converArrayToList(u)local j={}for u,R in n(u)do j[R]=true end return j end local d=b.converArrayToList({426524;428103;252923,268278,264050;253517;253544;252781;255041;250368;250096;253583;259572,250368,256849;200631,204243;225562,201399,264390;255978,263959;271174;278444,265876;264407;266225,417481,418200;411300;412378,412233;407891;227913,200248,199663,164965;165213;169839;168082,427459,75722;76720,426783,411994;415770,415435;415437,416256,413607,413606;400180,412924;417481;412378;412233,413427,412922;388635;372394,372315;378282,395427,372223,384161;396925;372615;372538;382795,369675;369674,369823;369603,369399,369400,377500;369365,382249;367500;377950;385029;373804;374544,372711;373897,382712;382435,382474;384633;374066;374339;374045,374080;389443,395694,374563,385141,374706;375384;375950,377348,377402;387618,374699,376171,388392;396812,377389;396640,387975,373017;392451;385310,384194;384197,384933,372749;372743,375596;375602,387564,386546;377488;373932;384808,376725;383823,384365;386015;387411;387613;387440;373395;397394;381530,387606;386024;386012;387125,434786;434793;434802;436322;448248,433841,442210,443427,443430;443433,442536,452162;446086;434122,431303,431309,450756;451113;431333;432520;451114,451097,431303,428086,452127,452806;426283,449455,429110,429109;445207,429545;429422;430097,322767,322938,324776,324914;326046;340544,323057,321828,322450,334748,320462,320336;335143,343470;324293,334748,338353,327130,334748;320171;322274;256957,257063;275826,454440,272581;272571,451261,451871;76369;76711;76369;447966})local s=b.converArrayToList({429176,268202;200345;235838;225562;225963,164965;413606,225573,201400;253583;411300,201061;164887;76813,76820;278444,253517;265346;427376;271175;214002,412233,200105;264390;200658;411958;412044,255041;200630,412012,415436;413473;413487;412505;411644,411700,411407,412262;412200;412156,265371;264038,271175;264525;256922;273657;253239;260666,253721;258653;252687;198904,200084,200291,200343;200344,200345;225962,201139,200913,214003,214001;172578,172579,426905,76516;427384,378818,372201;372202;372225,369853;369465,369466;377732,374045;395694,376171;375950;388882;367521,367484,387910,390938,385536;212784,383693,397931,114646,211473,372735;372749;370225;373932,383823;387615;382077,434793,438476,442210,432031,443430;452162,437700,439324,431333;452127,422233,322938;321873;321471;322550;334748,334748,321780;327130,320596;321226;320358;321894,257292,268752;76711;448013,450088})b.PurgeList={200248,256849;255579;428329,265368;369823;369400,377500,377950,376800,382891;395694;374066,377402,387955;385063;372749,392454,373972;378149;389686;387122;374778;384686;386223,386319,387596,388631;375487;431493;450756,432520;451097;324776,324914,326046;335141;256957,275826}b.SootheList={38166;257260,165213,255824;426618;228318;383067,382555,384764;369806;390938,383693,387614;377384;371875;433002,441645,451112;324737,320703,327155,320012;272888,451379;451033}b.DebuffList={Magic=b.converArrayToList({375919,145206,424888,322557;426734,426735;427382,464876;323347;429545;440238;449455;324293;325223,325224;272571;321968,440313}),Poison=b.converArrayToList({443397,443401,436322;340304;340289,340288;438618,432227,326092;275835,275836;434137,461630;340283,448248;433841}),Disease=b.converArrayToList({338353;272588,320596;454440;321821,440313}),Curse=b.converArrayToList({257168,426308;322968;431309,451224;450095,440313}),RootDispel=b.converArrayToList({413606,418200,255041}),FreedomDispel=b.converArrayToList({382593;368081,370766;386028,375591;442210;433662;433781;433785,434083;446718;443430;443427;451871;431309;426735,431494;451104;439780;287295;464876;428161,440238;450505});SnareRoot=b.converArrayToList({413606;164885;164886;426500,418200,408084;255041});Entangled=b.converArrayToList({408556}),Bleed=b.converArrayToList({431491,323043,256709,438599;324987,321807;447261;320200;440107;440313}),Raid=b.converArrayToList({417807;375919})}b.AfflictedDispelList={409465;409470,409472}b.TankBustersList2=b.converArrayToList({384597;372730;384978;395292;374533;374789,377344,375937,376997,388911,392924;377991;381512,201139,225732,197418;214003,204611,198379,204667;191326;410254;418059,413013,404916,413529,407159;265881,265760,427376;427670;255579,414535,414604;414583;401248;167385,438599;436322,433002;433785,438471,443397;452151,451238,434722;440468;441298;461842;450055,439646;431493,431491,451113;431637;451117,452502,428086,453212,427001;427382,423766,459210;428894;429422;424888;428711,422233;322569;322557,463217;340208,340289,321828,320696,320462,321807,320462;324323,324394,338357,338456,320696,338636;320655,334488;320771,256616;256709;257168,268230,272588;275835;280389;451364,451378;451971;451241,447261;449444,449687;447966,450100})b.TankBustersMagicList={384597,395292;374533;392924;377991;381512,204667;191326;413529;407159,265881,265760,427376,204611;264378;167385;436322;434722;441298;461842;450055,439646,431493,451113;431637,452502;428086;453212;459210,429422;428711,322569,322557;463217,340289;321828,320462;320462;257168,272588;451971,451241,447966,450100}b.TankBustersPhysicalList={372730,384978;374789;377344;375937,376997;388911;201139,225732,197418,214003,204611,198379;410254;418059;413013;404916,427670,255579,414535;401248,164885;255434;416716,264556,412044;265760,167385;438599;433002;433785;438471,443397;452151;451238;440468;431491;451117,427001;427382;423766;428894;424888;422233,340208,320696,321807;324323;324394,338357;338456;320696;338636,320655;334488;320771;256616,256709;268230,275835,280389,451364;451378,447261,449444;449687;450100}b.NPCAlwaysInCombat=b.converArrayToList({216185;214443,229769,229739;195881,225443,213684,221344;135241;220002,223876,224077;234024,220501,219714,215826})b.NPCAlwaysInCombatBossFight=b.converArrayToList({122968;98542,186738;186616;196482;186116,189719,223779;219878;215826})b.Buggedmobs=b.converArrayToList({217489,217491,218884;218370,223150;223674;224368,223204;223318;221344;220501,219746;221863})do local u=C_UnitAuras.GetAuraDataByIndex local j,R local h,Y,C,q,a local z,Z,l function g.AuraInfo(P,g,A,c)j=P:GUID()if not j then return end local N=G.UnitInfo[j]if not N then N={}G.UnitInfo[j]=N end local n=N[A]if not n then if A=="\072\069\076\080\070\085\076"then z=A Z="\072\069\076\080\070\085\076\124\080\076\065\089\069\082"elseif A=="\072\065\082\077\070\085\076"then z=A Z="\072\065\082\077\070\085\076\124\080\076\065\089\069\082"elseif A=="\072\069\076\080\070\085\076\124\080\076\065\089\069\082"then z="\072\069\076\080\070\085\076"Z=A elseif A=="\072\065\082\077\070\085\076\124\080\076\065\089\069\082"then z="\072\065\082\077\070\085\076"Z=A end UnitFilterInfoAll={}UnitFilterInfoPlayer={}R=P:ID()a=1 while true do AuraData=u(R,a,z)if type(AuraData)~="\116\097\098\108\101"then break end h=AuraData.applications Y=AuraData.duration C=AuraData.expirationTime q=AuraData.spellId l=AuraData.sourceUnit if not q then break end UnitFilterInfoAll[q]={h;Y;C,l,a}if l=="\112\108\097\121\101\114"then UnitFilterInfoPlayer[q]={h,Y,C;l,a}end a=a+1 end N[z]=UnitFilterInfoAll N[Z]=UnitFilterInfoPlayer n=N[A]end local E=n[g:ID()]if E then return unpack(E)end end end local B=G.Persistent.Player.Class[3]local k=t[B]local H=G.Persistent.Player.Spec[1]local O=F[H]function x.ClassUpdate()B=G.Persistent.Player.Class[3]k=t[B]H=G.Persistent.Player.Spec[1]O=F[H]if W.APL[k][O.."\095\073\110\116\101\114\114\117\112\116"]then V=W.APL[k][O.."\095\073\110\116\101\114\114\117\112\116"].Interrupt else V=W.Interrupt.Interrupt end end local r,K,J=false,false,0 q:RegisterForEvent(function()r=true end,"\080\076\065\089\069\082\095\083\084\065\082\084\069\068\095\076\079\079\075\073\078\071")q:RegisterForEvent(function()r=false J=GetTime()end,"\080\076\065\089\069\082\095\083\084\079\080\080\069\068\095\076\079\079\075\073\078\071")q:RegisterForEvent(function()K=true end,"\080\076\065\089\069\082\095\083\084\065\082\084\069\068\095\084\085\082\078\073\078\071")q:RegisterForEvent(function()K=false J=GetTime()end,"\080\076\065\089\069\082\095\083\084\079\080\080\069\068\095\084\085\082\078\073\078\071")function z.IsCameraBusy(u)return(K or r)and J<GetTime()+1 end function g.CanBeStunned(u)return z:Level()>=u:Level()and(not u:IsStunned()and not u:IsBoss())end function g.IsBoss(u)if g.Boss then for j,R in n(g.Boss)do if R:Exists()and R:GUID()==u:GUID()then return true end end end end function g.AffectingCombat(u)return UnitAffectingCombat(u.UnitID)or u:IsDummy()or b.NPCAlwaysInCombat[u:NPCID()]or b.NPCAlwaysInCombatBossFight[g.Boss.boss1:NPCID()]or b.NPCAlwaysInCombatBossFight[g.Boss.boss2:NPCID()]or b.NPCAlwaysInCombatBossFight[g.Boss.boss3:NPCID()]end function g.Cast(h,u,j)local Y=h:ID()=="\112\108\097\121\101\114"and"\080\065\082\084\089\080\076\065\089\069\082"or string.upper(h:ID())return R.CastTarget(u,Y,j)end function g.UnitIsFriend(u)return UnitIsFriend("\112\108\097\121\101\114",u:ID())end function g.UnitIsPlayer(u)return UnitIsPlayer(u:ID())end function g.UnitIsEnemy(u)return UnitIsEnemy("\112\108\097\121\101\114",u:ID())end function g.Role(u)return UnitGroupRolesAssigned(u.UnitID)or-1 end function g.SpecID(u)return GetInspectSpecialization(u.UnitID)or-1 end function g.ClassID(u)local j,R,h=UnitClass(u.UnitID)return h or-1 end function g.IncomingHeals(u)local j=UnitGetIncomingHeals(u.UnitID)or 0 local R=u:MaxHealth()if j==0 then return 0 end if R<=0 then return 0 end local h=(j/R)*100 return math.ceil(h)end function g.HealthPercentageWeighted(u)GUID=u:GUID()if not GUID then return 100 end local j=G.UnitInfo[GUID]if not j then j={}G.UnitInfo[GUID]=j end local R=j.HealthPercentageWeighted if not R then R=b.CalculateWeight(u)j.HealthPercentageWeighted=R end return R end function g.DebuffElapsed(h,u,j,R)local Y=h:DebuffDuration(u,j)local C=h:DebuffRemains(u,j,R)local q=Y-C return q>=0 and q or 999 end function b.num(u)if u then return 1 else return 0 end end function b.bool(u)return u~=0 end function b.TargetIsValid()return l:Exists()and(z:CanAttack(l)and not l:IsDeadOrGhost())end function b.UnitIsCycleValid(u,j,R)return not u:IsFacingBlacklisted()and(not u:IsUserCycleBlacklisted()and(not j or u:FilteredTimeToDie("\062",j,R)))end function b.CanDoTUnit(u,j)return u:Health()>=j or u:IsDummy()end function b.Interrupt(u,j,R,h)b.InterruptCycle(j,u,nil,nil,false)end function b.IsSoloMode()return U.SoloMode and(not z:IsInRaidArea()and not z:IsInDungeonArea())end function b.ISSolo()return not z:IsInRaidArea()and not z:IsInDungeonArea()end local y=P(228318)local function f(u,j)if z:IsInRaidArea()and V.InterruptEverythingRaid or z:IsInDungeonArea()and(u:BuffDown(y)and(V.InterruptInDungeon=="\069\118\101\114\121\116\104\105\110\103"or V.InterruptInDungeon=="\087\104\105\116\101\108\105\115\116"and j[u:CastSpellID()or u:ChannelSpellID()]))or V.InterruptEverythingSolo and b.ISSolo()then local j=u:ID()if j~="\116\097\114\103\101\116"and j~="\109\111\117\115\101\111\118\101\114"then return true end if u:IsChanneling()and u:CastPercentage()<=V.InterruptPercentChannel then return true elseif not u:IsChanneling()and u:CastPercentage()>=V.InterruptPercent then return true end return false,true end end do local u=P(61304)function z.GCDDuration(j)local R,h,Y,C=u:CooldownInfo()return C end function P.CooldownWithoutGCD(u)local j,R,h,Y=u:CooldownInfo()if R==0 then return 0 end local C=((R+Y)-GetTime())-z:GCDDuration()C=C>0 and C or 0 return C==0 end end local function T(u)if V.AutoInterrupt and u:IsInterruptible()then return f(u,d)end end local function v(u)if V.AutoStun and(u:CanBeStunned()and u:IsCasting())then return f(u,s)or V.InterruptInDungeonUseStunAsInterrupt and f(u,d)end end function b.InterruptCycle(u,j,R,h,Y,C)if not(u:IsLearned()and(u:CooldownWithoutGCD()and u:IsUsableP()))then return nil end local q=z:GetEnemiesInRange(j)local G=Y and v or T local a=Y and V.AutoTargetStun or V.AutoTargetInterrupt local g=b.CastCycle(u,q,G,j,R,h,a,C)if g then return"\073\110\116\101\114\114\117\112\116\067\121\099\108\101\058"..g end end local function e(u)for j,R in n(b.PurgeList)do if u:BuffUp(P(R),true)then return true end end return false end function b.PurgeCycle(u,j,R,h)if not(u:IsLearned()and(u:CooldownWithoutGCD()and(u:IsUsableP()and u:IsAvailable())))then return nil end local Y=z:GetEnemiesInRange(j)local C=b.CastCycle(u,Y,e,j,R,nil,h)if C then return"\080\117\114\103\101\067\121\099\108\101\058"..C end end local function w(u)for j,R in n(b.SootheList)do if u:BuffUp(P(R),true)then return true end end return false end function b.SootheCycle(u,j,R,h)if not(u:IsLearned()and(u:CooldownWithoutGCD()and(u:IsUsableP()and u:IsAvailable())))then return nil end local Y=z:GetEnemiesInRange(j)local C=b.CastCycle(u,Y,w,j,R,nil,h)if C then return"\083\111\111\116\104\101\067\121\099\108\101\058"..C end end local function S(u)if u:NPCID()==204560 and u:CastSpellID()==408805 then return true end end function b.IncorpCycle(u,j,R,h)if not(u:IsLearned()and(u:CooldownWithoutGCD()and(u:IsUsableP()and u:IsAvailable())))then return nil end local Y=z:GetEnemiesInRange(j)local C=b.CastCycle(u,Y,S,j,R,nil,h)if C then return"\073\110\099\111\114\112\067\121\099\108\101\058"..C end end function b.AfflictedLogic(u,j)if l:Exists()and(l:NPCID()==204773 and l:IsSpellInRange(u))then Y(u,j)return"\097\102\102\108\105\099\116\101\100"end if c:Exists()and(c:NPCID()==204773 and c:IsSpellInRange(u))then R.CastTarget(u,(R.TName()).MOUSEOVER,j)return"\097\102\102\108\105\099\116\101\100 \109\111\117\115\101\111\118\101\114"end end function b.CastCycle(u,j,q,G,a,g,Z,A,P)local N,E=q(l)if l:Exists()and(z:CanAttack(l)and(not l:IsDeadOrGhost()and l:IsInRange(G)))then if N and Y(u,a,g,false)then return"\067\097\115\116\067\121\099\108\101 \084\097\114\103\101\116 \067\097\115\116 "..u:Name()end if E then return end end if(h()or not P)and(not A and(c:Exists()and(z:CanAttack(c)and(not c:IsDeadOrGhost()and(q(c)and c:IsInRange(G))))))then if R.CastTarget(u,(R.TName()).MOUSEOVER,a,g,false)then return"\067\097\115\116\067\121\099\108\101 \077\111\117\115\101\111\118\101\114 \067\097\115\116 "..u:Name()end end if h()or not P then local R=l:GUID()for j,h in n(j)do if h:GUID()~=R and(not h:IsFacingBlacklisted()and(not h:IsUserCycleBlacklisted()and q(h)))then if A then if Y(u,a,g,false)then return"\067\097\115\116\067\121\099\108\101 \065\079\069\083\112\101\108\108 \067\097\115\116 "..u:Name()end end C(h,u,Z)if Z then return"\067\097\115\116\067\121\099\108\101 \084\097\098 \116\111 "..(h:Name()..(" \116\111 \067\097\115\116 "..u:Name()))end end end end end function b.CastTargetIf(u,j,q,G,g,Z,A,P,N,E)local X=not g or g and g(l)local x=not g or g and g(c)if X and(l:IsInRange(Z)and(z:CanAttack(l)and(not l:IsDeadOrGhost()and not E)))then Y(u,A,P,false)return"\067\097\115\116\084\097\114\103\101\116\073\102 \084\097\114\103\101\116 \067\097\115\116 "..u:Name()end if x and(c:IsInRange(Z)and(z:CanAttack(c)and(not c:IsDeadOrGhost()and not E)))then R.CastTarget(u,(R.TName()).MOUSEOVER,A,P,false)return"\067\097\115\116\084\097\114\103\101\116\073\102 \077\111\117\115\101\111\118\101\114 \067\097\115\116 "..u:Name()end if h()then local h,Z=nil,nil for u,j in n(j)do if not j:IsFacingBlacklisted()and(not j:IsUserCycleBlacklisted()and((j:AffectingCombat()or j:IsDummy())and(not Z or a.CompareThis(q,G(j),Z))))then h,Z=j,G(j)end end if h then if X and(h:GUID()==l:GUID()or Z==G(l))then Y(u,A,P,false)return"\067\097\115\116\084\097\114\103\101\116\073\102 \116\111 \084\097\114\103\101\116 \105\115 \098\101\115\116 \067\097\115\116"..u:Name()elseif g and g(h)or not g then if h:GUID()==c:GUID()or Z==G(c)and(c:Exists()and(z:CanAttack(c)and not c:IsDeadOrGhost()))then R.CastTarget(u,(R.TName()).MOUSEOVER,A,P,false)return"\067\097\115\116\084\097\114\103\101\116\073\102 \116\111 \077\111\117\115\101\111\118\101\114 \105\115 \098\101\115\116 \067\097\115\116"..u:Name()end C(h,u,N)if N then return"\067\097\115\116\084\097\114\103\101\116\073\102 \084\097\098 \116\111 "..(h:Name()..(" \116\111 \067\097\115\116 "..u:Name()))end end end end if X and(l:IsInRange(Z)and(z:CanAttack(l)and(not l:IsDeadOrGhost()and E)))then Y(u,A,P,false)return"\067\097\115\116\084\097\114\103\101\116\073\102 \084\097\114\103\101\116 \067\097\115\116 "..u:Name()end if x and(c:IsInRange(Z)and(z:CanAttack(c)and(not c:IsDeadOrGhost()and E)))then R.CastTarget(u,(R.TName()).MOUSEOVER,A,P,false)return"\067\097\115\116\084\097\114\103\101\116\073\102 \077\111\117\115\101\111\118\101\114 \067\097\115\116 "..u:Name()end end local m=P(2825)function b.unitHasBuffFromList(u,j)local h=G.UnitInfo[j:GUID()]local Y=0 if not h then j:BuffInfo(m,"\072\069\076\080\070\085\076")h=G.UnitInfo[j:GUID()]end if h then local C=h.HELPFUL if not C then j:BuffInfo(m,"\072\069\076\080\070\085\076")C=h.HELPFUL end if C then for h,C in n(C)do if u[h]then if Y==0 then Y=math.random(.4,.9)end if j:BuffRemains(P(h),true)>=Y then if R.DebugON()then print("\117\110\105\116\072\097\115\066\117\102\102\070\114\111\109\076\105\115\116 "..(h..(" \111\110 \117\110\105\116 "..j:Name())))end return true end end end end end return false end function b.unitHasBuffFromListRemainingTime(u,j,h)local Y=G.UnitInfo[j:GUID()]if not Y then j:BuffInfo(m,"\072\069\076\080\070\085\076")Y=G.UnitInfo[j:GUID()]end if Y then local C=Y.HELPFUL if not C then j:BuffInfo(m,"\072\069\076\080\070\085\076")C=Y.HELPFUL end if C then for Y,C in n(C)do if u[Y]then if j:BuffRemains(P(Y),true)>=h then if R.DebugON()then print("\117\110\105\116\072\097\115\066\117\102\102\070\114\111\109\076\105\115\116 "..(Y..(" \111\110 \117\110\105\116 "..j:Name())))end return true end end end end end return false end function b.unitHasDebuffFromList(u,j)local h=G.UnitInfo[j:GUID()]local Y=0 if not h then j:DebuffInfo(y,"\072\065\082\077\070\085\076")h=G.UnitInfo[j:GUID()]end if h then local C=h.HARMFUL if not C then j:DebuffInfo(y,"\072\065\082\077\070\085\076")C=h.HARMFUL end if C then for h,C in n(C)do if u[h]then if Y==0 then Y=math.random(.4,.9)end if j:DebuffElapsed(P(h),true)>=Y then if R.DebugON()then print("\117\110\105\116\072\097\115\068\101\098\117\102\102\070\114\111\109\076\105\115\116 "..(h..(" \111\110 \117\110\105\116 "..j:Name())))end return true end end end end end return false end local M=P(320788)local D=P(275014)local o=P(448561)local I=P(443437)local i=P(432448)local p=P(461487)local L=P(424889)function b.DispelCycle(u,j,R,h)local Y=b.DebuffList[j]local function C(u)if j=="\077\097\103\105\099"then if u:DebuffUp(M,true)and u:DebuffElapsed(M,true)>=3.25 then return true end if u:DebuffUp(D,true)and u:DebuffElapsed(D,true)>=3 then return true end if u:DebuffUp(o,true)and u:DebuffElapsed(o,true)>=3 then return true end if u:DebuffUp(I,true)and u:DebuffElapsed(I,true)>=3 then return true end if u:DebuffUp(i,true)and u:DebuffElapsed(i,true)>=3 then return true end if u:DebuffUp(L,true)and u:DebuffRemains(L,true)<=8 then return true end elseif j=="\068\105\115\101\097\115\101"then elseif j=="\080\111\105\115\111\110"then elseif j=="\082\097\105\100"then end if b.unitHasDebuffFromList(Y,u)then return true end return false end return b.CycleFriendly(u,C,R,nil,h)end function b.CycleFriendly(u,j,R,h,Y)local C=Y and true or false if z:Exists()and(not z:IsDeadOrGhost()and j(z))then return z:Cast(u,R)end if not Y and X("\112\108\097\121\101\114")then Y=g.Raid elseif not Y and E("\112\108\097\121\101\114")then Y=g.Party end if Y then for Y,q in n(Y)do if q:Exists()and(not q:IsDeadOrGhost()and(q:UnitIsFriend()and((C or q:IsSpellInRange(h or u))and j(q))))then return q:Cast(u,R)end end end end local Q=P(443612)local function uc(u)return z:DebuffUp(Q,true)and u:DebuffUp(Q,true)or z:DebuffDown(Q,true)and u:DebuffDown(Q,true)end function b.UnitsinRange(u)local j={}if X("\112\108\097\121\101\114")then for R,h in n(g.Raid)do if h:Exists()and(not h:IsDeadOrGhost()and(uc(h)and(h:IsSpellInRange(u)and h:UnitIsFriend())))then table.insert(j,h)end end elseif E("\112\108\097\121\101\114")then for R,h in n(g.Party)do if h:Exists()and(not h:IsDeadOrGhost()and(h:IsSpellInRange(u)and h:UnitIsFriend()))then table.insert(j,h)end end if z:Exists()and not z:IsDeadOrGhost()then table.insert(j,z)end else if z:Exists()and not z:IsDeadOrGhost()then table.insert(j,z)end end return j end local jc={[442285]=.3;[451224]=.3;[320462]=.4,[443305]=.3;[455404]=.3,[426736]=.3;[450095]=.3,[442437]=.3;[443274]=.3;[442660]=.3,[322486]=.8,[426308]=.8;[449154]=.8;[431309]=.8,[432448]=.8;[431350]=.8;[443430]=.8,[443433]=.8;[443437]=.8,[448561]=.8;[440107]=.8;[433740]=.8;[334748]=.8;[320200]=.8;[272571]=.8;[273470]=.8,[275014]=.8;[440313]=.6}local Rc=P(102342)local hc=P(33206)local Yc=P(47788)local Cc=P(6940)function b.CalculateWeight(u)local j=1 local h=G.UnitInfo[u:GUID()]if not h then u:DebuffInfo(y,"\072\065\082\077\070\085\076")h=G.UnitInfo[u:GUID()]end if h then local Y=h.HARMFUL if not Y then u:DebuffUp(y,true)Y=h.HARMFUL end if Y then for u,h in n(Y)do if jc[u]then if R.DebugON()then end j=j*jc[u]end end end end if j>.3 then local R=1*((u:BuffUp(Rc,true)or u:BuffUp(Cc,true)or u:BuffUp(hc,true))and 1.1 or 1)R=R*(u:BuffUp(Yc,true)and 1.3 or 1)j=j*R end return u:HealthPercentage()*j end function b.GetLowestHealthUnit(u)local j=z local R=j:HealthPercentageWeighted()local h=nil local Y=math.huge for u,C in n(u)do local q=C:HealthPercentageWeighted()if C:Role()=="\084\065\078\075"then if not C:ClassID()==6 and C:HealthPercentage()>=65 then q=q*1.9 elseif C:PowerPercentage()>20 then q=q*1.2 end end if q<R then R=q j=C end if C:Role()=="\084\065\078\075"then if h==nil or q<Y then Y=q h=C end end end return j,h end function b.GetAverageGroupHealthPercent(u)local j=0 local R=#u if R==0 then return 100 end for u,R in n(u)do j=j+R:HealthPercentage()end return j/R end function b.BuffCount(u,j)local R=0 for u,h in n(u)do if h:BuffUp(j,nil,true)then R=R+1 end end return R end function b.DebuffCount(u,j)local R=0 for u,h in n(u)do if h:DebuffUp(j,true)then R=R+1 end end return R end function b.DebuffCountWithStacks(u,j,R)local h=0 for u,Y in n(u)do if Y:DebuffUp(j,true)and Y:DebuffStack(j,true)>=R then h=h+1 end end return h end function b.GetLowestHealthUnitWithBuffAndNoBuff(u,j,R)local h=nil local Y=math.huge for u,C in n(u)do if C:BuffUp(j,nil,true)and C:BuffDown(R,nil,true)then local u=C:HealthPercentageWeighted()if u<Y then Y=u h=C end end end if h then return h else return nil end end function b.GetLowestHealthUnitWithBuff(u,j)local R=nil local h=math.huge for u,Y in n(u)do if Y:BuffUp(j,nil,true)then local u=Y:HealthPercentageWeighted()if u<h then h=u R=Y end end end if R then return R else return nil end end function b.UnitstWithoutBuff(u,j)local R={}for u,h in n(u)do if not h:BuffUp(j,nil,true)then table.insert(R,h)end end return R end function b.GetLowestHealthUnitWithoutBuff(u,j)local R=nil local h=math.huge for u,Y in n(u)do if not Y:BuffUp(j,nil,true)then local u=Y:HealthPercentageWeighted()if u<h then h=u R=Y end end end if R then return R else return nil end end function b.GetLowestHealthUnitWithoutDebuff(u,j)local R=nil local h=math.huge for u,Y in n(u)do if not Y:DebuffUp(j,nil,true)then local u=Y:HealthPercentageWeighted()if u<h then h=u R=Y end end end if R then return R else return nil end end function b.GetLowestHealthUnitWithoutBuffandDebuff(u,j,R)local h=nil local Y=math.huge for u,C in n(u)do if not C:BuffUp(j,nil,true)and not C:DebuffUp(R,nil,true)then local u=C:HealthPercentageWeighted()if u<Y then Y=u h=C end end end if h then return h else return nil end end function b.GetLowestHealthUnitWithout2Buff(u,j,R)local h=nil local Y=math.huge for u,C in n(u)do if not C:BuffUp(j,nil,true)and not C:BuffUp(R,nil,true)then local u=C:HealthPercentageWeighted()if u<Y then Y=u h=C end end end if h then return h else return nil end end function b.AoELogicWithCount(u,j,h,Y)local C=0 for j,R in n(Y)do C=R:HealthPercentageWeighted()<u and C+1 or C end return(C>=j or C>=#Y)and(h==nil or h=="\087\105\116\104 \076\111\103\105\099"or h=="\087\105\116\104 \067\111\111\108\100\111\119\110\115 \097\110\100 \076\111\103\105\099"and R.CDsON())or h=="\087\105\116\104 \067\111\111\108\100\111\119\110\115"and R.CDsON()end function b.AoELogicWithCountUnweighted(u,j,h,Y)local C=0 for j,R in n(Y)do C=R:HealthPercentage()<u and C+1 or C end return(C>=j or C>=#Y)and(h==nil or h=="\087\105\116\104 \076\111\103\105\099"or h=="\087\105\116\104 \067\111\111\108\100\111\119\110\115 \097\110\100 \076\111\103\105\099"and R.CDsON())or h=="\087\105\116\104 \067\111\111\108\100\111\119\110\115"and R.CDsON()end function b.AoELogic(u,j,h)local Y=b.GetAverageGroupHealthPercent(h)return Y<=u and(j==nil or j=="\087\105\116\104 \076\111\103\105\099"or j=="\087\105\116\104 \067\111\111\108\100\111\119\110\115 \097\110\100 \076\111\103\105\099"and R.CDsON())or j=="\087\105\116\104 \067\111\111\108\100\111\119\110\115"and R.CDsON()end function b.GroupBuffMissing(u,j)local R=40 local h={[1]=381758,[2]=381752;[3]=381749,[4]=381754;[5]=381753,[6]=381732;[7]=381756,[8]=381750,[9]=381757;[10]=381751,[11]=381746;[12]=381741,[13]=381748}if u:ID()==6673 then R=100 end if z:BuffDown(u,true)then return true end local Y if X("\112\108\097\121\101\114")then Y=g.Raid elseif E("\112\108\097\121\101\114")then Y=g.Party else return false end local C=0 local q=0 for R,Y in n(Y)do if Y:Exists()and(not Y:IsDeadOrGhost()and(j or Y:IsSpellInRange(u)and not(z:IsInDelve()and Y:Name()=="\066\114\097\110\110 \066\114\111\110\122\101\098\101\097\114\100")))then C=C+1 if u:ID()==381748 then local u,j,R=Y:Class()if Y:BuffUp(P(h[R]),true)then q=q+1 end elseif Y:BuffDown(u,true)then return true end end end if u:ID()==381748 and q<C then return true end return false end local qc=b.converArrayToList({385558,377004;381516;167385;384365})do b.stopCastRemains=0 function b.ShouldStopCastUpdate()local u=z:GetEnemiesInRange(40)for u,j in n(u)do if qc[j:CastSpellID()]then b.stopCastRemains=j:CastRemains()-.1 return j:CastRemains()<=z:CastRemains()+.1 end end b.stopCastRemains=0 return false end function b.ShouldStopCast(u)return b.stopCastRemains==0 or u:ExecuteTime()<b.stopCastRemains end function P.IsCastable(j,u)return j:IsLearned()and(j:CooldownUp(u)and(b.stopCastRemains==0 or j:ExecuteTime()<b.stopCastRemains))end function P.IsReady2(u)return u:IsCastable2()and u:IsUsableP()end end function b.GetCurrentEmpowerData(u)local j=0 local h={}_,_,_,StartTimeMS,EndTimeMS,_,_,_,_,StageTotal=UnitChannelInfo("\112\108\097\121\101\114")if StageTotal and StageTotal>0 then local u=0 for Y=1,StageTotal,1 do h[Y]={Start=u,Finish=u+GetUnitEmpowerStageDuration("\112\108\097\121\101\114",Y-1)/1000}R.Print(" \083\116\097\114\116"..(Y..("\058 "..h[Y].Start)))R.Print("\070\105\110\105\115\104"..(Y..("\058 "..h[Y].Finish)))u=h[Y].Finish if StartTimeMS/1000+u<=GetTime()then j=Y end end end if u then return j else return h end end local Gc={}q:RegisterForEvent(function(u,j)Gc[UnitGUID(j)]=j end,"\078\065\077\069\095\080\076\065\084\069\095\085\078\073\084\095\065\068\068\069\068")q:RegisterForEvent(function(u,j)Gc[UnitGUID(j)]=nil end,"\078\065\077\069\095\080\076\065\084\069\095\085\078\073\084\095\082\069\077\079\086\069\068")local ac={}q:RegisterForCombatEvent(function(...)local u,j,R,h,Y,C,q,G,a=select(4,...)local Z=Gc[u]if Z then if UnitIsUnit(Z.."\116\097\114\103\101\116",z:ID())and a then if not ac[z:ID()]then ac[z:ID()]={}end for u,j in n(ac[z:ID()])do if j<GetTime()and u then ac[u]=nil end end ac[z:ID()][a]=g.Nameplate[Z]:CastEnd()return end if not X("\112\108\097\121\101\114")then for u,j in n(g.Party)do if j:Exists()and(not j:IsDeadOrGhost()and j:UnitIsFriend())then if UnitIsUnit(Z.."\116\097\114\103\101\116",j:ID())and a then if not ac[j:ID()]then ac[j:ID()]={}end for u,j in n(ac[j:ID()])do if j<GetTime()and u then ac[u]=nil end end ac[j:ID()][a]=g.Nameplate[Z]:CastEnd()return end end end end end end,"\083\080\069\076\076\095\067\065\083\084\095\083\084\065\082\084","\083\080\069\076\076\095\080\069\082\073\079\068\073\067\095\095\067\065\083\084\095\083\084\065\082\084")function g.IncomingSpell(j,u)if not ac[j:ID()]then ac[j:ID()]={}end for R,h in n(ac[j:ID()])do if h<GetTime()and R then ac[j:ID()][R]=nil elseif u[R]then return R end end end function g.IncomingSpellreflection(j,u)if not ac[j:ID()]then ac[j:ID()]={}end for R,h in n(ac[j:ID()])do if h<GetTime()and R then ac[j:ID()][R]=nil elseif u[R]then for u,j in n(Gc)do if g.Nameplate[j]:CastRemains()>0 and g.Nameplate[j]:CastRemains()<1 then return R end end end end end function b.PotionSelected()local u=W.APL[k][O].PotionType.Selected local j=W.APL[k][O].PotionRank and W.APL[k][O].PotionRank.Selected local R={212265,212264;212263}local h={3;2,1}local Y=""if u=="\084\101\109\112\101\114\101\100 \080\111\116\105\111\110"then for u,R in ipairs(R)do local Y=h[(u-1)%#h+1]if(not j or tostring(Y)==j or j=="\065\110\121")and(N(R)):IsUsable()then return N(R)end end else return nil end end do local u={Spells={P(377222),P(328429),P(346835),P(187819),P(181345);P(157059);P(204611)},PetMounts={116802,87082,87078,87081;87080;87079;87076}}function z.IsInWhitelistedVehicle(j)local R=u.Spells for u=1,#R,1 do local h=R[u]if j:DebuffUp(h,true,true)then return true end end local h=u.PetMounts if Z:IsActive()then for u=1,#h,1 do local j=h[u]if Z:NPCID()==j then return true end end end return false end end do local u={P(2825);P(32182);P(80353),P(90355),P(160452),P(264667);P(390386);P(35475),P(35476),P(146555),P(178207);P(230935),P(256740),P(309658);P(381301);P(444257)}function g.BloodlustRemains(R,j)local h=R:GUID()if not h then return false end for h=1,#u,1 do local Y=u[h]if R:BuffUp(Y,true)then return R:BuffRemains(Y,true,j)end end return 0 end function g.BloodlustUp(j,u)return j:BloodlustRemains(u)>0 end function g.BloodlustDown(j,u)return not j:BloodlustUp(u)end end