local S,B=...local T=HeroDBC.DBC local l=HeroLib local q=HeroCache local p=l.Unit local E=p.Player local L=p.Target local P=p.MouseOver local c=l.Spell local F=l.MultiSpell local O=l.Item local k=l.Utils.BoolToInt local o=l.Utils.IntToBool local R=l.Utils.ValueIsInArray local I=HeroRotation()local Z=I.AoEON local i=I.CDsON local t=I.Cast local x=I.CastPooling local C=I.CastQueue local V=I.CastLeftNameplate local j=(I.Commons()).Everyone.num local W=(I.Commons()).Everyone.bool local G=pairs local U=math.floor local w=math.max local z=math.min local N=C_Timer.After local v=(I.Commons()).Everyone local K=(I.Commons()).Rogue local Y=I.GUISettingsGet()local Q={General=Y.General;Commons=Y.APL.Rogue.Commons;Assassination=Y.APL.Rogue.Assassination;Interrupt=Y.APL.Rogue.Assassination_Interrupt}local M=c.Rogue.Assassination local n=O.Rogue.Assassination local m={n.AlgetharPuzzleBox:ID(),n.AshesoftheEmbersoul:ID();n.ImperfectAscendancySerum:ID();n.TreacherousTransmitter:ID()}local b,X,u,J local s,A,H,h local d local D,r=2*E:SpellHaste(),1*E:SpellHaste()local f,g local y,a,e,Sy,By,Ty,ly local qy local py,Ey,Ly,Py,cy,Fy,Oy,ky local oy=0 local Ry local Iy,Zy local iy=0 local function ty()local S,B=E:GetTrinketData(OnUseExcludes)if iy<5 and(S.ID==0 or B.ID==0 or S.SpellID>0 and not S.Usable or B.SpellID>0 and not B.Usable)then iy=iy+1 N(5,function()ty()end)return end TrinketItem1=S.Object TrinketItem2=B.Object if TrinketItem1:HasStatAnyDps()and((not TrinketItem2:HasStatAnyDps()or S.Cooldown>=B.Cooldown)and B.ID~=n.WitherbarksBranch:ID())or S.ID==n.WitherbarksBranch:ID()then oy=1 elseif TrinketItem2:HasStatAnyDps()and((not TrinketItem1:HasStatAnyDps()or B.Cooldown>S.Cooldown)and S.ID~=n.WitherbarksBranch:ID())or B.ID==n.WitherbarksBranch:ID()then oy=2 else oy=0 end end ty()local function xy(S)if S:IsEquippedAndReady()then return TrinketItem1:ID()==S:ID()and Q.Commons.Enabled.Trinket1 or TrinketItem2:ID()==S:ID()and Q.Commons.Enabled.Trinket2 end end l:RegisterForEvent(function()iy=0 ty()end,"\080\076\065\089\069\082\095\069\081\085\073\080\077\069\078\084\095\067\072\065\078\071\069\068")local Cy={{M.Blind,"\067\097\115\116 \066\108\105\110\100 \040\073\110\116\101\114\114\117\112\116\041";function()return true end};{M.KidneyShot,"\067\097\115\116 \075\105\100\110\101\121 \083\104\111\116 \040\073\110\116\101\114\114\117\112\116\041";function()return f>0 end}}local function Vy()return E:IsInRaidArea()or E:IsInDungeonArea()or L:IsDummy()or not E:IsTanking(L)and Q.Commons.UseSoloVanish end local function jy()return(I.ToggleIconFrame:GetToggle(4)or I.CDsON())and K.TTDCheck(Q.Assassination.TimeToDie.Cooldowns,Q.Commons.Enabled.IgnoreTtdOnBoss and Zy,L:TimeToDie())or L:DebuffUp(M.Kingsbane)end M.Envenom:RegisterDamageFormula(function()return((((((E:AttackPowerDamageMod()*f)*.22)*1)*(L:DebuffUp(M.ShivDebuff)and 1.3 or 1))*(M.DeeperStratagem:IsAvailable()and 1.05 or 1))*(1+E:MasteryPct()/100))*(1+E:VersatilityDmgPct()/100)end)M.Mutilate:RegisterDamageFormula(function()return(((E:AttackPowerDamageMod()+E:AttackPowerDamageMod(true))*.485)*1)*(1+E:VersatilityDmgPct()/100)end)local function Wy()return E:BuffRemains(M.MasterAssassinBuff)==9999 end local function Gy()if Wy()then return E:GCDRemains()+3 end return E:BuffRemains(M.MasterAssassinBuff)end local function Uy()if E:BuffUp(M.ImprovedGarroteAura)then return E:GCDRemains()+3 end return E:BuffRemains(M.ImprovedGarroteBuff)end local function wy()if E:BuffUp(M.IndiscriminateCarnageAura)then return E:GCDRemains()+10 end return E:BuffRemains(M.IndiscriminateCarnageBuff)end local function zy()if H<2 then return false elseif Q.Assassination.UsePriorityRotation=="\079\110 \066\111\115\115\101\115"and L:IsInBossList()then return true end return I.ToggleIconFrame:GetToggle(2)end local function Ny()if L:DebuffUp(M.Deathmark)or L:DebuffUp(M.Kingsbane)or L:DebuffUp(M.ShivDebuff)or E:BuffUp(M.Envenom)and E:BuffRemains(M.Envenom)<=1 or E:EnergyPercentage()>=(40+30*j(M.HandOfFate:IsAvailable()))-15*j(M.ViciousVenoms:IsAvailable())or l.BossFilteredFightRemains("\060\061",20)then return true end return false end local function vy()if not M.ScentOfBlood:IsAvailable()then return true end return E:BuffStack(M.ScentOfBloodBuff)>=z(20,(M.ScentOfBlood:TalentRank()*2)*H)end local function Ky(S,B,T)local l=T or B:PandemicThreshold()return S:DebuffRefreshable(B,l)end local function Yy(S,B,T,l)local q,p=nil,T local E=L:GUID()local c=P:Exists()and P:GUID()for l,P in G(l)do if P:GUID()~=E and B(P)then if P:GUID()==c and(P:IsInMeleeRange(b)and(P:TimeToDie()>T or Q.Commons.Enabled.IgnoreTtdOnBoss and Zy or v.Buggedmobs[L:NPCID()]))then if P:GUID()==c then end I.CastTarget(S,(I.TName()).MOUSEOVER)return"\067\097\115\116 \077\111\117\115\101\111\118\101\114 "..S:Name()end if v.UnitIsCycleValid(P,p,-P:DebuffRemains(S))then q,p=P,P:TimeToDie()end end end if q then V(q,S)elseif Q.Commons.RangedMultiDoT then q,p=nil,T for T,l in G(A)do if l:GUID()~=E and(v.UnitIsCycleValid(l,p,-l:DebuffRemains(S))and B(l))then q,p=l,l:TimeToDie()end end if q then V(q,S)end end end local function Qy(S,B,T)local l=B(L)if S=="\102\105\114\115\116"and l~=0 then return L end local q=B(P)if S=="\102\105\114\115\116"and q~=0 then return P end local p,E=nil,0 local function c(T)for T,l in G(T)do local q=B(l)if not p and S=="\102\105\114\115\116"then if q~=0 then p,E=l,q end elseif S=="\109\105\110"then if not p or q<E then p,E=l,q end elseif S=="\109\097\120"then if not p or q>E then p,E=l,q end end if p and(q==E and l:TimeToDie()>p:TimeToDie())then p,E=l,q end end end c(A)if p and(E==l and T(L))then return L end if p and(E==q and(T(P)and P:IsInMeleeRange(b)))then return P end if p and T(p)then return p end return nil end local function My()if Q.Commons.Enabled.Racials then if M.BloodFury:IsCastable()then if t(M.BloodFury,true)then return"\067\097\115\116 \066\108\111\111\100 \070\117\114\121"end end if M.Berserking:IsCastable()then if t(M.Berserking,true)then return"\067\097\115\116 \066\101\114\115\101\114\107\105\110\103"end end if M.Fireblood:IsCastable()then if t(M.Fireblood,true)then return"\067\097\115\116 \070\105\114\101\098\108\111\111\100"end end if M.AncestralCall:IsCastable()then if not M.Kingsbane:IsAvailable()and L:DebuffUp(M.ShivDebuff)or L:DebuffUp(M.Kingsbane)and L:DebuffRemains(M.Kingsbane)<8 then if t(M.AncestralCall,true)then return"\067\097\115\116 \065\110\099\101\115\116\114\097\108 \067\097\108\108"end end end end return false end local function ny(S,B)if(M.Ambush:IsCastable()and E:StealthUp(true,false)or B)and(L:DebuffDown(M.DeathStalkersMarkDebuff)and M.DeathStalkersMark:IsAvailable())then if S then return M.Ambush else if t(M.Ambush)then return"\067\097\115\116 \065\109\098\117\115\104 \083\116\101\097\108\116\104\101\100"end end end if jy()and(M.Kingsbane:IsAvailable()and E:BuffUp(M.Envenom))then if M.Shiv:IsReady()and((L:DebuffUp(M.Kingsbane)or M.Kingsbane:CooldownUp())and L:DebuffDown(M.ShivDebuff))then if S then return M.Shiv else if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \040\083\116\101\097\108\116\104 \075\105\110\103\115\098\097\110\101\041"end end end end if f>=Ry and(L:DebuffUp(M.DeathStalkersMarkDebuff)or E:BuffUp(M.EdgeCase)or E:BuffUp(M.ColdBlood))then if L:DebuffUp(M.Kingsbane)and E:BuffRemains(M.Envenom)<=3 then if S then return M.Envenom else if t(M.Envenom)then return"\067\097\115\116 \069\110\118\101\110\111\109 \040\083\116\101\097\108\116\104 \075\105\110\103\115\098\097\110\101\041"end end end if Oy and Wy()then if S then return M.Envenom else if t(M.Envenom)then return"\067\097\115\116 \069\110\118\101\110\111\109 \040\077\097\115\116\101\114 \065\115\115\097\115\115\105\110\041"end end end end if M.Rupture:IsCastable()or B then local function B(S)return S:DebuffRemains(M.Rupture)end local function T(S)return f>=Ry and(E:BuffUp(M.IndiscriminateCarnageBuff)and(S:DebuffRefreshable(M.Rupture)and((not Fy or not ky or S:DebuffDown(M.Rupture))and(L:TimeToDie()>15 or Q.Commons.Enabled.IgnoreTtdOnBoss and Zy or v.Buggedmobs[L:NPCID()]))))end if I.AoEON()then local S=Qy("\109\105\110",B,T)if S and S:GUID()~=L:GUID()then if S:GUID()==P:GUID()then I.CastTarget(M.Rupture,(I.TName()).MOUSEOVER)return"\067\097\115\116 \077\111\117\115\101\111\118\101\114 \082\117\112\116\117\114\101"else V(S,M.Rupture)end end end if T(L)then if S then return M.Rupture else if t(M.Rupture)then return"\067\097\115\116 \082\117\112\116\117\114\101 \040\083\116\101\097\108\116\104 \073\110\100\105\115\099\114\105\109\105\110\097\116\101 \067\097\114\110\097\103\101\041"end end end end if M.Garrote:IsCastable()and Uy()>0 or B then local function B(S)return S:DebuffRemains(M.Garrote)end local function T(S)return(S:PMultiplier(M.Garrote)<=1 or S:DebuffRemains(M.Garrote)<12 or wy()>0 and M.Garrote:AuraActiveCount()<H)and(not Oy and((S:FilteredTimeToDie("\062",2,-S:DebuffRemains(M.Garrote))or S:TimeToDieIsNotValid())and K.CanDoTUnit(S,Sy)))end if I.AoEON()then local S=Qy("\109\105\110",B,T)if S and S:GUID()~=L:GUID()then if S:GUID()==P:GUID()then I.CastTarget(M.Garrote,(I.TName()).MOUSEOVER)return"\067\097\115\116 \077\111\117\115\101\111\118\101\114 \071\097\114\114\111\116\101"else V(S,M.Garrote)end end end if T(L)then if S then return M.Garrote else if t(M.Garrote)then return"\067\097\115\116 \071\097\114\114\111\116\101 \040\073\109\112\114\111\118\101\100 \071\097\114\114\111\116\101\041"end end end if g>=1+2*j(M.ShroudedSuffocation:IsAvailable())and(L:PMultiplier(M.Garrote)<=1 or L:DebuffRemains(M.Garrote)<12 or not Oy and Gy()<3)then if S then return M.Garrote else if t(M.Garrote)then return"\067\097\115\116 \071\097\114\114\111\116\101 \040\073\109\112\114\111\118\101\100 \071\097\114\114\111\116\101 \076\111\119 \067\080\041"end end end end end local function my(S)if not I.ToggleIconFrame:GetToggle(1)then return end if S:ID()==M.Vanish:ID()then if t(M.Vanish,true)then return"\067\097\115\116 \086\097\110\105\115\104"end return false elseif S:ID()==M.Shadowmeld:ID()then if t(M.Shadowmeld,true)then return"\067\097\115\116 \083\104\097\100\111\119\109\101\108\100"end return false end local B=ny(true,true)local T={S,B}d=C(unpack(T))if d then return"\124 "..T[2]:Name()end return false end local function by()if Q.Commons.ShowPooling and E:EnergyPredicted()<45 then if t(M.PoolEnergy)then return"\080\111\111\108 \102\111\114 \086\097\110\105\115\104"end end if M.Vanish:IsCastable()and(E:BuffDown(M.FateboundLuckyCoin)and(E:BuffStack(M.FateboundCoinTails)>=5 or E:BuffStack(M.FateboundCoinHeads)>=5))then if Vy()then d=my(M.Vanish)if d then return"\067\097\115\116 \086\097\110\105\115\104 \040\070\097\116\101\102\117\108 \069\110\100\105\110\103 \070\105\115\104\041"..d end end end if M.Vanish:IsCastable()and(not M.MasterAssassin:IsAvailable()and(not M.IndiscriminateCarnage:IsAvailable()and(M.ImprovedGarrote:IsAvailable()and(M.Garrote:CooldownUp()and((L:PMultiplier(M.Garrote)<=1 or Ky(L,M.Garrote))and((L:DebuffUp(M.Deathmark)or M.Deathmark:CooldownRemains()<4)and g>=z(H,4)))))))then if Vy()then d=my(M.Vanish)if d then return"\067\097\115\116 \086\097\110\105\115\104 \071\097\114\114\111\116\101 \068\101\097\116\104\109\097\114\107 \040\078\111 \067\097\114\110\097\103\101\041"..d end end end if Q.Commons.ShowPooling and(E:EnergyPredicted()<45 and Vy())then if t(M.PoolEnergy)then return"\080\111\111\108 \102\111\114 \086\097\110\105\115\104"end end if M.Vanish:IsCastable()and(not M.MasterAssassin:IsAvailable()and(M.IndiscriminateCarnage:IsAvailable()and(M.ImprovedGarrote:IsAvailable()and(M.Garrote:CooldownUp()and((L:PMultiplier(M.Garrote)<=1 or Ky(L,M.Garrote))and H>2)))))then if Vy()then d=my(M.Vanish)if d then return"\067\097\115\116 \086\097\110\105\115\104 \040\071\097\114\114\111\116\101 \067\097\114\110\097\103\101\041"..d end end end if M.Vanish:IsCastable()and(not M.ImprovedGarrote:IsAvailable()and(M.MasterAssassin:IsAvailable()and(not Ky(L,M.Rupture)and(L:DebuffRemains(M.Garrote)>3 and(L.DebuffUp(M.Deathmark)and(L.DebuffUp(M.ShivDebuff)or L.DebuffRemains(M.Deathmark)<4))))))then if Vy()then d=my(M.Vanish)if d then return"\067\097\115\116 \086\097\110\105\115\104 \040\077\097\115\116\101\114 \065\115\115\097\115\115\105\110\041"..d end end end if M.Vanish:IsCastable()and(M.ImprovedGarrote:IsAvailable()and(M.Garrote:CooldownUp()and((L:PMultiplier(M.Garrote)<=1 or Ky(L,M.Garrote))and(L:DebuffUp(M.Deathmark)or M.Deathmark:CooldownRemains()<4))))then if Vy()then d=my(M.Vanish)if d then return"\067\097\115\116 \086\097\110\105\115\104 \040\073\109\112\114\111\118\101\100 \071\097\114\114\111\116\101 \100\117\114\105\110\103 \068\101\097\116\104\109\097\114\107\041"..d end end end end local function Xy()if not(Q.Commons.Enabled.Trinket1 or Q.Commons.Enabled.Trinket2)then return end if xy(n.AshesoftheEmbersoul)then if L:DebuffUp(M.Kingsbane)and L:DebuffRemains(M.Kingsbane)<=11 or l.BossFilteredFightRemains("\060",22)then if t(n.AshesoftheEmbersoul)then return"\065\115\104\101\115 \111\102 \116\104\101 \069\109\098\101\114\115\111\117\108"end end end if xy(n.AlgetharPuzzleBox)then if L:DebuffUp(M.Rupture)and M.Deathmark:CooldownRemains()<=2 or l.BossFilteredFightRemains("\060",22)then if t(n.AlgetharPuzzleBox)then return"\065\108\103\101\116\104\097\114 \080\117\122\122\108\101 \066\111\120"end end end if xy(n.TreacherousTransmitter)then if L:DebuffUp(M.Rupture)and M.Deathmark:CooldownRemains()<=2 or L:DebuffUp(M.Deathmark)or l.BossFilteredFightRemains("\060",22)then if t(n.TreacherousTransmitter)then return"\084\114\101\097\099\104\101\114\111\117\115 \084\114\097\110\115\109\105\116\116\101\114"end end end if xy(n.MadQueensMandate)then if M.Deathmark:CooldownRemains()>=30 and L:DebuffDown(M.Deathmark)or l.BossFilteredFightRemains("\060\061",3)then if t(n.MadQueensMandate)then return"\077\097\100 \081\117\101\101\110\'\115 \077\097\110\100\097\116\101"end end end if xy(n.ImperfectAscendancySerum)then if L:DebuffUp(M.Rupture)and M.Deathmark:CooldownRemains()<=2 or L:DebuffUp(M.Deathmark)or l.BossFilteredFightRemains("\060",22)then if t(n.ImperfectAscendancySerum)then return"\073\109\112\101\114\102\101\099\116 \065\115\099\101\110\100\097\110\099\121 \083\101\114\117\109"end end end if TrinketItem1:IsReady()and(Q.Commons.Enabled.Trinket1 and(not E:IsItemBlacklisted(TrinketItem1)and not R(m,TrinketItem1:ID())))then if oy==1 and(M.Deathmark:AnyDebuffUp()or not M.Deathmark:IsAvailable()or l.BossFilteredFightRemains("\060",20))or oy==2 and(not TrinketItem2:IsReady()or not M.Deathmark:AnyDebuffUp()and M.Deathmark:CooldownRemains()>20)or oy==0 then if t(TrinketItem1)then return"\084\114\105\110\107\101\116 \049"end end end if TrinketItem2:IsReady()and Q.Commons.Enabled.Trinket2 then if not E:IsItemBlacklisted(TrinketItem2)and(not R(m,TrinketItem2:ID())and(oy==2 and(M.Deathmark:AnyDebuffUp()or not M.Deathmark:IsAvailable()or l.BossFilteredFightRemains("\060",20))or oy==1 and(not TrinketItem1:IsReady()or not M.Deathmark:AnyDebuffUp()and M.Deathmark:CooldownRemains()>20)or oy==0))then if t(TrinketItem2)then return"\084\114\105\110\107\101\116 \050"end end end end local function uy()local S=L:DebuffDown(M.ShivDebuff)and(L:DebuffUp(M.Garrote)and L:DebuffUp(M.Rupture))local B=M.Kingsbane:IsAvailable()and(E:BuffUp(M.Envenom)and S)if M.Shiv:IsReady()then if M.ArterialPrecision:IsAvailable()and(S and H>=4)then if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \040\065\114\116\101\114\105\097\108 \080\114\101\099\105\115\105\111\110\041"end end if not M.LightweightShiv:IsAvailable()and(B and((L:DebuffUp(M.Kingsbane)and L:DebuffRemains(M.Kingsbane)<8 or not L:DebuffUp(M.Kingsbane)and M.Kingsbane:CooldownRemains()>=24)and(not M.CrimsonTempest:IsAvailable()or Oy or L:DebuffUp(M.CrimsonTempest))))then if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \040\075\105\110\103\115\098\097\110\101\041"end end if M.LightweightShiv:IsAvailable()and(B and(L:DebuffUp(M.Kingsbane)or M.Kingsbane:CooldownRemains()<=1))then if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \040\075\105\110\103\115\098\097\110\101 \076\105\103\104\116\119\101\105\103\104\116\041"end end if M.ArterialPrecision:IsAvailable()and(S and M.Deathmark:AnyDebuffUp())then if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \040\065\114\116\101\114\105\097\108 \080\114\101\099\105\115\105\111\110 \068\101\097\116\104\109\097\114\107\041"end end if not M.Kingsbane:IsAvailable()and(not M.ArterialPrecision:IsAvailable()and(S and(not M.CrimsonTempest:IsAvailable()or Oy or L:DebuffUp(M.CrimsonTempest))))then if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \110\111 \075\066"end end if l.BossFilteredFightRemains("\060\061",M.Shiv:Charges()*8)then if t(M.Shiv,true)then return"\067\097\115\116 \083\104\105\118 \040\069\110\100 \070\105\103\104\116\041"end end end end local function Jy()if Q.Commons.Enabled.Potions then local S=v.PotionSelected()if S and(S:IsReady()and(E:BloodlustUp()or l.BossFilteredFightRemains("\060",30)or M.Deathmark:AnyDebuffUp()))then I.CastMacro(3,nil,nil,S)return"\067\097\115\116 \080\111\116\105\111\110"end end if M.Deathmark:AnyDebuffUp()then d=My()if d then return d end end end local function sy()return I.CDsON()and K.TTDCheck(Q.Assassination.TimeToDie.Cooldowns,Q.Commons.Enabled.IgnoreTtdOnBoss and Zy,L:TimeToDie())or L:DebuffUp(M.Deathmark)or L:DebuffUp(M.Kingsbane)end local function Ay()if not J then return end local S=not E:StealthUp(true,false)and(E:BuffRemains(M.SliceandDice)>5 and(L:DebuffUp(M.Rupture)and(E:BuffUp(M.Envenom)and(not M.Deathmark:AnyDebuffUp()and((not M.MasterAssassin:IsAvailable()or L:DebuffUp(M.Garrote))and(not M.Kingsbane:IsAvailable()or M.Kingsbane:CooldownRemains()<=2))))))if sy()and(Q.Commons.Enabled.Trinket1 or Q.Commons.Enabled.Trinket2)then d=Xy()if d then return d end end if sy()and M.Deathmark:IsCastable()then if S or l.BossFilteredFightRemains("\060\061",20)then if t(M.Deathmark,true)then return"\067\097\115\116 \068\101\097\116\104\109\097\114\107"end end end d=jy()and uy()if d then return d end if jy()and M.Kingsbane:IsCastable()then if(L:DebuffUp(M.ShivDebuff)or M.Shiv:CooldownRemains()<6)and(E:BuffUp(M.Envenom)and(M.Deathmark:CooldownRemains()>=50 or L:DebuffUp(M.Deathmark)or not i()))or l.BossFilteredFightRemains("\060\061",15)then if t(M.Kingsbane,true)then return"\067\097\115\116 \075\105\110\103\115\098\097\110\101"end end end if sy()then if d then Jy()else d=Jy()if d then return d end end end if sy()and(not E:StealthUp(true,true)and Gy()<=0)then if d then by()else d=by()if d then return d end end end if jy()and(M.ColdBlood:IsReady()and E:DebuffDown(M.ColdBlood))then if E:BuffDown(M.EdgeCase)and(M.Deathmark:CooldownRemains()>10 and(E:BuffDown(M.DarkestNightBuff)and(f>=Ry and((py or L:DebuffStack(M.AmplifyingPoisonDebuff)>=20 or not Oy)and(E:BuffDown(K.VanishBuffSpell())and((not M.Kingsbane:CooldownUp()or not Oy)and(not M.Deathmark:CooldownUp()or not i())))))))then if t(M.ColdBlood,true)then return"\067\097\115\116 \067\111\108\100 \066\108\111\111\100"end end return d end end local function Hy(S)return Ky(S,M.Garrote)and S:PMultiplier(M.Garrote)<=1 end local function hy(S)By=(4+k(M.DashingScoundrel:IsAvailable())*5)+k(Fy)*6 return Ky(S,M.Rupture,y)and(S:PMultiplier(M.Rupture)<=1 and(S:FilteredTimeToDie("\062",By,-S:DebuffRemains(M.Rupture))or S:TimeToDieIsNotValid()))end local function dy()if M.Garrote:IsCastable()and g>=1 then if Hy(L)and(K.CanDoTUnit(L,Sy)and(L:FilteredTimeToDie("\062",12,-L:DebuffRemains(M.Garrote))or L:TimeToDieIsNotValid()))then if x(M.Garrote)then return"\080\111\111\108 \102\111\114 \071\097\114\114\111\116\101 \040\083\084\041"end end end if M.Rupture:IsReady()and(f>=Ry and E:BuffDown(M.DarkestNightBuff))then if hy(L)and K.CanDoTUnit(L,e)then if x(M.Rupture)then return"\067\097\115\116 \082\117\112\116\117\114\101"end end end if M.CrimsonTempest:IsReady()and(f>=Ry and(Ky(L,M.CrimsonTempest)and(E:BuffRemains(M.MomentumOfDespair)>6 and Oy)))then if t(M.CrimsonTempest)then return"\067\114\105\109\115\111\110 \084\101\109\112\101\115\116 \119\105\116\104 \077\111\109\101\110\116\117\109 \111\102 \068\101\115\112\097\105\114"end end end local function Dy()local S=f>=Ry if I.AoEON()and(M.CrimsonTempest:IsCastable()and(H>=2 and S))then for S,B in G(A)do if Ky(B,M.CrimsonTempest,a)and B:FilteredTimeToDie("\062",6,-B:DebuffRemains(M.CrimsonTempest))then if t(M.CrimsonTempest)then return"\067\097\115\116 \067\114\105\109\115\111\110 \084\101\109\112\101\115\116 \040\065\111\069 \072\105\103\104 \069\110\101\114\103\121\041"end end end end if M.Garrote:IsCastable()and g>=1 then if Hy(L)and(not Fy and(L:FilteredTimeToDie("\062",12,-L:DebuffRemains(M.Garrote))or L:TimeToDieIsNotValid()))then local S=Yy(M.Garrote,Hy,12,A)if S then return S end end end if M.Rupture:IsReady()and(I.AoEON()and(S and((L:DebuffDown(M.Kingsbane)or E:BuffUp(M.ColdBlood))and((not Fy and(M.ScentOfBlood:TalentRank()==2 or M.ScentOfBlood:TalentRank()<=1 and E:BuffUp(M.IndiscriminateCarnageBuff or L:TimeToDie()>15 or Q.Commons.Enabled.IgnoreTtdOnBoss and Zy or v.Buggedmobs[L:NPCID()])))and((L:TimeToDie()>(7+k(M.DashingScoundrel:IsAvailable())*5)+k(Fy)*6 or Q.Commons.Enabled.IgnoreTtdOnBoss and Zy or v.Buggedmobs[L:NPCID()])and E:BuffDown(M.DarkestNightBuff))))))then local S=Yy(M.Rupture,hy,By,A)if S then return S end end if M.Rupture:IsReady()and(S and(E:BuffDown(M.DarkestNightBuff)and I.AoEON()))then By=(7+k(M.DashingScoundrel:IsAvailable())*5)+k(Fy)*6 if not L:DebuffUp(M.Kingsbane or E:BuffUp(M.ColdBlood))and Fy or not ky then local S=Yy(M.Rupture,hy,By,h)if S then return S end end end if M.Garrote:IsReady()and(g>=1 and(Gy()<=0 and((L:PMultiplier(M.Garrote)<=1 or L:DebuffRemains(M.Garrote)<D and H>=3)and((L:DebuffRemains(M.Garrote)<D*2 and H>=3)and(L:FilteredTimeToDie("\062",4,-L:DebuffRemains(M.Garrote))or L:TimeToDieIsNotValid())))))then if t(M.Garrote)then return"\071\097\114\114\111\116\101 \040\070\097\108\108\098\097\099\107\041"end end return false end local function ry()if M.Envenom:IsReady()and(E:BuffDown(M.DarkestNightBuff)and(f>Ry and((py or L:DebuffStack(M.AmplifyingPoisonDebuff)>=20 or f>K.CPMaxSpend()or not Oy)and E:BuffDown(K.VanishBuffSpell()))))then if t(M.Envenom)then return"\067\097\115\116 \069\110\118\101\110\111\109 \049"end end if M.Envenom:IsReady()and(E:BuffUp(M.DarkestNightBuff)and f>=K.CPMaxSpend())then if t(M.Envenom)then return"\067\097\115\116 \069\110\118\101\110\111\109 \050"end end if not(g>1 or py or not Oy)then return false end if not Oy and(M.CausticSpatter:IsAvailable()and(L:DebuffUp(M.Rupture)and L:DebuffRemains(M.CausticSpatterDebuff)<=2))then if M.Mutilate:IsCastable()then if x(M.Mutilate)then return"\067\097\115\116 \077\117\116\105\108\097\116\101 \040\067\097\115\117\116\105\099\041"end end if(M.Ambush:IsReady()or M.AmbushOverride:IsReady())and(E:StealthUp(true,true)or E:BuffUp(M.BlindsideBuff))then if t(M.Ambush)then return"\067\097\115\116 \065\109\098\117\115\104 \040\067\097\117\115\116\105\099\041"end end end if jy()and M.EchoingReprimand:IsReady()then if t(M.EchoingReprimand,true)then return"\067\097\115\116 \069\099\104\111\105\110\103 \082\101\112\114\105\109\097\110\100"end end if M.FanofKnives:IsReady()then if I.AoEON()and(not qy and H>=3-k(M.MomentumOfDespair and M.ThrownPrecision))or E:BuffUp(M.ClearTheWitnessesBuff)and not M.ViciousVenoms:IsAvailable()then if x(M.FanofKnives)then return"\067\097\115\116 \070\097\110 \111\102 \075\110\105\118\101\115"end end end if I.AoEON()and(E:BuffUp(M.DeadlyPoison)and H>=3-k(M.MomentumOfDespair:IsAvailable()and M.ThrownPrecision:IsAvailable()))then for S,B in G(A)do if not B:DebuffUp(M.DeadlyPoisonDebuff,true)and(not qy or B:DebuffUp(M.Garrote)or B:DebuffUp(M.Rupture))then if x(M.FanofKnives)then return"\067\097\115\116 \070\097\110 \111\102 \075\110\105\118\101\115 \040\068\080 \082\101\102\114\101\115\104\041"end end end end if(M.Ambush:IsReady()or M.AmbushOverride:IsReady())and((E:BuffUp(M.BlindsideBuff)or E:StealthUp(true,false))and(L:DebuffDown(M.Kingsbane)or L:DebuffDown(M.Deathmark)or E:BuffUp(M.BlindsideBuff)))then if x(M.Ambush)then return"\067\097\115\116 \065\109\098\117\115\104"end end if M.Mutilate:IsCastable()and(H==2 and(L:DebuffDown(M.DeadlyPoisonDebuff,true)and L:DebuffDown(M.AmplifyingPoisonDebuff,true)))then local S=L:GUID()if(L:DebuffUp(M.Garrote)or L:DebuffUp(M.Rupture))and(not L:DebuffUp(M.DeadlyPoisonDebuff,true)and not L:DebuffUp(M.AmplifyingPoisonDebuff,true))then t(M.Mutilate)return"\067\097\115\116 \082\101\097\112\112\108\121\068\101\098\117\102\102 \077\117\116\105\108\097\116\101"end for B,T in G(A)do if T:GUID()~=S and((T:DebuffUp(M.Garrote)or T:DebuffUp(M.Rupture))and(not T:DebuffUp(M.DeadlyPoisonDebuff,true)and not T:DebuffUp(M.AmplifyingPoisonDebuff,true)))then if T:GUID()==P:GUID()and T:IsInMeleeRange(b)then I.CastTarget(M.Mutilate,(I.TName()).MOUSEOVER)return"\067\097\115\116 \077\111\117\115\101\111\118\101\114 \077\117\116\105\108\097\116\101"else V(T,M.Mutilate)end break end end end if M.Mutilate:IsCastable()then if x(M.Mutilate)then return"\067\097\115\116 \077\117\116\105\108\097\116\101"end end return false end local function fy()b=5 X=10 u=L:IsInMeleeRange(b)J=L:IsInMeleeRange(X)Iy=l.BossFightRemains()Zy=true if Iy==11111 then Zy=false Iy=l.FightRemains(s,false)end if Z()then s=E:GetEnemiesInRange(30)A=E:GetEnemiesInMeleeRange(X)H=#A h=E:GetEnemiesInMeleeRange(b)else s={}A={}H=1 h={}end D,r=2*E:SpellHaste(),1*E:SpellHaste()f=K.EffectiveComboPoints(E:ComboPoints())g=E:ComboPointsMax()-f y=(4+f*4)*.3 a=(4+f*2)*.3 e=M.Envenom:Damage()*Q.Assassination.EnvenomDMGOffset Sy=M.Mutilate:Damage()*Q.Assassination.MutilateDMGOffset qy=zy()Ry=w(E:ComboPointsMax()-2,5*j(M.HandOfFate:IsAvailable()))d=K.Defense()if d then return d end d=K.Poisons()if d then return d end Ry=w(E:ComboPointsMax()-2,5*j(M.HandOfFate:IsAvailable()))if not E:AffectingCombat()then if not E:BuffUp(K.VanishBuffSpell())then d=K.Stealth(K.StealthSpell())if d then return d end end if K.CombatCheck()then if not E:BuffUp(M.SliceandDice)then if M.SliceandDice:IsReady()and f>=2 then if t(M.SliceandDice)then return"\067\097\115\116 \083\108\105\099\101 \097\110\100 \068\105\099\101"end end end end end if K.CombatCheck()then if I.ToggleIconFrame:GetToggle(3)then d=v.InterruptCycle(M.Kick,b,true,nil,false)if d then return d end d=Q.Interrupt.UseBlind and v.IncorpCycle(M.Blind,15,true,nil,false)if d then return d end d=Q.Interrupt.UseBlind and v.InterruptCycle(M.Blind,15,true,nil,true)if d then return d end if L:DebuffDown(M.Deathmark)or L:DebuffDown(M.Kingsbane)then d=Q.Interrupt.UseKidneyShot and(f>0 and v.InterruptCycle(M.KidneyShot,b,true,nil,true))if d then return d end d=Q.Interrupt.UseCheapShop and(E:StealthUp(true,true)and v.InterruptCycle(M.CheapShot,b,true,nil,true))if d then return d end end end d=Q.Commons.Enabled.Shiv and v.SootheCycle(M.Shiv,9,false,Q.Commons.Enabled["\083\104\105\118 \065\117\116\111 \084\097\114\103\101\116"])if d then return d end Ly=K.PoisonedBleeds()Py=E:EnergyRegen()+(Ly*6)/(2*E:SpellHaste())cy=E:EnergyDeficit()/Py Fy=Py>35 py=Ny()ky=vy()Oy=H<2 if Oy then if not L:IsInRange(25)then return end else if H==1 then return end end if jy()and(M.ThistleTea:IsCastable()and not E:BuffUp(M.ThistleTea))then if(E:EnergyDeficit()>=100+Py or M.ThistleTea:Charges()>=3)and L:DebuffRemains(M.ShivDebuff)>=4 or H>=4 and L:DebuffRemains(M.Shiv)>=6 or l.BossFilteredFightRemains("\060",M.ThistleTea:Charges()*6)then if I.Cast(M.ThistleTea,true)then return"\067\097\115\116 \084\104\105\115\116\108\101 \084\101\097"end end end if E:StealthUp(true,false)or Uy()>0 or Gy()>0 then d=ny()if d then return d.." \040\083\116\101\097\108\116\104\101\100\041"end end if not E:BuffUp(M.SliceandDice)then if M.SliceandDice:IsReady()and(L:DebuffUp(M.Rupture)and(E:ComboPoints()>=1 and(E:BuffDown(M.IndiscriminateCarnageBuff)or Oy)))then if t(M.SliceandDice)then return"\067\097\115\116 \083\108\105\099\101 \097\110\100 \068\105\099\101"end end elseif J then if M.Envenom:IsReady()and(E:BuffRemains(M.SliceandDice)<5 and E:ComboPoints()>=5)then if t(M.Envenom)then return"\067\097\115\116 \069\110\118\101\110\111\109 \040\067\116\116\067\041"end end else if M.PoisonedKnife:IsCastable()and(L:IsInRange(30)and(not E:StealthUp(true,true)and(H==0 and E:EnergyTimeToMax()<=E:GCD()*1.5)))then if t(M.PoisonedKnife)then return"\067\097\115\116 \080\111\105\115\111\110\101\100 \075\110\105\102\101"end end end d=Ay()if d then return d end d=dy()if d then return d end if I.AoEON()and not Oy then d=Dy()if d then return d end end d=ry()if d then return d end if sy()and Q.Commons.Enabled.Racials then if M.ArcaneTorrent:IsCastable()and(u and E:EnergyDeficit()>=15+Py)then if t(M.ArcaneTorrent,true)then return"\067\097\115\116 \065\114\099\097\110\101 \084\111\114\114\101\110\116"end end if M.ArcanePulse:IsCastable()and u then if t(M.ArcanePulse,true)then return"\067\097\115\116 \065\114\099\097\110\101 \080\117\108\115\101"end end if M.LightsJudgment:IsCastable()and u then if t(M.LightsJudgment,true)then return"\067\097\115\116 \076\105\103\104\116\115 \074\117\100\103\109\101\110\116"end end if M.BagofTricks:IsCastable()and u then if t(M.BagofTricks,true)then return"\067\097\115\116 \066\097\103 \111\102 \084\114\105\099\107\115"end end end if M.Mutilate:IsCastable()or M.Ambush:IsReady()or M.AmbushOverride:IsReady()then if t(M.PoolEnergy)then return"\078\111\114\109\097\108 \080\111\111\108\105\110\103"end end end end local function gy()M.Deathmark:RegisterAuraTracking()M.Sepsis:RegisterAuraTracking()M.Garrote:RegisterAuraTracking()Q.Assassination.Display()I.Print("\065\115\115\097\115\115\105\110\097\116\105\111\110 \082\111\103\117\101 \114\111\116\097\116\105\111\110 \104\097\115 \098\101\101\110 \117\112\100\097\116\101\100 \102\111\114 \112\097\116\099\104 \049\049\046\048\046\048\046")end I.SetAPL(259,fy,gy)