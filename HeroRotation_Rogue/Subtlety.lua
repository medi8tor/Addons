local K,V=...local s=HeroDBC.DBC local w=HeroLib local p=HeroCache local N=w.Unit local d=N.Player local R=N.Target local y=N.MouseOver local C=w.Spell local T=w.MultiSpell local o=w.Item local I=w.Utils.BoolToInt local u=w.Utils.ValueIsInArray local j=HeroRotation()local l=j.AoEON local Y=j.CDsON local q=j.Cast local v=j.CastLeftNameplate local n=j.CastPooling local F=j.CastQueue local k=j.CastQueuePooling local r=(j.Commons()).Everyone.num local A=(j.Commons()).Everyone.bool local J=pairs local U=table.insert local Q=math.min local B=math.max local Z=math.abs local i=C_Timer.After local G=(j.Commons()).Everyone local m=(j.Commons()).Rogue local D=C.Rogue.Subtlety local x=o.Rogue.Subtlety local H={x.ImperfectAscendancySerum:ID(),x.TreacherousTransmitter:ID()}local h,f,S,t local O,g,X,e local z local a,c,L local E,M local P,b,W,KE local VE local sE,wE local pE,NE=d:GetTrinketItems()if pE:ID()==0 or NE:ID()==0 then i(2,function()pE,NE=d:GetTrinketItems()end)end w:RegisterForEvent(function()pE,NE=d:GetTrinketItems()end,"\080\076\065\089\069\082\095\069\081\085\073\080\077\069\078\084\095\067\072\065\078\071\069\068")D.Eviscerate:RegisterDamageFormula(function()return((((((((((d:AttackPowerDamageMod()*P)*.176)*1.21)*(D.Nightstalker:IsAvailable()and(d:StealthUp(true,false)and 1.08)or 1))*(D.DeeperStratagem:IsAvailable()and 1.05 or 1))*(D.DarkShadow:IsAvailable()and(d:BuffUp(D.ShadowDanceBuff)and 1.3)or 1))*(d:BuffUp(D.SymbolsofDeath)and 1.1 or 1))*(d:BuffUp(D.FinalityEviscerateBuff)and 1.3 or 1))*(1+d:MasteryPct()/100))*(1+d:VersatilityDmgPct()/100))*(R:DebuffUp(D.FindWeaknessDebuff)and 1.5 or 1)end)local dE=j.GUISettingsGet()local RE={General=dE.General,Commons=dE.APL.Rogue.Commons;Subtlety=dE.APL.Rogue.Subtlety;Interrupt=dE.APL.Rogue.Subtlety_Interrupt}local function yE()return not G.ISSolo()or R:IsDummy()or not d:IsTanking(R)and RE.Commons.UseSoloVanish end local function CE()return(j.ToggleIconFrame:GetToggle(4)or j.CDsON())and m.TTDCheck(RE.Subtlety.TimeToDie.Cooldowns,RE.Commons.Enabled.IgnoreTtdOnBoss and wE,sE)end local function TE()return j.CDsON()and m.TTDCheck(RE.Subtlety.TimeToDie.Cooldowns,RE.Commons.Enabled.IgnoreTtdOnBoss and wE,sE)end local function oE(K,V)if not a then a=K c=V or 0 end end local function IE(K)if not L then L=K end end local function uE()if RE.Subtlety.BurnShadowDance=="\079\110 \066\111\115\115\101\115 \110\111\116 \105\110 \068\117\110\103\101\111\110\115"and d:IsInDungeonArea()then return false elseif RE.Subtlety.BurnShadowDance~="\065\108\119\097\121\115"and not R:IsInBossList()then return false else return true end end local function jE()if X<2 then return false elseif RE.Subtlety.UsePriorityRotation=="\079\110 \066\111\115\115\101\115"and R:IsInBossList()then return true end return j.ToggleIconFrame:GetToggle(2)end local function lE(K,V,s,w)local p,N=nil,s local d=R:GUID()local C=y:Exists()and y:GUID()for w,y in J(w)do if y:GUID()~=d and V(y)then if y:GUID()==C and(y:TimeToDie()>s or RE.Commons.Enabled.IgnoreTtdOnBoss and wE or G.Buggedmobs[R:NPCID()])then j.CastTarget(K,(j.TName()).MOUSEOVER)return"\067\097\115\116 \077\111\117\115\101\111\118\101\114 "..K:Name()end if G.UnitIsCycleValid(y,N,-y:DebuffRemains(K))then p,N=y,y:TimeToDie()end end end if p then v(p,K)end end local function YE()return((20+D.Vigor:TalentRank()*25)+r(D.ThistleTea:IsAvailable())*20)+r(D.Shadowcraft:IsAvailable())*20 end local function qE()return d:BuffUp(D.SliceandDice)end local function vE(K)return d:BuffUp(D.ThistleTea)and X==1 or K and(X==1 or R:DebuffUp(D.Rupture)and X>=2)or d:BuffUp(D.DarkestNightBuff)end local function nE()return VE or X<=4 or D.InvigoratingShadowdust:IsAvailable()and not D.FollowTheBlood:IsAvailable()or D.ReplicatingShadows:IsAvailable()and(X>=5 and D.Rupture:AuraActiveCount()>=X-2)or not D.ReplicatingShadows:IsAvailable()end local function FE(K)return d:BuffUp(D.ShadowDanceBuff)and K:TimeSinceLastCast()<D.ShadowDance:TimeSinceLastCast()end local function kE()return d:BuffStack(D.DanseMacabreBuff)>=3 or not D.DanseMacabre:IsAvailable()or D.UnseenBlade:IsAvailable()and(d:BuffUp(D.ShadowDanceBuff)and(d:BuffStack(D.EscalatingBlade)>=2 or d:BuffUp(D.ShadowBlades)))end local function rE()local K=0 if pE:HasStatAnyDps()and(not NE:HasStatAnyDps()or pE:Cooldown()>=pE:Cooldown())then K=1 elseif NE:HasStatAnyDps()and(not pE:HasStatAnyDps()or NE:Cooldown()>NE:Cooldown())then K=2 end return K end local function AE(K)if K:IsEquippedAndReady()then return pE:ID()==K:ID()and RE.Commons.Enabled.Trinket1 or NE:ID()==K:ID()and RE.Commons.Enabled.Trinket2 end end local function JE(K,V)local s=d:BuffUp(D.ShadowDanceBuff)local w=d:BuffRemains(D.ShadowDanceBuff)local p=d:BuffRemains(D.SymbolsofDeath)local N=b local y=D.ColdBlood:CooldownRemains()local C=D.SymbolsofDeath:CooldownRemains()local T=d:BuffUp(D.PremeditationBuff)or V and D.Premeditation:IsAvailable()if V and V:ID()==D.ShadowDance:ID()then s=true w=8+D.ImprovedShadowDance:TalentRank()if D.TheFirstDance:IsAvailable()then N=Q(d:ComboPointsMax(),b+4)end if d:HasTier(30,2)then p=B(p,6)end end if V and V:ID()==D.Vanish:ID()then y=Q(0,D.ColdBlood:CooldownRemains()-15*D.InvigoratingShadowdust:TalentRank())C=Q(0,D.SymbolsofDeath:CooldownRemains()-15*D.InvigoratingShadowdust:TalentRank())end if D.Rupture:IsCastable()and D.Rupture:IsReady()then if R:DebuffDown(D.Rupture)and(R:TimeToDie()>6 or RE.Commons.Enabled.IgnoreTtdOnBoss and wE or G.Buggedmobs[R:NPCID()])then if K then return D.Rupture else if D.Rupture:IsReady()and q(D.Rupture)then return"\067\097\115\116 \082\117\112\116\117\114\101 \049"end IE(D.Rupture)end end end if(not vE(s)or VE)and(R:TimeToDie()>6 and R:DebuffRefreshable(D.Rupture,E))then if K then return D.Rupture else if D.Rupture:IsReady()and q(D.Rupture)then return"\067\097\115\116 \082\117\112\116\117\114\101 \050"end IE(D.Rupture)end end if D.CoupDeGrace:IsReady()and D.CoupDeGrace:IsCastable()then if R:DebuffUp(D.FazedDebuff)and(d:BuffUp(D.ShadowDanceBuff)or d:BuffUp(D.SymbolsofDeath)and D.ShadowDance:ChargesFractional()<=.85)then if K then return D.CoupDeGrace else if D.CoupDeGrace:IsReady()and q(D.CoupDeGrace)then return"\067\097\115\116 \067\111\117\112 \068\101 \071\114\097\099\101 \049"end IE(D.CoupDeGrace)end end end if D.SecretTechnique:IsReady()then if kE(s,T)and(not D.ColdBlood:IsAvailable()or D.ColdBlood:IsReady()or d:BuffUp(D.ColdBlood)or y>w-2 or not D.ImprovedShadowDance:IsAvailable())then if K then return D.SecretTechnique end if j.CastMacro(10,nil,nil,D.SecretTechnique)then return"\067\097\115\116 \083\101\099\114\101\116 \084\101\099\104\110\105\113\117\101"end end end if not vE(s)and D.Rupture:IsCastable()then if not K and(j.AoEON()and(not VE and X>=2))then local function K(K)return G.CanDoTUnit(K,M)and K:DebuffRefreshable(D.Rupture,E)end local V=lE(D.Rupture,K,2*N,e)if V then return V end end if d:BuffUp(D.FinalityRuptureBuff)and(D.SymbolsofDeath:CooldownRemains()<=3 or d:BuffUp(D.SymbolsofDeath))then if K then return D.Rupture else if D.Rupture:IsReady()and q(D.Rupture)then return"\067\097\115\116 \082\117\112\116\117\114\101 \050"end IE(D.Rupture)end end end if D.BlackPowder:IsCastable()and(not VE and(D.DeathStalkersMark:IsAvailable()and(X>=3 and d:BuffDown(D.DarkestNightBuff))))then if K then return D.BlackPowder else if D.BlackPowder:IsReady()and q(D.BlackPowder)then return"\067\097\115\116 \066\108\097\099\107 \080\111\119\100\101\114 \049"end IE(D.BlackPowder)end end if D.BlackPowder:IsCastable()and(not VE and(D.UnseenBlade:IsAvailable()and(d:BuffStack(D.EscalatingBlade)==4 and d:BuffDown(D.ShadowDanceBuff)or X>=3 and d:BuffDown(D.FlawlessFormBuff)or not FE(D.BlackPowder)and(d:BuffUp(D.ShadowDanceBuff)and(D.ShurikenTornado:IsAvailable()and X>=3)))))then if K then return D.BlackPowder else if D.BlackPowder:IsReady()and q(D.BlackPowder)then return"\067\097\115\116 \066\108\097\099\107\080\111\119\100\101\114 \050"end IE(D.BlackPowder)end end if D.CoupDeGrace:IsCastable()and(S and R:DebuffUp(D.FazedDebuff))then if K then return D.CoupDeGrace else if D.CoupDeGrace:IsReady()and q(D.CoupDeGrace)then return"\067\097\115\116 \067\111\117\112 \068\101 \071\114\097\099\101 \050"end IE(D.CoupDeGrace)end end if D.Eviscerate:IsCastable()and S then if K then return D.Eviscerate else if D.Eviscerate:IsReady()and q(D.Eviscerate)then return"\067\097\115\116 \069\118\105\115\099\101\114\097\116\101"end IE(D.Eviscerate)end end return false end local function UE(K,V)local s=d:BuffUp(D.ShadowDanceBuff)local w=d:BuffRemains(D.ShadowDanceBuff)local p=d:BuffUp(D.TheRottenBuff)local N,y=b,W local C=d:BuffUp(D.PremeditationBuff)or V and D.Premeditation:IsAvailable()local T=d:BuffUp(m.StealthSpell())or V and V:ID()==(m.StealthSpell()):ID()local o=d:BuffUp(m.VanishBuffSpell())or V and V:ID()==D.Vanish:ID()if V and V:ID()==D.ShadowDance:ID()then s=true w=8+D.ImprovedShadowDance:TalentRank()if D.TheRotten:IsAvailable()and d:HasTier(30,2)then p=true end if D.TheFirstDance:IsAvailable()then N=Q(d:ComboPointsMax(),b+4)y=d:ComboPointsMax()-N end end local I=m.EffectiveComboPoints(N)local u=D.Shadowstrike:IsCastable()or T or o or s or d:BuffUp(D.SepsisBuff)if T or o then u=u and R:IsInRange(25)else u=u and S end if u and(D.DeathStalkersMark:IsAvailable()and(R:DebuffDown(D.DeathStalkersMarkDebuff)and d:BuffDown(D.DarkestNightBuff)))then if K then return D.Shadowstrike else if q(D.Shadowstrike)then return"\067\097\115\116 \083\104\097\100\111\119\115\116\114\105\107\101 \040\083\116\101\097\108\116\104 \049\041"end end end if d:BuffUp(D.DarkestNightBuff)and b==m.CPMaxSpend()then return JE(K,V)end if P>=m.CPMaxSpend()and d:BuffDown(D.DarkestNightBuff)then return JE(K,V)end if d:BuffUp(D.ShurikenTornado)and(y<=2 and d:BuffDown(D.DarkestNightBuff))then return JE(K,V)end if W<=1+r(D.DeathStalkersMark:IsAvailable())and d:BuffDown(D.DarkestNightBuff)then return JE(K,V)end if u and(not FE(D.Shadowstrike)and d:BuffUp(D.ShadowBlades))or D.UnseenBlade:IsAvailable()and X>=2 then if K then return D.Shadowstrike else if q(D.Shadowstrike)then return"\067\097\115\116 \083\104\097\100\111\119\115\116\114\105\107\101 \040\083\116\101\097\108\116\104 \050\041"end end end if D.ShurikenStorm:IsCastable()then if d:BuffDown(D.PremeditationBuff)and X>=4 then if K then return D.ShurikenStorm else if q(D.ShurikenStorm)then return"\067\097\115\116 \083\104\117\114\105\107\101\110\083\116\111\114\109 \040\083\116\101\097\108\116\104\041"end end end end if D.Gloomblade:IsAvailable()then if d:BuffRemains(D.LingeringShadowBuff)>=10 and(d:BuffUp(D.ShadowBlades)and X==1)then if K then if V then return D.Gloomblade else return{D.Gloomblade;D.Stealth}end else if F(D.Gloomblade,D.Stealth)then return"\067\097\115\116 \071\108\111\111\109\098\108\097\100\101 \040\068\097\110\115\101\041"end end end end if u then if K then return D.Shadowstrike else if q(D.Shadowstrike)then return"\067\097\115\116 \083\104\097\100\111\119\115\116\114\105\107\101"end end end return false end local function QE(K,V)if not j.ToggleIconFrame:GetToggle(1)then return end if K:ID()==D.Vanish:ID()then if j.Cast(D.Vanish,true)then return"\067\097\115\116 \086\097\110\105\115\104"end return false elseif K:ID()==D.Shadowmeld:ID()then if j.Cast(D.Shadowmeld,true)then return"\067\097\115\116 \083\104\097\100\111\119\109\101\108\100"end return false elseif K:ID()==D.ShadowDance:ID()then if j.Cast(D.ShadowDance,true)then return"\067\097\115\116 \083\104\097\100\111\119 \068\097\110\099\101"end return false end local s=UE(true,K)local w={K,s}if V and d:EnergyPredicted()<V then oE(w,V)return false end z=j.CastQueue(unpack(w))if z then return"\124 "..w[2]:Name()end return false end local function BE()if CE()and(D.ColdBlood:IsReady()and(not D.SecretTechnique:IsAvailable()and b>=6))then if q(D.ColdBlood,true)then return"\067\097\115\116 \067\111\108\100 \066\108\111\111\100"end end if TE()and(D.Sepsis:IsAvailable()and D.Sepsis:IsReady())then if qE()and(D.ShadowBlades:CooldownRemains()<=3 and D.SymbolsofDeath:CooldownRemains()<=3 or w.BossFilteredFightRemains("\060\061",12))then if q(D.Sepsis)then return"\067\097\115\116 \083\101\112\115\105\115"end end end if TE()and(D.Flagellation:IsAvailable()and D.Flagellation:IsReady())then if qE()and(nE()and(P>=5 and((R:TimeToDie()>10 or RE.Commons.Enabled.IgnoreTtdOnBoss and wE or G.Buggedmobs[R:NPCID()])and((D.ShadowBlades:CooldownRemains()<=2 or w.BossFilteredFightRemains("\060\061",24))and(not D.InvigoratingShadowdust:IsAvailable()or D.SymbolsofDeath:CooldownRemains()<=3 or d:BuffRemains(D.SymbolsofDeath)>3)))))then if q(D.Flagellation)then return"\067\097\115\116 \070\108\097\103\101\108\108\097\116\105\111\110"end end end if CE()and D.SymbolsofDeath:IsReady()then if not D.InvigoratingShadowdust:IsAvailable()and(qE()and(d:BuffUp(D.ShadowBlades)or D.ShadowBlades:CooldownRemains()>20 or not TE()))then if q(D.SymbolsofDeath,true)then return"\067\097\115\116 \083\121\109\098\111\108\115 \111\102 \068\101\097\116\104 \119\105\116\104\111\117\116 \068\117\115\116"end end end if CE()and D.SymbolsofDeath:IsReady()then if D.InvigoratingShadowdust:IsAvailable()and(qE()and(d:BuffRemains(D.SymbolsofDeath)<=3 and(d:BuffDown(D.TheRottenBuff)and(D.Flagellation:CooldownRemains()>10 or D.Flagellation:IsReady()and D.ShadowBlades:CooldownRemains()>=20 or not TE()or d:BuffRemains(D.ShadowDanceBuff)>=2))))then if q(D.SymbolsofDeath,true)then return"\067\097\115\116 \083\121\109\098\111\108\115 \111\102 \068\101\097\116\104 \119\105\116\104 \068\117\115\116"end end end if TE()and D.ShadowBlades:IsReady()then if qE()and(P<=1 and(d:BuffUp(D.Flagellation)or not D.Flagellation:IsAvailable()))or w.BossFilteredFightRemains("\060\061",20)then if q(D.ShadowBlades,true)then return"\067\097\115\116 \083\104\097\100\111\119 \066\108\097\100\101\115"end end end if CE()and(D.EchoingReprimand:IsCastable()and D.EchoingReprimand:IsAvailable())then if qE()and(W>=3 and(not D.TheRotten:IsAvailable()or not D.Reverberation:IsAvailable()or d:BuffUp(D.ShadowDance)))then if q(D.EchoingReprimand)then return"\067\097\115\116 \069\099\104\111\105\110\103 \082\101\112\114\105\109\097\110\100"end end end if CE()and(D.ShurikenTornado:IsAvailable()and D.ShurikenTornado:IsReady())then if qE()and(d:BuffUp(D.SymbolsofDeath)and(P<=2 and(not d:BuffUp(D.PremeditationBuff)and((not D.Flagellation:IsAvailable()or not TE()or D.Flagellation:CooldownRemains()>20)and X>=3))))then if q(D.ShurikenTornado)then return"\067\097\115\116 \083\104\117\114\105\107\101\110 \084\111\114\110\097\100\111 \049"end end end if CE()and(D.ShurikenTornado:IsAvailable()and D.ShurikenTornado:IsReady())then if qE()and(d:BuffDown(D.ShadowDanceBuff)and(d:BuffDown(D.Flagellation)and(d:BuffDown(D.FlagellationPersistBuff)and(d:BuffDown(D.ShadowBlades)and X<=2))))then if q(D.ShurikenTornado)then return"\067\097\115\116 \083\104\117\114\105\107\101\110 \084\111\114\110\097\100\111 \050"end end end if CE()and D.Vanish:IsReady()then if d:BuffUp(D.ShadowDanceBuff)and(D.InvigoratingShadowdust:IsAvailable()and(D.UnseenBlade:IsAvailable()and(W>1 and((D.Flagellation:CooldownRemains()>=60 or not TE()or not D.Flagellation:IsAvailable()or w.BossFilteredFightRemains("\060\061",30*D.Vanish:Charges()))and D.SecretTechnique:CooldownRemains()>=10))))then z=QE(D.Vanish,KE)if z then return"\086\097\110\105\115\104 \077\097\099\114\111"..z end end end if CE()and(d:BuffDown(D.ShadowDanceBuff)and(D.ShadowDance:IsReady()and(D.ShadowDance:IsCastable()and(D.InvigoratingShadowdust:IsAvailable()and d:BuffUp(D.ShadowBlades)))))then if D.DeathStalkersMark:IsAvailable()and d:BuffUp(D.SubterfugeBuff)or R:DebuffUp(D.Rupture)and(qE()and D.UnseenBlade:IsAvailable())then z=QE(D.ShadowDance,KE)if z then return"\083\104\097\100\111\119 \068\097\110\099\101 \077\097\099\114\111"..z end end end if CE()and(D.GoremawsBite:IsAvailable()and D.GoremawsBite:IsReady())then if qE()and(W>=3 and(not D.ShadowDance:IsReady()or D.DoubleDance:IsAvailable()and(d:BuffUp(D.ShadowDanceBuff)and not D.InvigoratingShadowdust:IsAvailable())or X<4 and not D.InvigoratingShadowdust:IsAvailable()or D.TheRotten:IsAvailable()))then if q(D.GoremawsBite)then return"\067\097\115\116 \071\111\114\101\109\097\119\'\115 \066\105\116\101"end end end if D.ThistleTea:IsReady()then if d:BuffDown(D.ThistleTea)and(d:BuffRemains(D.ShadowDanceBuff)>=6 or w.BossFilteredFightRemains("\060\061",6*D.ThistleTea:Charges()))then if q(D.ThistleTea,true)then return"\084\104\105\115\116\108\101 \084\101\097"end end end if RE.Commons.Enabled.Potions then local K=G.PotionSelected()if K and(K:IsReady()and((d:BloodlustUp()or w.BossFilteredFightRemains("\060",30)or d:BuffUp(D.SymbolsofDeath))and(d:BuffUp(D.ShadowBlades)or D.ShadowBlades:CooldownRemains()<=10)))then j.CastMacro(3,nil,nil,K)return"\067\097\115\116 \080\111\116\105\111\110"end end local K=RE.Commons.Enabled.Racials and(d:BuffUp(D.ShadowBlades)or not D.ShadowBlades:IsAvailable()and d:BuffUp(D.SymbolsofDeath)or w.BossFilteredFightRemains("\060",20))if D.BloodFury:IsCastable()and K then if j.Cast(D.BloodFury,true)then return"\067\097\115\116 \066\108\111\111\100 \070\117\114\121"end end if D.Berserking:IsCastable()and K then if j.Cast(D.Berserking,true)then return"\067\097\115\116 \066\101\114\115\101\114\107\105\110\103"end end if D.Fireblood:IsCastable()and K then if j.Cast(D.Fireblood,true)then return"\067\097\115\116 \070\105\114\101\098\108\111\111\100"end end if D.AncestralCall:IsCastable()and K then if j.Cast(D.AncestralCall,true)then return"\067\097\115\116 \065\110\099\101\115\116\114\097\108 \067\097\108\108"end end return false end local function ZE()if(RE.Commons.Enabled.Trinket1 or RE.Commons.Enabled.Trinket2)and TE()then if AE(x.TreacherousTransmitter)then if d:BuffUp(D.ShadowBlades)or w.BossFilteredFightRemains("\060\061",15)then if q(x.TreacherousTransmitter)then return"\084\114\101\097\099\104\101\114\111\117\115 \084\114\097\110\115\109\105\116\116\101\114"end end end if AE(x.ImperfectAscendancySerum)then if R:DebuffUp(D.Rupture)and d:BuffUp(D.Flagellation)then if q(x.ImperfectAscendancySerum)then return"\073\109\112\101\114\102\101\099\116 \065\115\099\101\110\100\097\110\099\121 \083\101\114\117\109"end end end local K local V=100 if pE then K=pE:OnUseSpell()V=(K and(K.MaximumRange>0 and K.MaximumRange<=100))and K.MaximumRange or 100 end if AE(pE)then if not u(H,pE:ID())and(rE()==1 and(d:BuffUp(D.ShadowBlades)or 1+D.ShadowBlades:CooldownRemains()>=pE:CooldownRemains()or w.BossFilteredFightRemains("\060\061",20))or rE()==2 and(not NE:IsReady()and(not d:BuffUp(D.ShadowBlades)and D.ShadowBlades:CooldownRemains()>20))or rE()==0)then if q(pE)then return"\071\101\110\101\114\105\099 \117\115\101\095\105\116\101\109\115 \102\111\114 "..pE:Name()end end end if NE then K=NE:OnUseSpell()V=(K and(K.MaximumRange>0 and K.MaximumRange<=100))and K.MaximumRange or 100 end if AE(NE)then if not u(H,NE:ID())and(rE()==2 and(d:BuffUp(D.ShadowBlades)or 1+D.ShadowBlades:CooldownRemains()>=NE:CooldownRemains()or w.BossFilteredFightRemains("\060\061",20))or rE()==1 and(not pE:IsReady()and(not d:BuffUp(D.ShadowBlades)and D.ShadowBlades:CooldownRemains()>20))or rE()==0)then if q(NE)then return"\071\101\110\101\114\105\099 \117\115\101\095\105\116\101\109\115 \102\111\114 "..NE:Name()end end end end return false end local function iE(K)if CE()and not(G.IsSoloMode()and d:IsTanking(R))then local V=not D.ColdBlood:IsAvailable()or D.ColdBlood:CooldownRemains()<4 or D.ColdBlood:CooldownRemains()>10 if yE()and D.Vanish:IsCastable()then if not D.InvigoratingShadowdust:IsAvailable()and(not D.Subterfuge:IsAvailable()and(W>=3 and(R:DebuffDown(D.Rupture)or d:BuffUp(D.ShadowBlades)and d:BuffUp(D.SymbolsofDeath)or D.Premeditation:IsAvailable()or w.BossFilteredFightRemains("\060",10))))then z=QE(D.Vanish,K)if z then return"\086\097\110\105\115\104 \077\097\099\114\111 \049 \078\111 \068\117\115\116"..z end end end if yE()and D.Vanish:IsCastable()then if d:BuffDown(D.ShadowDanceBuff)and(D.InvigoratingShadowdust:IsAvailable()and(D.DeathStalkersMark:IsAvailable()and((W>1 or d:BuffUp(D.ShadowBlades))and((D.Flagellation:CooldownRemains()>=60 or not D.Flagellation:IsAvailable()or not TE()or w.BossFilteredFightRemains("\060\061",30*D.Vanish:Charges()))and D.SecretTechnique:CooldownRemains()>=10))))then z=QE(D.Vanish,K)if z then return"\086\097\110\105\115\104 \077\097\099\114\111 \050 \068\117\115\116"..z end end end if D.ShadowDance:IsReady()and D.ShadowDance:IsCastable()then if R:DebuffUp(D.Rupture)and(qE()and((d:BuffRemains(D.SymbolsofDeath)>=6 and d:BuffDown(D.Flagellation)or d:BuffUp(D.SymbolsofDeath)and d:BuffUp(D.ShadowBlades)or d:BuffUp(D.ShadowBlades)and not D.InvigoratingShadowdust:IsAvailable())and(D.SecretTechnique:CooldownRemains()<10+12*r(D.InvigoratingShadowdust:IsAvailable())and(not D.TheFirstDance:IsAvailable()or W>=7 and d:BuffDown(D.ShadowBlades)or d:BuffUp(D.ShadowBlades)))))then z=QE(D.ShadowDance,K)if z then return"\083\104\097\100\111\119 \068\097\110\099\101 \077\097\099\114\111 \049 "..z end end end if yE()and D.Vanish:IsCastable()then if not D.InvigoratingShadowdust:IsAvailable()and(not D.Subterfuge:IsAvailable()and(W>=3 and(d:BuffUp(D.SymbolsofDeath)or D.SymbolsofDeath:CooldownRemains()>=3)))then z=QE(D.Vanish,K)if z then return"\086\097\110\105\115\104 \077\097\099\114\111 \051 \078\111 \068\117\115\116 \083\117\098\116\101\114\102\117\103\101 "..z end end end if RE.Commons.ShowPooling and(d:Energy()<40 and(D.Shadowmeld:IsCastable()and W>3))then if n(D.Shadowmeld,d:EnergyTimeToX(40))then return"\080\111\111\108 \102\111\114 \083\104\097\100\111\119\109\101\108\100"end end end return false end local function GE(K)local V=not K or d:EnergyPredicted()>=K if j.AoEON()and(D.ShurikenStorm:IsCastable()and(X>=(2+I(D.Gloomblade:IsAvailable()and d:BuffRemains(D.LingeringShadowBuff)>=6 or d:BuffUp(D.PerforatedVeinsBuff)))-I(R:BuffDown(D.FindWeaknessDebuff)and not D.ImprovedBackstab:IsAvailable())and(d:BuffUp(D.FlawlessFormBuff)or not D.UnseenBlade:IsAvailable())))then if V and q(D.ShurikenStorm)then return"\067\097\115\116 \083\104\117\114\105\107\101\110 \083\116\111\114\109"end oE(D.ShurikenStorm,K)end if j.AoEON()and D.ShurikenStorm:IsCastable()then if d:BuffUp(D.ClearTheWitnessesBuff)and((d:BuffDown(D.SymbolsofDeath)or not D.Inevitability:IsAvailable())and(d:BuffRemains(D.LingeringShadowBuff)<=6 or not D.LingeringShadow:IsAvailable()))then if V and q(D.ShurikenStorm)then return"\067\097\115\116 \083\104\117\114\105\107\101\110 \083\116\111\114\109 \068\101\097\116\104\115\116\097\108\107\101\114 \083\084"end oE(D.ShurikenStorm,K)end end if S then if D.Gloomblade:IsCastable()then if V and q(D.Gloomblade)then return"\067\097\115\116 \071\108\111\111\109\098\108\097\100\101"end oE(D.Gloomblade,K)elseif D.Backstab:IsCastable()then if V and q(D.Backstab)then return"\067\097\115\116 \066\097\099\107\115\116\097\098"end oE(D.Backstab,K)end end return false end local function mE()a=nil L=nil c=0 h=5 f=10 S=R:IsInMeleeRange(h)t=R:IsInMeleeRange(f)sE=w.BossFightRemains()wE=true if sE==11111 then wE=false sE=w.FightRemains(O,false)end if l()then O=d:GetEnemiesInRange(30)g=d:GetEnemiesInMeleeRange(f)X=#g e=d:GetEnemiesInMeleeRange(h)else O={}g={}X=1 e={}end b=d:ComboPoints()P=m.EffectiveComboPoints(b)W=d:ComboPointsDeficit()VE=jE()KE=d:EnergyMax()-YE()if d:BuffUp(D.ShurikenTornado,nil,true)and b<m.CPMaxSpend()then local K=m.TimeToNextTornado()if K<=d:GCDRemains()or Z(d:GCDRemains()-K)<.25 then local K=X+r(d:BuffUp(D.ShadowBlades))b=Q(b+K,m.CPMaxSpend())W=B(W-K,0)if P<m.CPMaxSpend()then P=b end end end E=(4+P*4)*.3 M=D.Eviscerate:Damage()*RE.Subtlety.EviscerateDMGOffset z=m.Defense()if z then return z end z=m.Poisons()if z then return z end if not d:AffectingCombat()then if not d:BuffUp(D.ShadowDanceBuff)and not d:BuffUp(m.VanishBuffSpell())then z=m.Stealth(m.StealthSpell())if z then return z end end if m.CombatCheck()and(R:IsSpellInRange(D.Shadowstrike)or S)then if d:StealthUp(true,true)then a=UE(true)if a then if D.ColdBlood:IsCastable()and D.ColdBlood:IsReady()then if j.Cast(D.ColdBlood)then return"\067\097\115\116 \067\111\108\100 \066\108\111\111\100 \040\079\079\067\041"end end if a:ID()==D.SecretTechnique:ID()then if j.CastMacro(10,nil,nil,D.SecretTechnique)then return"\067\097\115\116 \083\101\099\114\101\116 \084\101\099\104\110\105\113\117\101"end end if type(a)=="\116\097\098\108\101"and#a>1 then if k(nil,unpack(a))then return"\083\116\101\097\108\116\104\101\100 \077\097\099\114\111 \067\097\115\116 \111\114 \080\111\111\108 \040\079\079\067\041\058 "..a[1]:Name()end else if n(a)then return"\083\116\101\097\108\116\104\101\100 \067\097\115\116 \111\114 \080\111\111\108 \040\079\079\067\041\058 "..a:Name()end end end elseif b>=5 then z=JE()if z then return z.." \040\079\079\067\041"end elseif D.Backstab:IsCastable()then if q(D.Backstab)then return"\067\097\115\116 \066\097\099\107\115\116\097\098 \040\079\079\067\041"end end end return end if m.CombatCheck()then if j.ToggleIconFrame:GetToggle(3)then z=G.InterruptCycle(D.Kick,h,true,nil,false)if z then return z end z=G.IncorpCycle(D.Blind,15,true,nil,false)if z then return z end z=RE.Interrupt.UseBlind and G.InterruptCycle(D.Blind,15,true,nil,true)if z then return z end z=RE.Interrupt.UseKidneyShot and(b>0 and G.InterruptCycle(D.KidneyShot,h,true,nil,true))if z then return z end z=RE.Interrupt.UseCheapShop and(d:StealthUp(true,true)and G.InterruptCycle(D.CheapShot,h,true,nil,true))if z then return z end end z=RE.Commons.Enabled.Shiv and G.SootheCycle(D.Shiv,9,false,RE.Commons.Enabled["\083\104\105\118 \065\117\116\111 \084\097\114\103\101\116"])if z then return z end z=BE()if z then return"\067\068\115\058 "..z end z=ZE()if z then return"\073\116\101\109\115\058 "..z end if D.SliceandDice:IsCastable()and(b>=1 and not qE())then if D.SliceandDice:IsReady()and q(D.SliceandDice)then return"\067\097\115\116 \083\108\105\099\101 \097\110\100 \068\105\099\101"end end if d:StealthUp(true,true)then a=UE(true)if a then if a:ID()==D.SecretTechnique:ID()then if j.CastMacro(10,nil,nil,D.SecretTechnique)then return"\067\097\115\116 \083\101\099\114\101\116 \084\101\099\104\110\105\113\117\101"end end if type(a)=="\116\097\098\108\101"and#a>1 then if k(nil,unpack(a))then return"\083\116\101\097\108\116\104\101\100 \077\097\099\114\111 "..(a[1]:Name()..("\124"..a[2]:Name()))end else if d:BuffUp(D.ShurikenTornado)and(b~=d:ComboPoints()and(a==D.BlackPowder or a==D.Eviscerate or a==D.Rupture or a==D.SliceandDice))then if k(nil,D.ShurikenTornado,a)then return"\083\116\101\097\108\116\104\101\100 \084\111\114\110\097\100\111 \067\097\115\116  "..a:Name()end else if n(a)then return"\083\116\101\097\108\116\104\101\100 \067\097\115\116 "..a:Name()end end end end q(D.PoolEnergy)return"\083\116\101\097\108\116\104\101\100 \080\111\111\108\105\110\103"end z=iE(KE)if z then return"\083\116\101\097\108\116\104 \067\068\115\058 "..z end if d:BuffUp(D.DarkestNightBuff)and b==m.CPMaxSpend()then z=JE()if z then return"\070\105\110\105\115\104\058 \049 "..z end end if P>=m.CPMaxSpend()and d:BuffDown(D.DarkestNightBuff)then z=JE()if z then return"\070\105\110\105\115\104\058 \050 "..z end end if(W<=1+r(D.DeathStalkersMark:IsAvailable())or w.FilteredFightRemains(g,"\060\061",1)and P>=3)and d:BuffDown(D.DarkestNightBuff)then z=JE()if z then return"\070\105\110\105\115\104\058 \051 "..z end end if L then oE(L)end z=GE(KE)if z then return"\066\117\105\108\100\058 "..z end if CE()and RE.Commons.Enabled.Racials then if D.ArcaneTorrent:IsReady()and(S and d:EnergyDeficitPredicted()>15+d:EnergyRegen())then if j.Cast(D.ArcaneTorrent,true)then return"\067\097\115\116 \065\114\099\097\110\101 \084\111\114\114\101\110\116"end end if D.ArcanePulse:IsReady()and S then if j.Cast(D.ArcanePulse,true)then return"\067\097\115\116 \065\114\099\097\110\101 \080\117\108\115\101"end end if D.LightsJudgment:IsReady()then if j.Cast(D.LightsJudgment,true)then return"\067\097\115\116 \076\105\103\104\116\115 \074\117\100\103\109\101\110\116"end end if D.BagofTricks:IsReady()then if j.Cast(D.BagofTricks,true)then return"\067\097\115\116 \066\097\103 \111\102 \084\114\105\099\107\115"end end end if a and S then if type(a)=="\116\097\098\108\101"and#a>1 then if k(d:EnergyTimeToX(c),unpack(a))then return"\077\097\099\114\111 \112\111\111\108 \116\111\119\097\114\100\115 "..(a[1]:Name()..(" \097\116 "..c))end elseif a:IsCastable()then c=B(c,a:Cost())if n(a,d:EnergyTimeToX(c))then return"\080\111\111\108 \116\111\119\097\114\100\115\058 "..(a:Name()..(" \097\116 "..c))end end end if D.ShurikenToss:IsCastable()and(R:IsInRange(30)and(not t and(not d:StealthUp(true,true)and(not d:BuffUp(D.Sprint)and(d:EnergyDeficitPredicted()<20 and(W>=1 or d:EnergyTimeToMax()<=1.2))))))then if n(D.ShurikenToss)then return"\067\097\115\116 \083\104\117\114\105\107\101\110 \084\111\115\115"end end end end local function DE(K,V)return K:gsub("\123\040\046-\041\125",V)end local function xE(K)local V=d:GetEquipment()local s,w=V[13],V[14]if s and K:ID()==s then return 13 elseif w and K:ID()==w then return 14 end end local function HE()D.Rupture:RegisterAuraTracking()RE.Subtlety.Display()j.Print("\083\117\098\116\108\101\116\121 \082\111\103\117\101 \114\111\116\097\116\105\111\110 \104\097\115 \098\101\101\110 \117\112\100\097\116\101\100 \102\111\114 \112\097\116\099\104 \049\049\046\048\046\048\046")local K={bloodFuryValue=D.BloodFury:IsAvailable()and"\047\099\097\115\116 "..(D.BloodFury:Name().."\n")or D.Berserking:IsAvailable()and"\047\099\097\115\116 "..(D.Berserking:Name().."\n")or"";ColdBlood=D.ColdBlood:IsAvailable()and"\047\099\097\115\116 "..(D.ColdBlood:Name().."\n")or"",SecretTechnique=D.SecretTechnique:Name()}w.Timer.PulseOffset=.01 local V="\123\098\108\111\111\100\070\117\114\121\086\097\108\117\101\125\123\067\111\108\100\066\108\111\111\100\125\047\099\097\115\116 \123\083\101\099\114\101\116\084\101\099\104\110\105\113\117\101\125"j:UpdateMacro("\109\097\099\114\111\049",DE(V,K))end j.SetAPL(261,mE,HE)