local S,B=...local T=HeroLib local l,q=HeroCache,T.Utils local p=T.Unit local E,L,P=p.Player,p.Pet,p.Target local c,F=p.Focus,p.MouseOver local O,k,o=p.Arena,p.Boss,p.Nameplate local R,I=p.Party,p.Raid local Z=T.Spell local i=T.Item local t=HeroRotation()local x=(t.Commons()).Rogue local C=C_Timer local V=math.max local j=math.min local W=math.abs local G=pairs local U=table.insert local w=UnitAttackSpeed local z=GetTime do local S=z()function x.RtBRemains(B)local l=(S-z())-T.RecoveryOffset(B)return l>=0 and l or 0 end T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==315508 then S=z()+30 end end,"\083\080\069\076\076\095\065\085\082\065\095\065\080\080\076\073\069\068")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==315508 then S=z()+j(40,30+x.RtBRemains(true))end end,"\083\080\069\076\076\095\065\085\082\065\095\082\069\070\082\069\083\072")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==315508 then S=z()end end,"\083\080\069\076\076\095\065\085\082\065\095\082\069\077\079\086\069\068")end do local S={CrimsonTempest={};Garrote={};Rupture={}}function x.Exsanguinated(B,T)local l=B:GUID()if not l then return false end local q=T:ID()if q==121411 then return S.CrimsonTempest[l]or false elseif q==703 then return S.Garrote[l]or false elseif q==1943 then return S.Rupture[l]or false end return false end function x.WillLoseExsanguinate(S,B)if x.Exsanguinated(S,B)then return true end return false end function x.ExsanguinatedRate(S,B)if x.Exsanguinated(S,B)then return 2 end return 1 end T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==200806 then for S,B in G(S)do for S,T in G(B)do if S==P then B[S]=true end end end end end,"\083\080\069\076\076\095\067\065\083\084\095\083\085\067\067\069\083\083")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==121411 then S.CrimsonTempest[P]=false elseif k==703 then S.Garrote[P]=false elseif k==1943 then S.Rupture[P]=false end end,"\083\080\069\076\076\095\065\085\082\065\095\065\080\080\076\073\069\068","\083\080\069\076\076\095\065\085\082\065\095\082\069\070\082\069\083\072")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==121411 then if S.CrimsonTempest[P]~=nil then S.CrimsonTempest[P]=nil end elseif k==703 then if S.Garrote[P]~=nil then S.Garrote[P]=nil end elseif k==1943 then if S.Rupture[P]~=nil then S.Rupture[P]=nil end end end,"\083\080\069\076\076\095\065\085\082\065\095\082\069\077\079\086\069\068")T:RegisterForCombatEvent(function(B,T,l,q,p,E,L,P)if S.CrimsonTempest[P]~=nil then S.CrimsonTempest[P]=nil end if S.Garrote[P]~=nil then S.Garrote[P]=nil end if S.Rupture[P]~=nil then S.Rupture[P]=nil end end,"\085\078\073\084\095\068\073\069\068","\085\078\073\084\095\068\069\083\084\082\079\089\069\068")end do local S=Z(195627)local B=0 local l=z()function x.FanTheHammerCP()if z()-l<.5 and B>0 then if B>E:ComboPoints()then return B else B=0 end end return 0 end T:RegisterForSelfCombatEvent(function(T,q,p,L,P,c,F,O,k,o,R,I,Z,i,t,C)if I==185763 then if z()-l>.5 then B=j(x.CPMaxSpend(),(E:ComboPoints()+t)+V(0,t-1)*j(2,E:BuffStack(S)-1))l=z()end end end,"\083\080\069\076\076\095\069\078\069\082\071\073\090\069")end do local S,B=0,0 local l=Z(277925)function x.TimeToNextTornado()if not E:BuffUp(l,nil,true)then return 0 end local B=E:BuffRemains(l,nil,true)%1 if z()==S then return 0 elseif z()-S<.1 and B<.25 then return 1 elseif(B>.9 or B==0)and z()-S>.75 then return.1 end return B end T:RegisterForSelfCombatEvent(function(T,l,q,p,E,L,P,c,F,O,k,o)if o==212743 then S=z()elseif o==197835 then B=z()end if B==S then S=0 end end,"\083\080\069\076\076\095\067\065\083\084\095\083\085\067\067\069\083\083")end do local S={Counter=0;LastMH=0,LastOH=0}function x.TimeToSht(B)if S.Counter>=B then return 0 end local T,l=w("\112\108\097\121\101\114")local q=V(S.LastMH+T,z())local p=V(S.LastOH+l,z())local E={}for S=0,2,1 do U(E,q+S*T)U(E,p+S*l)end table.sort(E)local L=j(5,V(1,B-S.Counter))return E[L]-z()end T:RegisterForSelfCombatEvent(function()S.Counter=0 S.LastMH=z()S.LastOH=z()end,"\080\076\065\089\069\082\095\069\078\084\069\082\073\078\071\095\087\079\082\076\068")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k)if k==196911 then S.Counter=0 end end,"\083\080\069\076\076\095\069\078\069\082\071\073\090\069")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k,o,R,I,Z,i,t,x,C,V,j,W,G)S.Counter=S.Counter+1 if G then S.LastOH=z()else S.LastMH=z()end end,"\083\087\073\078\071\095\068\065\077\065\071\069")T:RegisterForSelfCombatEvent(function(B,T,l,q,p,E,L,P,c,F,O,k,o,R,I,Z)if Z then S.LastOH=z()else S.LastMH=z()end end,"\083\087\073\078\071\095\077\073\083\083\069\068")end do local S=E:CritChancePct()local B=0 local function l()if not E:AffectingCombat()then S=E:CritChancePct()T.Debug("\066\097\115\101 \067\114\105\116 \083\101\116 \116\111\058 "..S)end if B==nil or B<0 then B=0 else B=B-1 end if B>0 then C.After(3,l)end end T:RegisterForEvent(function()if B==0 then C.After(3,l)B=2 end end,"\080\076\065\089\069\082\095\069\081\085\073\080\077\069\078\084\095\067\072\065\078\071\069\068")function x.BaseAttackCrit()return S end end