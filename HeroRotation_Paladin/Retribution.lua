local k,U=...local Q=HeroDBC.DBC local u=HeroLib local T=HeroCache local z=u.Unit local A=z.Player local h=z.Target local Z=z.MouseOver local x=z.Pet local g=u.Spell local O=u.Item local E=HeroRotation()local s=E.AoEON local e=E.CDsON local G=E.Cast local M=(E.Commons()).Everyone.num local I=(E.Commons()).Everyone.bool local q=math.min local l=C_Timer.After local n=g.Paladin.Retribution local R=O.Paladin.Retribution local K={R.AlgetharPuzzleBox:ID();R.ShadowedRazingAnnihilator:ID()}local P=(E.Commons()).Everyone local C=(E.Commons()).Paladin local a=E.GUISettingsGet()local d={General=a.General;Commons=a.APL.Paladin.Commons,Retribution=a.APL.Paladin.Retribution;RetCooldowns=a.APL.Paladin.RetCooldowns,RetTTD=a.APL.Paladin.RetTTD,RetHealing=a.APL.Paladin.RetHealing}local J=11111 local B=11111 local r local F=0 local i=0 local V local o=n.FinalVerdict:IsLearned()and n.FinalVerdict or n.TemplarsVerdict local S local v local D,H local w local m,c local Y=n.EternalFlame:IsAvailable()and n.EternalFlame or n.WordofGlory local f,p local j,L local y,b local X,N local W,t local kM,UM local QM,uM local TM,zM local AM,hM local ZM,xM local gM local OM=0 local function EM()local k,U=A:GetTrinketData(K)if OM<5 and(k.ID==0 or U.ID==0 or k.Level==0 or U.Level==0 or k.SpellID>0 and not k.Usable or U.SpellID>0 and not U.Usable)then OM=OM+1 l(5,function()EM()end)return end f=k.Object p=U.Object j=k.ID L=U.ID y=k.Level b=U.Level X=k.Spell W=k.Range kM=k.CastTime N=U.Spell t=U.Range UM=U.CastTime QM=k.Cooldown uM=U.Cooldown TM=k.Blacklisted zM=U.Blacklisted AM=f:HasUseBuff()hM=p:HasUseBuff()ZM=.5 local Q=QM>0 and QM or 1 if AM and(QM%120==0 or 120%Q==0)then ZM=1 end xM=.5 local u=uM>0 and uM or 1 if hM and(uM%120==0 or 120%u==0)then xM=1 end gM=1 local T=f:BuffDuration()>0 and f:BuffDuration()or 1 local z=p:BuffDuration()>0 and p:BuffDuration()or 1 if not AM and hM or hM and(uM/z)*xM>(QM/T)*ZM then gM=2 end end EM()local function sM()local k=5-n.TemplarStrike:TimeSinceLastCast()if n.TemplarSlash:TimeSinceLastCast()<n.TemplarStrike:TimeSinceLastCast()then k=0 end return k>0 and k or 0 end u:RegisterForEvent(function()Equip=A:GetEquipment()f=Equip[13]and O(Equip[13])or O(0)p=Equip[14]and O(Equip[14])or O(0)end,"\080\076\065\089\069\082\095\069\081\085\073\080\077\069\078\084\095\067\072\065\078\071\069\068")u:RegisterForEvent(function()J=11111 B=11111 end,"\080\076\065\089\069\082\095\082\069\071\069\078\095\069\078\065\066\076\069\068")u:RegisterForEvent(function()o=n.FinalVerdict:IsLearned()and n.FinalVerdict or n.TemplarsVerdict end,"\083\080\069\076\076\083\095\067\072\065\078\071\069\068","\076\069\065\082\078\069\068\095\083\080\069\076\076\095\073\078\095\084\065\066")local function eM()return R.ManicGrieftorch:IsEquipped()and(R.ManicGrieftorch:CooldownUp()or R.ManicGrieftorch:CooldownRemains()<=A:GCDRemains())end local function GM()return R.AlgetharPuzzleBox:IsEquipped()and(R.AlgetharPuzzleBox:CooldownUp()or R.AlgetharPuzzleBox:CooldownRemains()<=A:GCDRemains())end local function MM()local k=A:GCDRemains()local U=q(n.CrusaderStrike:CooldownRemains(),n.BladeofJustice:CooldownRemains(),n.Judgment:CooldownRemains(),n.HammerofWrath:IsUsable()and n.HammerofWrath:CooldownRemains()or 10,n.WakeofAshes:CooldownRemains())if k>U then return k end return U end local function IM()for k,U in pairs(z.Party)do if U:Role()=="\072\069\065\076\069\082"then H=U end if U:Role()=="\084\065\078\075"then D=U end end end local function qM(k)local U=UnitGUID("\116\097\114\103\101\116\116\097\114\103\101\116")if k~=nil then for k,Q in pairs(k)do if Q:GUID()==U and(h:CastSpellID()==320788 or h:CastSpellID()==323730)then if Q~=nil then return Q end end end end end u:RegisterForEvent(function()IM()end,"\080\076\065\089\069\082\095\069\078\084\069\082\073\078\071\095\087\079\082\076\068","\071\082\079\085\080\095\082\079\083\084\069\082\095\085\080\068\065\084\069","\065\068\068\079\078\095\076\079\065\068\069\068")local function lM(k)local U=0 for Q,u in pairs(z.Party)do if P.unitHasDebuffFromList(P.DebuffList[k],u)then U=U+1 end end return U end local function nM(k,U)local Q=P.DebuffList[U]local u=0 for U,T in pairs(z.Party)do if T~="\112\108\097\121\101\114"and P.unitHasDebuffFromList(Q,T)then u=u+1 T:Cast(k)return"\100\105\115\112\101\108"end if u==0 and P.unitHasDebuffFromList(Q,A)then(z(d.RetHealing.UnboundFreedomUnit)):Cast(k)return"\111\110 \115\101\108\101\099\116\101\100 \117\110\105\116"end end end local RM={225963;200182;196354,225484;196376,260741,426660,412505,255814,255434;264150;411700;411958,264556,201733,267907;260551,257407,426659}local function KM(k,U)local Q=nil if U==nil then for k,U in pairs(k)do if U:Role()~="\084\065\078\075"and((d.RetHealing.BoPDebuff and(P.unitHasDebuffFromList(P.DebuffList.Bleed,U)or P.unitHasDebuffFromList(RM,U))or U:HealthPercentageWeighted()<=d.RetHealing.BoPHP)and U:DebuffDown(n.ForbearanceDebuff))then Q=U end end end if U==true then if(d.RetHealing.BoPDebuff and(P.unitHasDebuffFromList(P.DebuffList.Bleed,A)or P.unitHasDebuffFromList(RM,A))or A:HealthPercentageWeighted()<=d.RetHealing.BoPHP)and A:DebuffDown(n.ForbearanceDebuff)then Q=A end end return Q end function PreventWithFreedomIfTargetOfTargetIsPlayer(k)local U=UnitGUID("\112\108\097\121\101\114")local Q="\116\097\114\103\101\116"if UnitExists(Q)then local u="\116\097\114\103\101\116\116\097\114\103\101\116"if UnitExists(u)and UnitGUID(u)==U then if h:CastSpellID()==k and UnitIsPlayer(Q)then return true end end end return false end local function PM()if a.General.AutoTab and A:AffectingCombat()then E.TopPanelAlternative:ChangeIcon(1,3)return"\065\117\116\111 \116\097\098 \116\111 \116\097\114\103\101\116"end end function EnemiesWithIDInCCRange(k)local U=A:GetEnemiesInRange(10)local Q=0 for U,u in pairs(U)do if u:NPCID()==k then Q=Q+1 end end return Q end local function CM(k)return k~="\078\111\116 \085\115\101\100"and(k=="\087\105\116\104 \067\111\111\108\100\111\119\110\115"and E.CDsON()or k=="\087\105\116\104 \083\109\097\108\108 \111\114 \067\111\111\108\100\111\119\110\115"and(SmallCDToggle or E.CDsON())or k=="\087\105\116\104 \083\109\097\108\108 \067\068\115"and SmallCDToggle or k=="\079\110 \077\111\098\099\111\117\110\116"and c>=d.RetCooldowns.Mobcount or k=="\079\110 \077\111\098\099\111\117\110\116 \111\114 \067\111\111\108\100\111\119\110\115"and(c>=d.RetCooldowns.Mobcount or e())or k=="\065\108\119\097\121\115"or k=="\079\110 \066\111\115\115\101\115"and(S or h:IsDummy())or k=="\077\111\098\099\111\117\110\116 \111\114 \066\111\115\115"and(S or h:IsDummy()or c>=d.RetCooldowns.Mobcount))end local function aM(k)local U=d.RetHealing.IntercessionUnit if U=="\065\108\108"then for k,U in pairs(k)do if U:IsDeadOrGhost()then return U end end return nil end local Q={None={};Tank={"\084\065\078\075"},Healer={"\072\069\065\076\069\082"},["\084\097\110\107 \097\110\100 \072\101\097\108\101\114"]={"\084\065\078\075";"\072\069\065\076\069\082"};DD={"\068\065\077\065\071\069\082"}}local u=Q[U]or{}for k,U in pairs(k)do local Q=U:Role()local T=U:IsDeadOrGhost()for k,u in ipairs(u)do if Q==u and T then return U end end end return nil end local function dM(k,U,Q)if S or P.ISSolo()or Q==0 or B>=Q and B<7777 then E.Cast(k,U)return"\084\084\068 \099\097\115\116 "..k:Name()end end local function JM(k)return S or P.ISSolo()or k==0 or P.Buggedmobs[h:NPCID()]or B>=k and B<7777 end local function BM()if o:IsReady()and(F>=4 and h:IsSpellInRange(o))then if G(o,nil,nil,not h:IsSpellInRange(o))then return"\101\105\116\104\101\114 \118\101\114\100\105\099\116 \112\114\101\099\111\109\098\097\116 \050"end end if n.BladeofJustice:IsCastable()and h:IsSpellInRange(n.BladeofJustice)then if G(n.BladeofJustice)then return"\098\108\097\100\101\095\111\102\095\106\117\115\116\105\099\101 \112\114\101\099\111\109\098\097\116 \052"end end if n.Judgment:IsCastable()and h:IsSpellInRange(n.Judgment)then if G(n.Judgment,nil,nil,not h:IsSpellInRange(n.Judgment))then return"\106\117\100\103\109\101\110\116 \112\114\101\099\111\109\098\097\116 \054"end end if n.HammerofWrath:IsReady()and h:IsSpellInRange(n.HammerofWrath)then if G(n.HammerofWrath,false,nil,not h:IsSpellInRange(n.HammerofWrath))then return"\104\097\109\109\101\114\095\111\102\095\119\114\097\116\104 \112\114\101\099\111\109\098\097\116 \056"end end if n.CrusaderStrike:IsCastable()and h:IsSpellInRange(n.CrusaderStrike)then if G(n.CrusaderStrike)then return"\099\114\117\115\097\100\101\114\095\115\116\114\105\107\101 \049\048"end end end local function rM()if d.Commons.Enabled.Potions and(PotionSetting and(AvengingWrathSetting and A:BuffUp(n.AvengingWrathBuff)or CrusadeSetting and A:BuffUp(n.CrusadeBuff)or ExecutionSentenceSetting and h:DebuffUp(n.ExecutionSentenceDebuff)or J<30))then local k=P.PotionSelected()if k and k:IsReady()then E.CastMacro(3,nil,nil,k)return"\067\097\115\116 \080\111\116\105\111\110"end end if RacialsSetting and n.LightsJudgment:IsCastable()then if G(n.LightsJudgment,false,nil,not h:IsInRange(40))then return"\108\105\103\104\116\115\095\106\117\100\103\109\101\110\116 \099\111\111\108\100\111\119\110\115 \052"end end if RacialsSetting and(n.Fireblood:IsCastable()and(A:BuffUp(n.AvengingWrathBuff)or A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)==10))then if G(n.Fireblood,false)then return"\102\105\114\101\098\108\111\111\100 \099\111\111\108\100\111\119\110\115 \054"end end if(Trinket1Setting and f:ID()==R.AlgetharPuzzleBox:ID()or Trinket2Setting and p:ID()==R.AlgetharPuzzleBox:ID())and(JM(d.RetTTD.TrinketsTTD)and(d.Commons.Enabled.Trinkets and(GM()and(((not n.Crusade:IsAvailable()and(n.AvengingWrath:CooldownRemains()<5 and not n.Crusade:IsAvailable())or n.Crusade:CooldownRemains()<5 and n.Crusade:IsAvailable())and(F>=4 and u.CombatTime()<5 or F>=3 and u.CombatTime()>5))and h:IsInRange(5)))))then if G(R.AlgetharPuzzleBox,nil)then return"\097\108\103\101\116\104\097\114\095\112\117\122\122\108\101\095\098\111\120 \099\111\111\108\100\111\119\110\115 \056"end end if(Trinket1Setting and f:ID()==R.ElementiumPocketAnvil:ID()or Trinket2Setting and p:ID()==R.ElementiumPocketAnvil:ID())and(d.Commons.Enabled.Trinkets and(R.ElementiumPocketAnvil:IsEquippedAndReady()and h:IsInRange(5)))then if G(R.ElementiumPocketAnvil,nil)then return"\069\108\101\109\101\110\116\105\117\109 \080\111\099\107\101\116 \065\110\118\105\108 \099\111\111\108\100\111\119\110\115 \056"end end if(Trinket1Setting and f:ID()==R.BranchOfTheTormentedAncient:ID()or Trinket2Setting and p:ID()==R.BranchOfTheTormentedAncient:ID())and(JM(d.RetTTD.TrinketsTTD)and(d.Commons.Enabled.Trinkets and(R.BranchOfTheTormentedAncient:IsEquippedAndReady()and h:IsInRange(5))))then if G(R.BranchOfTheTormentedAncient)then return"\066\114\097\110\099\104\079\102\084\104\101\084\111\114\109\101\110\116\101\100\065\110\099\105\101\110\116 \099\111\111\108\100\111\119\110\115 \056"end end if(Trinket1Setting and f:ID()==R.ManicGrieftorch:ID()or Trinket2Setting and p:ID()==R.ManicGrieftorch:ID())and(d.Commons.Enabled.Trinkets and(eM()and(not A:BuffUp(n.AvengingWrathBuff)and(h:IsInRange(40)and(h:TimeToDie()>2 or h:IsBoss())))))then if G(R.ManicGrieftorch)then return"\077\097\110\105\099 \071\114\105\101\118\101\116\111\114\099\104 \099\111\111\108\100\111\119\110\115 \056"end end if d.Commons.Enabled.Trinkets then if f:IsReady()and(Trinket1Setting and(not TM and(((n.Crusade:IsLearned()and not CrusadeSetting or n.AvengingWrath:IsLearned()and not AvengingWrathSetting or A:BuffUp(n.AvengingWrathBuff)and n.AvengingWrath:CooldownRemains()>40 or A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)==10)and not n.RadiantGlory:IsAvailable()or n.RadiantGlory:IsAvailable()and(not n.ExecutionSentence:IsAvailable()and n.WakeofAshes:CooldownUp()or h:DebuffUp(n.ExecutionSentenceDebuff)))and(not p:HasCooldown()or p:CooldownDown()or gM==1)or f:BuffDuration()>=B)))then if G(f)then return"\117\115\101\095\105\116\101\109 \102\111\114 \116\114\105\110\107\101\116\049 \040"..(f:Name().."\041 \099\111\111\108\100\111\119\110\115 \056")end end if p:IsReady()and(Trinket2Setting and(not zM and(((n.Crusade:IsLearned()and not CrusadeSetting or n.AvengingWrath:IsLearned()and not AvengingWrathSetting or A:BuffUp(n.AvengingWrathBuff)and n.AvengingWrath:CooldownRemains()>40 or A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)==1)and not n.RadiantGlory:IsAvailable()or n.RadiantGlory:IsAvailable()and(not n.ExecutionSentence:IsAvailable()and n.WakeofAshes:CooldownUp()or h:DebuffUp(n.ExecutionSentenceDebuff)))and(not f:HasCooldown()or f:CooldownDown()or gM==2)or p:BuffDuration()>=B)))then if G(p)then return"\117\115\101\095\105\116\101\109 \102\111\114 \116\114\105\110\107\101\116\050 \040"..(p:Name().."\041 \099\111\111\108\100\111\119\110\115 \056")end end if f:IsReady()and(Trinket1Setting and(not TM and(not AM and(p:CooldownDown()or not hM or n.Crusade:IsLearned()and not CrusadeSetting or n.AvengingWrath:IsLearned()and not AvengingWrathSetting or A:BuffDown(n.CrusadeBuff)and n.Crusade:CooldownRemains()>20 or A:BuffDown(n.AvengingWrathBuff)and n.AvengingWrath:CooldownRemains()>20))))then if G(f)then return"\117\115\101\095\105\116\101\109 \102\111\114 \116\114\105\110\107\101\116\049 \040"..(f:Name().."\041 \099\111\111\108\100\111\119\110\115 \049\048")end end if p:IsReady()and(Trinket2Setting and(not zM and(not hM and(f:CooldownDown()or not AM or n.Crusade:IsLearned()and not CrusadeSetting or n.AvengingWrath:IsLearned()and not AvengingWrathSetting or A:BuffDown(n.CrusadeBuff)and n.Crusade:CooldownRemains()>20 or A:BuffDown(n.AvengingWrathBuff)and n.AvengingWrath:CooldownRemains()>20))))then if G(p)then return"\117\115\101\095\105\116\101\109 \102\111\114 \116\114\105\110\107\101\116\050 \040"..(p:Name().."\041 \099\111\111\108\100\111\119\110\115 \049\050")end end if(f:ID()==R.ConcoctionKissofDeath:ID()and Trinket1Setting or p:ID()==R.ConcoctionKissofDeath:ID()and Trinket2Setting)and(R.ConcoctionKissofDeath:IsEquippedAndReady()and(A:BuffUp(n.AvengingWrathBuff)or A:BuffStack(n.CrusadeBuff)==10))then if G(R.ConcoctionKissofDeath,true)then return"\067\111\110\099\111\099\116\105\111\110\075\105\115\115\111\102\068\101\097\116\104"end end end if d.Commons.Enabled.Items then if R.ShadowedRazingAnnihilator:IsEquippedAndReady()and(WeaponSetting and(h:IsInRange(5)and((f:CooldownDown()or not f:HasUseBuff())and(p:CooldownDown()or not p:HasUseBuff()))))then E.CastMacro(1,nil,nil,R.ShadowedRazingAnnihilator)return"\115\104\097\100\111\119\101\100\095\114\097\122\105\110\103\095\097\110\110\105\104\105\108\097\116\111\114 \099\111\111\108\100\111\119\110\115 \049\048"end if R.Fyralath:IsEquippedAndReady()and(e()and(WeaponSetting and(h:IsInRange(5)and(n.MarkofFyralathDebuff:AuraActiveCount()>0 and(A:BuffDown(n.AvengingWrathBuff)and A:BuffDown(n.CrusadeBuff))))))then E.CastMacro(1,nil,nil,R.Fyralath)return"\070\121\114\097\108\097\116\104 \099\097\115\116"end end if n.ExecutionSentence:IsCastable()and(h:IsInRange(30)and(ExecutionSentenceSetting and(h:TimeToDie()>8 and((A:BuffDown(n.CrusadeBuff)and n.Crusade:CooldownRemains()>15 or A:BuffStack(n.CrusadeBuff)==10 or not n.Crusade:IsAvailable()and n.AvengingWrath:CooldownRemains()<.75 or n.AvengingWrath:CooldownRemains()>15 or n.RadiantGlory:IsAvailable()or n.Crusade:IsLearned()and not CrusadeSetting or n.AvengingWrath:IsLearned()and not AvengingWrathSetting)and((F>=4 and u.CombatTime()<5 or F>=3 and u.CombatTime()>5 or F>=2 and(n.DivineAuxiliary:IsAvailable()or n.RadiantGlory:IsAvailable()))and((h:TimeToDie()>8 and not n.ExecutionersWill:IsAvailable()or h:TimeToDie()>12)and n.WakeofAshes:CooldownRemains()<A:GCD()))))))then if G(n.ExecutionSentence)then return"\101\120\101\099\117\116\105\111\110\095\115\101\110\116\101\110\099\101 \099\111\111\108\100\111\119\110\115 \049\052"end end if n.AvengingWrath:IsCastable()and(h:IsInRange(5)and(AvengingWrathSetting and((F>=4 and u.CombatTime()<5 or F>=3 and u.CombatTime()>5 or F>=2 and(n.DivineAuxiliary:IsAvailable()and(n.ExecutionSentence:CooldownUp()or n.FinalReckoning:CooldownUp())))and(c<=1 or h:TimeToDie()>10))))then if G(n.AvengingWrath,false)then return"\097\118\101\110\103\105\110\103\095\119\114\097\116\104 \099\111\111\108\100\111\119\110\115 \049\054"end end if n.Crusade:IsCastable()and(h:IsInRange(5)and(CrusadeSetting and(F>=5 and u.CombatTime()<5 or F>=3 and u.CombatTime()>=5)))then if G(n.Crusade,false)then return"\099\114\117\115\097\100\101 \099\111\111\108\100\111\119\110\115 \049\056"end end if n.FinalReckoning:IsCastable()and(h:IsInMeleeRange(5)and(FinalReckoningSetting and((F>=4 and u.CombatTime()<8 or F>=3 and u.CombatTime()>=8 or F>=2 and(n.DivineAuxiliary:IsAvailable()or n.RadiantGlory:IsAvailable()))and(not AvengingWrathSetting or n.AvengingWrath:CooldownRemains()>10 or n.Crusade:CooldownDown()and(A:BuffDown(n.CrusadeBuff)or A:BuffStack(n.CrusadeBuff)>=10)or n.RadiantGlory:IsAvailable()and(A:BuffUp(n.AvengingWrathBuff)or n.Crusade:IsAvailable()and n.WakeofAshes:CooldownRemains()<A:GCD())))))then if E.CastTarget(n.FinalReckoning,(E.TName()).PLAYER)then return"\102\105\110\097\108\095\114\101\099\107\111\110\105\110\103 \099\111\111\108\100\111\119\110\115 \050\048"end end end local function FM()V=(c>=2 or A:BuffUp(n.EmpyreanPowerBuff)or not n.FinalVerdict:IsLearned()and n.TempestoftheLightbringer:IsAvailable())and(A:BuffDown(n.EmpyreanLegacyBuff)and not(A:BuffUp(n.DivineArbiterBuff)and A:BuffStack(n.DivineArbiterBuff)>24))if n.HammerofLight:IsReady()and h:IsInRange(14)then if G(n.WakeofAshes,true)then return"\072\097\109\109\101\114\111\102\076\105\103\104\116 \102\105\110\105\115\104\101\114\115 \050"end end if n.DivineHammer:IsCastable()and(F==5 and h:IsInRange(8))then if G(n.DivineHammer)then return"\100\105\118\105\110\101\095\104\097\109\109\101\114 \102\105\110\105\115\104\101\114\115 \052"end end if n.DivineStorm:IsReady()and(h:IsInRange(8)and(V and(not n.HammerofLight:IsReady()and((not n.Crusade:IsAvailable()or not CrusadeSetting or n.Crusade:CooldownRemains()>i*3 or A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)<10 or n.RadiantGlory:IsAvailable())and(not A:BuffUp(n.DivineHammerBuff)or n.DivineHammer:CooldownRemains()>110 and F>=4)))))then if G(n.DivineStorm)then return"\100\105\118\105\110\101\095\115\116\111\114\109 \102\105\110\105\115\104\101\114\115 \054"end end if n.JusticarsVengeance:IsReady()and(h:IsInRange(8)and((not n.Crusade:IsAvailable()or not AvengingWrathSetting and not CrusadeSetting or n.Crusade:CooldownRemains()>i*3 or A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)<10 or n.RadiantGlory:IsAvailable())and(not n.HammerofLight:IsReady()and(not A:BuffUp(n.DivineHammerBuff)or n.DivineHammer:CooldownRemains()>110 and F>=4))))then if G(n.JusticarsVengeance)then return"\106\117\115\116\105\099\097\114\115\095\118\101\110\103\101\097\110\099\101 \102\105\110\105\115\104\101\114\115 \056"end end if o:IsReady()and(h:IsSpellInRange(o)and((not n.Crusade:IsAvailable()or not AvengingWrathSetting and not CrusadeSetting or n.Crusade:CooldownRemains()>i*3 or A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)<10 or n.RadiantGlory:IsAvailable())and(not n.HammerofLight:IsReady()and(not A:BuffUp(n.DivineHammerBuff)or n.DivineHammer:CooldownRemains()>110 and F>=4))))then if G(o)then return"\101\105\116\104\101\114 \118\101\114\100\105\099\116 \102\105\110\105\115\104\101\114\115 \054"end end end local function iM()if F>=5 or F>=4 and A:BuffUp(n.DivineResonanceBuff)then v=FM()if v then return v end end if n.TemplarSlash:IsReady()and(h:IsInMeleeRange(5)and n.TemplarStrike:TimeSinceLastCast()>5-A:GCD()*2)then if G(n.TemplarSlash)then return"\116\101\109\112\108\097\114\095\115\108\097\115\104 \103\101\110\101\114\097\116\111\114\115 \050"end end if n.BladeofJustice:IsCastable()and(h:IsSpellInRange(n.BladeofJustice)and(h:DebuffDown(n.ExpurgationDebuff)and n.HolyFlames:IsAvailable()))then if G(n.BladeofJustice)then return"\098\108\097\100\101\095\111\102\095\106\117\115\116\105\099\101 \103\101\110\101\114\097\116\111\114\115 \052"end end if n.WakeofAshes:IsCastable()and(WakeofAshesSetting and(h:IsInRange(14)and((not n.LightsGuidance:IsAvailable()or F>=2 and n.LightsGuidance:IsAvailable())and((n.AvengingWrath:CooldownRemains()>6 or not AvengingWrathSetting or n.Crusade:IsAvailable()and(n.Crusade:CooldownRemains()>6 or not CrusadeSetting)or n.RadiantGlory:IsAvailable())and(n.FinalReckoning:CooldownRemains()>4 or n.FinalReckoning:IsLearned()and not FinalReckoningSetting or n.ExecutionSentence:CooldownRemains()>4 or n.ExecutionSentence:IsLearned()and not ExecutionSentenceSetting or J<8)))))then if G(n.WakeofAshes)then return"\119\097\107\101\095\111\102\095\097\115\104\101\115 \103\101\110\101\114\097\116\111\114\115 \050"end end if n.DivineToll:IsCastable()and(DivineTollSetting and(h:IsInRange(30)and(F<=2 and(n.AvengingWrath:IsAvailable()and n.AvengingWrath:CooldownRemains()>15 or not AvengingWrathSetting)or n.Crusade:IsAvailable()and n.Crusade:CooldownRemains()>15 or not CrusadeSetting or n.RadiantGlory:IsAvailable()or J<8)))then if G(n.DivineToll)then return"\100\105\118\105\110\101\095\116\111\108\108 \103\101\110\101\114\097\116\111\114\115 \054"end end if not n.HammerofLight:IsReady()and(F>=3 and(A:BuffUp(n.CrusadeBuff)and A:BuffStack(n.CrusadeBuff)<10))then v=FM()if v then return v end end if n.TemplarSlash:IsReady()and(h:IsInMeleeRange(5)and(n.TemplarStrike:TimeSinceLastCast()>5-A:GCD()and c>=2))then if G(n.TemplarSlash)then return"\116\101\109\112\108\097\114\095\115\108\097\115\104 \103\101\110\101\114\097\116\111\114\115 \056"end end if n.BladeofJustice:IsCastable()and(h:IsSpellInRange(n.BladeofJustice)and((F<=3 or not n.HolyBlade:IsAvailable())and(c>=2 and n.BladeofVengeance:IsAvailable())))then if G(n.BladeofJustice)then return"\098\108\097\100\101\095\111\102\095\106\117\115\116\105\099\101 \103\101\110\101\114\097\116\111\114\115 \049\048"end end if n.HammerofWrath:IsReady()and(h:IsSpellInRange(n.HammerofWrath)and((c<2 or not n.BlessedChampion:IsAvailable())and((F<=3 or h:HealthPercentage()>20 or not n.VanguardsMomentum:IsAvailable())and(h:HealthPercentage()<35 and n.VengefulWrath:IsAvailable()or A:BuffUp(n.BlessingofAnsheBuff)))))then if G(n.HammerofWrath)then return"\104\097\109\109\101\114\095\111\102\095\119\114\097\116\104 \103\101\110\101\114\097\116\111\114\115 \049\050"end end if n.TemplarStrike:IsReady()and h:IsSpellInRange(n.TemplarStrike)then if G(n.TemplarStrike)then return"\116\101\109\112\108\097\114\095\115\116\114\105\107\101 \103\101\110\101\114\097\116\111\114\115 \049\052"end end if n.Judgment:IsReady()and(h:IsSpellInRange(n.Judgment)and(F<=3 or not n.BoundlessJudgment:IsAvailable()))then if G(n.Judgment,nil,nil,not h:IsSpellInRange(n.Judgment))then return"\106\117\100\103\109\101\110\116 \103\101\110\101\114\097\116\111\114\115 \049\056"end end if n.BladeofJustice:IsCastable()and(h:IsSpellInRange(n.BladeofJustice)and(F<=3 or not n.HolyBlade:IsAvailable()))then if G(n.BladeofJustice)then return"\098\108\097\100\101\095\111\102\095\106\117\115\116\105\099\101 \103\101\110\101\114\097\116\111\114\115 \049\054"end end if n.HammerofWrath:IsReady()and(h:IsSpellInRange(n.HammerofWrath)and((c<2 or not n.BlessedChampion:IsAvailable())and(F<=3 or h:HealthPercentage()>20 or not n.VanguardsMomentum:IsAvailable())))then if G(n.HammerofWrath,false,nil,not h:IsSpellInRange(n.HammerofWrath))then return"\104\097\109\109\101\114\095\111\102\095\119\114\097\116\104 \103\101\110\101\114\097\116\111\114\115 \049\056"end end if n.TemplarSlash:IsReady()and h:IsInMeleeRange(5)then if G(n.TemplarSlash)then return"\116\101\109\112\108\097\114\095\115\108\097\115\104 \103\101\110\101\114\097\116\111\114\115 \050\048"end end if not n.HammerofLight:IsReady()and(h:HealthPercentage()<=20 or A:BuffUp(n.AvengingWrathBuff)or A:BuffUp(n.CrusadeBuff)or A:BuffUp(n.EmpyreanPowerBuff))then v=FM()if v then return v end end if n.CrusaderStrike:IsCastable()and(h:IsSpellInRange(n.CrusaderStrike)and(n.CrusaderStrike:ChargesFractional()>=1.75 and(F<=2 or F<=3 and n.BladeofJustice:CooldownRemains()>i*2 or F==4 and(n.BladeofJustice:CooldownRemains()>i*2 and n.Judgment:CooldownRemains()>i*2))))then if G(n.CrusaderStrike)then return"\099\114\117\115\097\100\101\114\095\115\116\114\105\107\101 \103\101\110\101\114\097\116\111\114\115 \050\050"end end if not n.HammerofLight:IsReady()then v=FM()if v then return v end end if n.HammerofWrath:IsReady()and(h:IsSpellInRange(n.HammerofWrath)and(F<=3 or h:HealthPercentage()>20 or not n.VanguardsMomentum:IsAvailable()))then if G(n.HammerofWrath,false,nil,not h:IsSpellInRange(n.HammerofWrath))then return"\104\097\109\109\101\114\095\111\102\095\119\114\097\116\104 \103\101\110\101\114\097\116\111\114\115 \050\052"end end if n.CrusaderStrike:IsCastable()and h:IsSpellInRange(n.CrusaderStrike)then if G(n.CrusaderStrike)then return"\099\114\117\115\097\100\101\114\095\115\116\114\105\107\101 \103\101\110\101\114\097\116\111\114\115 \050\054"end end if n.ArcaneTorrent:IsCastable()and h:IsInRange(8)then if G(n.ArcaneTorrent)then return"\097\114\099\097\110\101\095\116\111\114\114\101\110\116 \103\101\110\101\114\097\116\111\114\115 \050\056"end end end local function VM()if A:HealthPercentage()<=d.RetHealing.LoHHP and(n.LayonHands:IsCastable()and not A:DebuffUp(n.ForbearanceDebuff))then if G(n.LayonHands,true)then return"\108\097\121\095\111\110\095\104\097\110\100\115 \100\101\102\101\110\115\105\118\101"end end if A:HealthPercentage()<=d.RetHealing.BubbleHP and(n.DivineShield:IsCastable()and not A:DebuffUp(n.ForbearanceDebuff))then if G(n.DivineShield,true)then return"\068\105\118\105\110\101 \083\104\105\101\108\100 \100\101\102\101\110\115\105\118\101"end end if A:HealthPercentage()<=d.RetHealing.WordofGloryPlayerHP and Y:IsReady()then if G(Y,true)then return"\087\111\114\100 \111\102 \071\108\111\114\121 \100\101\102\101\110\115\105\118\101"end end if A:HealthPercentage()<=d.RetHealing.FlashofLightPlayerHP and((not A:IsMoving()or n.LightsCelerity:IsAvailable())and n.FlashofLight:IsReady())then if G(n.FlashofLight,true)then return"\070\108\097\115\104 \111\102 \076\105\103\104\116 \100\101\102\101\110\115\105\118\101"end end if A:HealthPercentage()<=d.RetHealing.ShieldofVengeanceHP and n.ShieldofVengeance:IsCastable()then if G(n.ShieldofVengeance,true)then return"\115\104\105\101\108\100 \111\102 \118\101\110\103\101\097\110\099\101 \100\101\102\101\110\115\105\118\101"end end if A:HealthPercentage()<=d.RetHealing.DivineProtectionHP and n.DivineProtection:IsCastable()then if G(n.DivineProtectionCast,true)then return"\068\105\118\105\110\101 \080\114\111\116\101\099\116\105\111\110 \100\101\102\101\110\115\105\118\101"end end end local function oM()local k=P.UnitsinRange(n.FlashofLight)local U=P.GetLowestHealthUnit(k)local Q=U:HealthPercentage()if not U:DebuffUp(n.ForbearanceDebuff)then if n.LayonHands:IsReady()and Q<=d.RetHealing.LoHPartyHP then U:Cast(n.LayonHands)return"\076\097\121 \111\110 \072\097\110\100\115 \080\097\114\116\121"end end if n.BlessingofProtection:IsReady()then BoPTarget=KM(k)PlayerIsBoPTarget=KM(k,true)if BoPTarget~=nil and not d.RetHealing.BoPPlayerOnly then BoPTarget:Cast(n.BlessingofProtection)return"\066\108\101\115\115\105\110\103 \111\102 \080\114\111\116\101\099\116\105\111\110 \080\097\114\116\121"end if PlayerIsBoPTarget~=nil then A:Cast(n.BlessingofProtection)return"\066\108\101\115\115\105\110\103 \111\102 \080\114\111\116\101\099\116\105\111\110 \080\108\097\121\101\114"end end if n.Intercession:IsReady()and not A:IsMoving()then if Z:UnitIsFriend()and(Z:UnitIsPlayer()and(Z:Exists()and Z:IsDeadOrGhost()))then E.CastTarget(n.Intercession,(E.TName()).MOUSEOVER)return"\073\110\116\101\114\099\101\115\115\105\111\110 \111\110 \077\111\117\115\101\111\118\101\114"end if d.RetHealing.IntercessionTarget and(h:UnitIsFriend()and(h:Exists()and h:IsDeadOrGhost()))then E.Cast(n.Intercession)return"\073\110\116\101\114\099\101\115\115\105\111\110 \111\110 \084\097\114\103\101\116"end end if Y:IsReady()and Q<=d.RetHealing.WordofGloryPartyHP then U:Cast(Y)return"\087\111\114\100 \111\102 \071\108\111\114\121 \080\097\114\116\121"end if n.FlashofLight:IsReady()and((not A:IsMoving()or n.LightsCelerity:IsAvailable())and Q<=d.RetHealing.FlashofLightPartyHP)then U:Cast(n.FlashofLight)return"\070\108\097\115\104 \111\102 \076\105\103\104\116 \080\097\114\116\121"end if n.BlessingofSacrifice:IsReady()and(Q<=d.RetHealing.BlessingOfSacrificeHP and(A:HealthPercentage()>90 and A:BuffDown(n.BlessingofProtection)))then U:Cast(n.BlessingofSacrifice)return"\066\108\101\115\115\105\110\103\111\102\083\097\099\114\105\102\105\099\101 \080\097\114\116\121"end end local function SM()if A:IsChanneling(R.ManicGrieftorch.ItemUseSpell)then return"\068\111\110\116 \099\117\116 \084\111\114\099\104"end if(f:ID()==R.ConcoctionKissofDeath:ID()or p:ID()==R.ConcoctionKissofDeath:ID())and(A:BuffUp(n.ConcoctionKissofDeathBuff)and A:BuffRemains(n.ConcoctionKissofDeathBuff)<2)then E.CastSuggested(R.ConcoctionKissofDeath)end SmallCDToggle=E.ToggleIconFrame:GetToggle(1)TabToggle=d.Retribution.TabToggle and E.ToggleIconFrame:GetToggle(2)InterruptToggle=E.ToggleIconFrame:GetToggle(3)DispelToggle=E.ToggleIconFrame:GetToggle(4)w=P.UnitsinRange(n.FlashofLight)UnitForFreezingBinds=qM(w)Y=n.EternalFlame:IsAvailable()and n.EternalFlame or n.WordofGlory m=A:GetEnemiesInRange(8)if s()then c=#m else c=1 end RacialsSetting=CM(d.RetCooldowns.RacialsSetting)and JM(d.RetTTD.RacialsTTD)Trinket1Setting=CM(d.RetCooldowns.Trinket1Setting)and JM(d.RetTTD.TrinketsTTD)Trinket2Setting=CM(d.RetCooldowns.Trinket2Setting)and JM(d.RetTTD.TrinketsTTD)PotionSetting=CM(d.RetCooldowns.PotionSetting)and not P.ISSolo()DivineTollSetting=CM(d.RetCooldowns.DivineTollSetting)and JM(d.RetTTD.DivineTollTTD)AvengingWrathSetting=CM(d.RetCooldowns.AvengingWrathSetting)and JM(d.RetTTD.AvengingWrathTTD)ExecutionSentenceSetting=CM(d.RetCooldowns.ExecutionSentenceSetting)and JM(d.RetTTD.ExecutionSentenceTTD)FinalReckoningSetting=CM(d.RetCooldowns.FinalReckoningSetting)and JM(d.RetTTD.FinalReckoningTTD)CrusadeSetting=CM(d.RetCooldowns.CrusadeSetting)and JM(d.RetTTD.CrusadeTTD)WakeofAshesSetting=CM(d.RetCooldowns.WakeofAshesSetting)and JM(d.RetTTD.WakeofAshesTTD)WeaponSetting=CM(d.RetCooldowns.WeaponSetting)and JM(15)AuraSelected=d.Retribution.AuraSelect if P.TargetIsValid()or A:AffectingCombat()then r=MM()J=u.BossFightRemains()S=true B=J if B==11111 then S=false B=u.FightRemains(m,false)end i=A:GCD()F=A:HolyPower()end if n.DevotionAura:IsReady()and(AuraSelected=="\068\101\118\111\116\105\111\110 \065\117\114\097"and A:BuffDown(n.DevotionAura,true))then G(n.DevotionAura)return"\068\101\118\111\116\105\111\110 \065\117\114\097"end if n.ConcentrationAura:IsReady()and(AuraSelected=="\067\111\110\099\101\110\116\114\097\116\105\111\110 \065\117\114\097"and A:BuffDown(n.ConcentrationAura,true))then G(n.ConcentrationAura)return"\067\111\110\099\101\110\116\114\097\116\105\111\110 \065\117\114\097"end if A:AffectingCombat()then v=VM()if v then return v end end if A:IsInParty()and not A:IsInRaid()then v=oM()if v then return v end if n.CleanseToxins:IsReady()and(d.Retribution.UseCleanse and DispelToggle)then v=P.DispelCycle(n.CleanseToxins,"\080\111\105\115\111\110")if v then return v end v=P.DispelCycle(n.CleanseToxins,"\068\105\115\101\097\115\101")if v then return v end v=P.AfflictedLogic(n.CleanseToxins)if v then return v end end if n.BlessingofFreedom:IsReady()then if A:IsInParty()and(not A:IsInRaid()and d.Retribution.UseBoF)then if UnitForFreezingBinds then if UnitForFreezingBinds:Cast(n.BlessingofFreedom)then return"\066\108\101\115\115\105\110\103 \111\102 \070\114\101\101\100\111\109 \070\114\111\122\101\110 \066\105\110\100\115"end end if n.UnboundFreedom:IsAvailable()then if P.unitHasDebuffFromList(P.DebuffList.Entangled,z(d.RetHealing.UnboundFreedomUnit))or P.unitHasDebuffFromList(P.DebuffList.Entangled,A)then(z(d.RetHealing.UnboundFreedomUnit)):Cast(n.BlessingofFreedom)return"\066\111\070 \111\110 "..d.RetHealing.UnboundFreedomUnit end v=nM(n.BlessingofFreedom,"\082\111\111\116\068\105\115\112\101\108")if v then return v end v=nM(n.BlessingofFreedom,"\083\110\097\114\101\082\111\111\116")if v then return v end v=nM(n.BlessingofFreedom,"\070\114\101\101\100\111\109\068\105\115\112\101\108")if v then return v end else if A:DebuffElapsed(n.EntangledDebuff)>2 then if A:Cast(n.BlessingofFreedom)then return"\066\108\101\115\115\105\110\103 \111\102 \070\114\101\101\100\111\109 \101\110\116\097\110\103\108\105\110\103"end end v=P.DispelCycle(n.BlessingofFreedom,"\082\111\111\116\068\105\115\112\101\108",nil,w)if v then return v end v=P.DispelCycle(n.BlessingofFreedom,"\083\110\097\114\101\082\111\111\116",nil,w)if v then return v end v=P.DispelCycle(n.BlessingofFreedom,"\070\114\101\101\100\111\109\068\105\115\112\101\108",nil,w)if v then return v end end end if P.unitHasDebuffFromList(P.DebuffList.RootDispel,A)or P.unitHasDebuffFromList(P.DebuffList.SnareRoot,A)or P.unitHasDebuffFromList(P.DebuffList.FreedomDispel,A)then A:Cast(n.BlessingofFreedom)return"\066\111\070 \111\110 \080\108\097\121\101\114"end if(A:DebuffUp(g(424495),true)or A:DebuffUp(g(424497),true))and A:IsInRaid()then A:Cast(n.BlessingofFreedom)return end end end if P.TargetIsValid()then if not A:AffectingCombat()and d.Retribution.AttackOutOfCombat then v=BM()if v then return v end end if InterruptToggle then v=P.InterruptCycle(n.Rebuke,5,true,nil,false)if v then return v end v=not A:IsMoving()and P.InterruptCycle(n.HammerofJustice,10,false,nil,true)if v then return v end v=not A:IsMoving()and(not d.Retribution.XalatathsBargain and P.InterruptCycle(n.BlindingLight,10,false,nil,true,true))if v then return v end if d.Retribution.XalatathsBargain and(EnemiesWithIDInCCRange(229296)>=5 and n.BlindingLight:IsCastable())then if G(n.BlindingLight)then return"\066\108\105\110\100\105\110\103\076\105\103\104\116 \111\110 \088\097\108\097\116\097\116\104\115\066\097\114\103\097\105\110"end end end if h:AffectingCombat()or d.Retribution.AttackOutOfCombat then v=rM()if v then return v end v=iM()if v then return v end end end v=c>0 and(not h:IsInRange(8)and PM())if v then return v end end local function vM()d.Retribution.Display()E.ResetToggle()E.ToggleIconFrame:AddButtonCustom("\083",1,"\083\109\097\108\108 \067\068\115","\115\109\097\108\108\099\100\115")E.ToggleIconFrame:AddButtonCustom("\084",2,"\084\097\098","\116\097\098")E.ToggleIconFrame:AddButtonCustom("\073",3,"\073\110\116\101\114\114\117\112\116","\105\110\116\101\114\114\117\112\116")E.ToggleIconFrame:AddButtonCustom("\068",4,"\068\105\115\112\101\108","\100\105\115\112\101\108")E:UpdateMacro("\109\097\099\114\111\049","\047\117\115\101 \049\054")n.MarkofFyralathDebuff:RegisterAuraTracking()E.Print("\082\101\116\114\105\098\117\116\105\111\110 \080\097\108\097\100\105\110 \114\111\116\097\116\105\111\110 \104\097\115 \098\101\101\110 \117\112\100\097\116\101\100 \102\111\114 \112\097\116\099\104 \049\049\046\048\046\050\046")end E.SetAPL(70,SM,vM)